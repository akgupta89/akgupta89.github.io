(window["webpackJsonpmetrics-mvp"]=window["webpackJsonpmetrics-mvp"]||[]).push([[0],{243:function(e,t,a){e.exports=a(313)},252:function(e,t,a){},253:function(e,t,a){},310:function(e,t,a){},313:function(e,t,a){"use strict";a.r(t);var n={};a.r(n),a.d(n,"generateRoutesURL",(function(){return _e})),a.d(n,"generateArrivalsURL",(function(){return We})),a.d(n,"fetchTripMetrics",(function(){return Fe})),a.d(n,"resetTripMetrics",(function(){return Ve})),a.d(n,"fetchRoutes",(function(){return ze})),a.d(n,"fetchRouteMetrics",(function(){return Ue})),a.d(n,"fetchAgencyMetrics",(function(){return Be})),a.d(n,"fetchArrivals",(function(){return $e})),a.d(n,"resetArrivals",(function(){return qe})),a.d(n,"handleSpiderMapClick",(function(){return Ye})),a.d(n,"handleGraphParams",(function(){return He}));var r={};a.r(r),a.d(r,"loading",(function(){return ba})),a.d(r,"title",(function(){return Sa})),a.d(r,"page",(function(){return Xt})),a.d(r,"initialGraphParams",(function(){return wa})),a.d(r,"graphParams",(function(){return xa})),a.d(r,"routes",(function(){return Ca})),a.d(r,"tripMetrics",(function(){return ja})),a.d(r,"arrivals",(function(){return La})),a.d(r,"spiderSelection",(function(){return Aa})),a.d(r,"agencyMetrics",(function(){return za})),a.d(r,"routeMetrics",(function(){return $a}));var i=a(0),o=a.n(i),l=a(22),c=a.n(l),s=a(24),u=(a(252),a(225)),d=a(383);a(253);var m=a(376),p=a(363),h=a(381),f="",g=window.OpentransitConfig;if(!g)throw new Error("OpentransitConfig not defined (may be a server error)");var v=g.S3Bucket,E=g.Agencies,y=g.PrecomputedStatsVersion,b=g.RoutesVersion,O=g.ArrivalsVersion,T={};function S(e){return T[e]}E.forEach((function(e){T[e.id]=e}));var I=a(79),R=a(80),k=a(86),w=a(81),x=a(54),M=a(85),C=a(358),D=a(204),j=a.n(D),P=a(176),L=a(174),N=a(179),A=a(177),_=a(175),W=a(178),F=a(11),V=a.n(F),z=a(64),U=a.n(z),B=a(50),$=a(392),q=a(165),Y=a(19),H=a(199),G=a.n(H),J=a(202),X=a.n(J),Q=a(200),Z=a.n(Q),K=a(201),ee=a.n(K);function te(e){var t=S(e.agencyId).routeHeuristics;return t&&t[e.id]&&t[e.id].ignoreRoute}function ae(e){return e.filter((function(e){return!te(e)}))}function ne(e){return e/1609.344}function re(e,t,a,n){var r=B.a().domain([5,10]).rangeRound([100,0]).clamp(!0),i=B.a().domain([1,0]).rangeRound([100,0]).clamp(!0),o=B.a().domain([5,10]).rangeRound([0,100]).clamp(!0),l=B.a().domain([10,20]).rangeRound([100,0]).clamp(!0),c=null!=e?r(e):null,s=null!=t?i(t):null,u=null!=a?o(a):null,d=null!=n?l(n):null;return{medianWaitScore:c,onTimeRateScore:s,speedScore:u,travelVarianceScore:d,totalScore:null!=c&&null!=s&&null!=u&&null!=d?Math.round((c+s+u+d)/4):null}}var ie=100,oe=B.c().domain([.25,.5,.75]).range([G.a[300],Z.a[300],ee.a[700],X.a[900]]),le=function(e){return null==e||Number.isNaN(e)?null:oe(e/ie)},ce=B.c().domain([.25,.5,.75]).range(["rgba(0,0,0,0.87)","rgba(0,0,0,0.87)","white","white"]),se=function(e){return null==e||Number.isNaN(e)?null:ce(e/ie)};function ue(e,t){return ne(function(e,t,a,n){var r=[e,t,a,n].map((function(e){return e*Math.PI/180})),i=Object(Y.a)(r,4),o=i[0],l=i[1],c=i[2],s=c-o,u=i[3]-l,d=Math.pow(Math.sin(s/2),2)+Math.cos(o)*Math.cos(c)*Math.pow(Math.sin(u/2),2);return 6371e3*(2*Math.atan2(Math.sqrt(d),Math.sqrt(1-d)))}(e.lat,e.lon,t.lat,t.lon))}function de(e,t,a,n,r){var i=e.filter((function(e){return null!=e[t]}));i.sort((function(e,n){return(e[t]-n[t])*a}));var o=i.length;i.forEach((function(e,t){e[n]=t+1,e[r]=o}))}function me(e,t,a){var n=t.stops,r=a?n.indexOf(a):0,i=t.loop,o=n.slice(r+1);return i?o.concat(n.slice(0,r+1)):o}function pe(e,t){var a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:t.stops[0],n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:t.stops[t.stops.length-1],r=e.stops[a],i=e.stops[n],o=t.stop_geometry[a],l=t.stop_geometry[n],c=[];if(o&&l){c.push(r);var s=t.coords,u=o.after_index+1;if(t.loop&&l.after_index<=o.after_index){for(var d=u;d<s.length;d++)c.push(s[d]);u=0}for(var m=u;m<=l.after_index;m++)c.push(s[m]);c.push(i)}else{var p=t.stops,h=p.indexOf(a),f=p.indexOf(n);if(-1!==h&&-1!==f){var g=h;if(t.loop&&f<=h){for(var v=g;v<p.length;v++)c.push(e.stops[p[v]]);g=0}for(var E=g;E<=f;E++)c.push(e.stops[p[E]])}}return c}function he(e,t){var a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:t.stops[0],n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:t.stops[t.stops.length-1],r=t.stop_geometry[a],i=t.stop_geometry[n];if(r&&i){var o=i.distance-r.distance;return o<=0&&t.loop&&(o+=t.distance),ne(o)}var l=t.stops,c=e.stops,s=l.indexOf(a),u=l.indexOf(n),d=0;if(-1!==s&&-1!==u){var m=s,p=l.length;if(t.loop&&u<=s){for(var h=m;h<p;h++)d+=ue(c[l[h]],c[l[(h+1)%p]]);m=0}for(var f=m;f<u;f++)d+=ue(c[l[f]],c[l[f+1]]);return d}return null}function fe(e,t){var a=q.point([t.lng,t.lat]),n=S(e).serviceArea;return!n||n.features.some((function(e){return q.booleanWithin(a,e)}))}var ge=a(107),ve=a.n(ge),Ee=a(31),ye=a.n(Ee),be=a(167),Oe=a.n(be),Te=a(166),Se=a.n(Te),Ie={GRAY:Se.a[400],GRAY_DARK:Se.a[600],PURPLE:Oe.a[200],PURPLE_DARK:Oe.a[400],BLUE:"blue",RED:"red",GREEN:"green"},Re=[Ie.GRAY,Ie.PURPLE,Ie.GRAY_DARK,Ie.PURPLE_DARK],ke=90,we=10,xe={line:{background:"none"}},Me="allday",Ce=[{value:Me,shortLabel:"All Day",restOfLabel:""},{value:"07:00-19:00",shortLabel:"Daytime",restOfLabel:" (7AM - 7PM)"},{value:"03:00-07:00",shortLabel:"Early Morning",restOfLabel:" (3AM - 7AM)"},{value:"07:00-10:00",shortLabel:"AM Peak",restOfLabel:" (7AM - 10AM)"},{value:"10:00-16:00",shortLabel:"Midday",restOfLabel:" (10AM - 4PM)"},{value:"16:00-19:00",shortLabel:"PM Peak",restOfLabel:" (4PM - 7PM)"},{value:"19:00-03:00+1",shortLabel:"Late Evening",restOfLabel:" (7PM - 3AM)"}],De=90,je=[{value:"1",label:"Yesterday"},{value:"7",label:"Last week"},{value:"30",label:"Last 30 days"},{value:"90",label:"Last 90 days"}],Pe=[{value:"1",label:"Monday",shortLabel:"M"},{value:"2",label:"Tuesday",shortLabel:"Tu"},{value:"3",label:"Wednesday",shortLabel:"W"},{value:"4",label:"Thursday",shortLabel:"Th"},{value:"5",label:"Friday",shortLabel:"F"}],Le=[{value:"6",label:"Saturday",shortLabel:"Sa"},{value:"0",label:"Sunday",shortLabel:"Su"}],Ne=120;function Ae(e){var t=ye()(e.date),a=ye()(e.startDate),n=t.diff(a,"days"),r=Math.abs(n)+1;n<0&&(t=a),r>De&&(r=De);for(var i=[],o=0;o<r;o++)e.daysOfTheWeek[a.day()]&&i.push(a.format("YYYY-MM-DD")),a.add(1,"days");return i}function _e(e){return"https://".concat(v,".s3.amazonaws.com/routes/").concat(b,"/routes_").concat(b,"_").concat(e,".json.gz?u")}function We(e,t,a){return"https://".concat(v,".s3.amazonaws.com/arrivals/").concat(O,"/").concat(e,"/").concat(t.replace(/-/g,"/"),"/arrivals_").concat(O,"_").concat(e,"_").concat(t,"_").concat(a,".json.gz?ai")}function Fe(e){return function(t){var a=Ae(e.firstDateRange),n=e.secondDateRange&&Ae(e.secondDateRange),r=n?"\n    fragment intervalFields on TripIntervalMetrics {\n        headways {\n          count median max\n          percentiles(percentiles:[90]) { percentile value }\n          histogram { binStart binEnd count }\n        }\n        tripTimes {\n          count median avg max\n          percentiles(percentiles:[90]) { percentile value }\n          histogram { binStart binEnd count }\n        }\n        waitTimes {\n          median max\n          percentiles(percentiles:[90]) { percentile value }\n          histogram { binStart binEnd count }\n        }\n        departureScheduleAdherence {\n          onTimeCount\n          scheduledCount\n        }\n    }\n\n    fragment timeRangeFields on TripIntervalMetrics {\n        startTime endTime\n        waitTimes {\n          percentiles(percentiles:[50,90]) { percentile value }\n        }\n        tripTimes {\n          percentiles(percentiles:[50,90]) { percentile value }\n        }\n    }\n\n    query($agencyId:String!, $routeId:String!,\n      $startStopId:String!, $endStopId:String, $directionId:String,\n      $dates:[String!], $startTime:String, $endTime:String,\n      $dates2:[String!], $startTime2:String, $endTime2:String) {\n\n    agency(agencyId:$agencyId) {\n      route(routeId:$routeId) {\n        trip(startStopId:$startStopId, endStopId:$endStopId, directionId:$directionId) {\n          interval(dates:$dates, startTime:$startTime, endTime:$endTime) {\n              ...intervalFields\n          }\n          interval2: interval(dates:$dates2, startTime:$startTime2, endTime:$endTime2) {\n              ...intervalFields\n          }\n          timeRanges(dates:$dates) {\n              ...timeRangeFields\n          }\n          timeRanges2: timeRanges(dates:$dates2) {\n              ...timeRangeFields\n          }\n        }\n      }\n    }\n  }\n\n  ":"query($agencyId:String!, $routeId:String!, $startStopId:String!, $endStopId:String,\n    $directionId:String, $dates:[String!], $startTime:String, $endTime:String) {\n  agency(agencyId:$agencyId) {\n    route(routeId:$routeId) {\n      trip(startStopId:$startStopId, endStopId:$endStopId, directionId:$directionId) {\n        interval(dates:$dates, startTime:$startTime, endTime:$endTime) {\n          headways {\n            count median max\n            percentiles(percentiles:[90]) { percentile value }\n            histogram { binStart binEnd count }\n          }\n          tripTimes {\n            count median avg max\n            percentiles(percentiles:[90]) { percentile value }\n            histogram { binStart binEnd count }\n          }\n          waitTimes {\n            median max\n            percentiles(percentiles:[90]) { percentile value }\n            histogram { binStart binEnd count }\n          }\n          departureScheduleAdherence {\n            onTimeCount\n            scheduledCount\n          }\n        }\n        byDay(dates:$dates, startTime:$startTime, endTime:$endTime) {\n          dates\n          startTime\n          endTime\n          tripTimes {\n            median\n            percentiles(percentiles:[10,90]) { percentile value }\n           }\n          waitTimes {\n            median\n            percentiles(percentiles:[90]) { percentile value }\n          }\n          departureScheduleAdherence {\n            onTimeCount\n            scheduledCount\n          }\n        }\n        timeRanges(dates:$dates) {\n          startTime endTime\n          waitTimes {\n            percentiles(percentiles:[50,90]) { percentile value }\n          }\n          tripTimes {\n            percentiles(percentiles:[50,90]) { percentile value }\n          }\n        }\n      }\n    }\n  }\n}",i=Object.assign({dates:a,startTime:e.firstDateRange.startTime,endTime:e.firstDateRange.endTime},n?{dates2:n,startTime2:e.secondDateRange.startTime,endTime2:e.secondDateRange.endTime}:null,e);delete i.firstDateRange,delete i.secondDateRange,r=r.replace(/\s+/g," "),t({type:"REQUEST_TRIP_METRICS"}),ve.a.get("/api/graphql",{params:{query:r,variables:JSON.stringify(i)},baseURL:f}).then((function(e){var a=e.data;if(a&&a.errors)t({type:"ERROR_TRIP_METRICS",error:a.errors[0].message});else{var n=a&&a.data?a.data.agency:null,r=n?n.route:null,i=r?r.trip:null;t({type:"RECEIVED_TRIP_METRICS",data:i})}})).catch((function(e){var a=e.response&&e.response.data&&e.response.data.errors?e.response.data.errors[0].message:e.message;t({type:"ERROR_TRIP_METRICS",error:a})}))}}function Ve(){return function(e){e({type:"RECEIVED_TRIP_METRICS",data:null})}}function ze(){return function(e,t){var a=E[0].id;a!==t().routes.agencyId&&(e({type:"REQUEST_ROUTES",agencyId:a}),ve.a.get(_e(a)).then((function(t){var n=t.data.routes;n.forEach((function(e){e.agencyId=a})),e({type:"RECEIVED_ROUTES",data:n,agencyId:a})})).catch((function(t){e({type:"ERROR_ROUTES",error:t})})))}}function Ue(e){var t=Ae(e.firstDateRange);return function(a,n){var r="query($agencyId:String!, $routeId:String!, $dates:[String!], $startTime:String, $endTime:String) {\n  agency(agencyId:$agencyId) {\n    route(routeId:$routeId) {\n      interval(dates:$dates, startTime:$startTime, endTime:$endTime) {\n        directions {\n          directionId\n          segments {\n            fromStopId\n            toStopId\n            medianTripTime\n            trips\n          }\n          cumulativeSegments {\n            fromStopId\n            toStopId\n            medianTripTime\n            trips\n          }\n        }\n      }\n    }\n  }\n}".replace(/\s+/g," "),i=JSON.stringify({agencyId:E[0].id,routeId:e.routeId,dates:t,startTime:e.firstDateRange.startTime,endTime:e.firstDateRange.endTime});n().routeMetrics.variablesJson!==i&&(a({type:"REQUEST_ROUTE_METRICS",variablesJson:i}),ve.a.get("/api/graphql",{params:{query:r,variables:i},baseURL:f}).then((function(e){var t=e.data;if(t&&t.errors)a({type:"ERROR_ROUTE_METRICS",error:t.errors[0].message});else{var n=t&&t.data?t.data.agency:null,r=n?n.route:null;a({type:"RECEIVED_ROUTE_METRICS",variablesJson:i,data:r})}})).catch((function(e){var t=e.response&&e.response.data&&e.response.data.errors?e.response.data.errors[0].message:e.message;a({type:"ERROR_ROUTE_METRICS",error:t})})))}}function Be(e){var t=Ae(e.firstDateRange);return function(a,n){var r='query($agencyId:String!, $dates:[String!], $startTime:String, $endTime:String) {\n  agency(agencyId:$agencyId) {\n    agencyId\n    interval(dates:$dates, startTime:$startTime, endTime:$endTime) {\n      routes {\n        routeId\n        directions {\n          directionId\n          medianWaitTime\n          averageSpeed(units:"mph")\n          travelTimeVariability\n          onTimeRate\n        }\n      }\n    }\n  }\n}'.replace(/\s+/g," "),i=JSON.stringify({agencyId:E[0].id,dates:t,startTime:e.firstDateRange.startTime,endTime:e.firstDateRange.endTime});n().agencyMetrics.variablesJson!==i&&(a({type:"REQUEST_AGENCY_METRICS",variablesJson:i}),ve.a.get("/api/graphql",{params:{query:r,variables:i},baseURL:f}).then((function(e){var t=e.data;if(t&&t.errors)a({type:"ERROR_AGENCY_METRICS",error:t.errors[0].message});else{var n=t&&t.data?t.data.agency:null;a({type:"RECEIVED_AGENCY_METRICS",variablesJson:i,data:n})}})).catch((function(e){var t=e.response&&e.response.data&&e.response.data.errors?e.response.data.errors[0].message:e.message;a({type:"ERROR_AGENCY_METRICS",error:t})})))}}function $e(e){return function(t,a){var n=e.firstDateRange.date,r=We(e.agencyId,n,e.routeId);a().arrivals.url!==r&&(t({type:"REQUEST_ARRIVALS"}),ve.a.get(r).then((function(e){t({type:"RECEIVED_ARRIVALS",data:e.data,url:r})})).catch((function(){t({type:"ERROR_ARRIVALS",error:"No data."})})))}}function qe(){return function(e){e({type:"RECEIVED_ARRIVALS",url:null,data:null})}}function Ye(e,t){return function(a){a({type:"RECEIVED_SPIDER_MAP_CLICK",stops:e,latLng:t})}}function He(e){return function(t,a){var n=a().graphParams;t({type:"RECEIVED_GRAPH_PARAMS",params:e});var r=a().graphParams;n.firstDateRange.date===r.firstDateRange.date&&n.routeId===r.routeId&&n.agencyId===r.agencyId||t((function(e){e({type:"RECEIVED_ARRIVALS",url:null,data:null})})),r.firstDateRange.date&&t(Be(r)),r.agencyId&&r.routeId&&t(Ue(r)),r.agencyId&&r.routeId&&r.directionId&&r.startStopId&&r.endStopId?t(Fe(r)):t((function(e){e({type:"RECEIVED_TRIP_METRICS",data:null})}))}}function Ge(e){var t=e.routeText,a=e.color,n=e.waitScaled,r=null,i=9+1.25*n;return r=t.endsWith("R")||t.endsWith("X")?'<div style="width:30px; height:'.concat(2*i,"px; ")+"border-radius:".concat(t.endsWith("X")?i:0,"px; "):'<div style="width:'.concat(2*i,"px; height:").concat(2*i,"px; ")+"border-radius: ".concat(i+1,"px; "),r+="".concat("position:relative; top:5px; left:5px; border-style:solid; border-color:").concat(a,"; ")+"border-width: ".concat(n/1.5+1,"px;")+"background-color:white;"+"font-size:".concat(75+15*n,"%; font-weight: ").concat(400+75*n,';\n     display:flex; align-items: center;\n     justify-content: center;">').concat(t,"</div>")}function Je(e){return o.a.createElement($.a,{message:"Location is not in service area",open:e.showAlert})}var Xe=function(e){function t(e){var a;return Object(I.a)(this,t),(a=Object(k.a)(this,Object(w.a)(t).call(this,e))).routeColorOptions=B.b([0,9],B.d),a.SpiderOriginMarker=function(e){var t=null;return e.spiderLatLng?o.a.createElement(P.a,{position:e.spiderLatLng,draggable:!0,onMove:function(e){t=e.latlng},onMoveEnd:function(){a.handleLocationFound({latlng:t})}}):null},a.getRouteColor=function(e){return e.routeInfo.color?"#".concat(e.routeInfo.color):a.routeColorOptions(e.routeIndex%10)},a.generateShield=function(e,t){var n=e.downstreamStops[e.downstreamStops.length-1],r=[n.lat,n.lon],i=V.a.divIcon({className:"custom-icon",html:Ge({waitScaled:t,color:a.getRouteColor(e),routeText:e.routeId})});return o.a.createElement(P.a,{key:"".concat(e.routeId,"-").concat(e.direction.id,"-Shield"),position:r,icon:i,riseOnHover:!0,onClick:function(t){t.originalEvent.view.L.DomEvent.stopPropagation(t),a.props.dispatch({type:"ROUTESCREEN",payload:{routeId:e.routeId,directionId:e.direction.id,startStopId:e.stopId,endStopId:n.stopId},query:a.props.query})}})},a.getStartMarkers=function(){var e=null,t=a.props.spiderSelection.stops;return t&&(e=t.map((function(e,t){var n=[e.stop.lat,e.stop.lon];return o.a.createElement(L.a,{key:"startMarker-".concat(t),center:n,radius:"8",fillColor:a.getRouteColor(e),fillOpacity:.2,stroke:!1},o.a.createElement(N.a,null,e.routeTitle,o.a.createElement("br",null),e.direction.title,o.a.createElement("br",null),e.stop.title,o.a.createElement("br",null),Math.round(5280*e.miles)," feet"))}))),e},a.DownstreamLines=function(){var e=a.props.statsByRouteId,t=null,n=a.props.spiderSelection.stops;return n&&(t=n.map((function(t){for(var n=t.downstreamStops,r=[],i=e[t.routeId]||{},o=i.waitRankCount?Math.trunc(3*(1-i.waitRank/i.waitRankCount)):0,l=0;l<n.length-1;l++)r.push(a.generatePolyline(t,o,l));return r.push(a.generateTerminalCircle(t,o)),r.push(a.generateShield(t,o)),r}))),o.a.createElement(i.Fragment,null,t)},a.generateTerminalCircle=function(e,t){var n=e.downstreamStops[e.downstreamStops.length-1],r=[n.lat,n.lon];return o.a.createElement(L.a,{key:"startMarker-".concat(e.routeId,"-terminal-").concat(n.id),center:r,radius:3+t/2,fillColor:a.getRouteColor(e),fillOpacity:.75,stroke:!1})},a.generatePolyline=function(e,t,n){var r=e.downstreamStops,i=1.5*t+3;return o.a.createElement(A.a,{key:"poly-".concat(e.routeId,"-").concat(r[n].id),positions:pe(e.routeInfo,e.direction,r[n].id,r[n+1].id),color:a.getRouteColor(e),opacity:.5,weight:i,onMouseOver:function(e){return e.target.setStyle({opacity:1,weight:i+4}),!0},onFocus:function(e){a.onMouseOver(e)},onMouseOut:function(e){return e.target.setStyle({opacity:.5,weight:i}),!0},onBlur:function(e){a.onMouseOut(e)},onClick:function(t){t.originalEvent.view.L.DomEvent.stopPropagation(t),a.props.dispatch({type:"ROUTESCREEN",payload:{routeId:e.routeId,directionId:e.direction.id,startStopId:e.stopId,endStopId:r[n+1].id},query:a.props.query})}},o.a.createElement(N.a,null,e.routeTitle,o.a.createElement("br",null),e.direction.title,o.a.createElement("br",null),r[n+1].title,o.a.createElement("br",null)))},a.handleGeoLocate=function(e){e.preventDefault();var t=a.mapRef.current;null!=t&&t.leafletElement.locate()},a.handleMapClick=function(e){null!=a.mapRef.current&&a.handleLocationFound(e)},a.agency=E[0],a.state={isValidLocation:!0,height:a.computeHeight()},a.mapRef=Object(i.createRef)(),a.handleLocationFound=a.handleLocationFound.bind(Object(x.a)(a)),a}return Object(M.a)(t,e),Object(R.a)(t,[{key:"componentDidMount",value:function(){this.boundUpdate=this.updateDimensions.bind(this),window.addEventListener("resize",this.boundUpdate)}},{key:"componentWillUnmount",value:function(){window.removeEventListener("resize",this.updateDimensions.bind(this))}},{key:"updateDimensions",value:function(){var e=this.computeHeight();this.setState({height:e})}},{key:"computeHeight",value:function(){return(window.innerWidth>=640?window.innerHeight:window.innerHeight/2)-64}},{key:"handleLocationFound",value:function(e){var t=this,a=e.latlng;this.setState({isValidLocation:fe(this.agency.id,a)});var n=this.findStops(a);n.forEach((function(e){t.addDownstreamStops(e)})),(0,this.props.onSpiderMapClick)(n,a)}},{key:"addDownstreamStops",value:function(e){var t=e.routeInfo,a=me(0,e.direction,e.stopId);a.unshift(e.stopId),e.downstreamStops=a.map((function(e){return t.stops[e]}))}},{key:"findStops",value:function(e){for(var t=this,a=this.props.routes,n={lat:e.lat,lon:e.lng},r=[],i=ae(a),o=function(e){var a=i[e];a.directions&&a.directions.forEach((function(i){var o=i.stops,l=t.findNearestStop(n,o,a.stops);l.routeId=a.id,l.routeIndex=e,l.routeTitle=a.title,l.direction=i,l.routeInfo=a,r.push(l)}))},l=0;l<i.length;l++)o(l);return(r=r.filter((function(e){return e.miles<.25}))).sort((function(e,t){return e.miles-t.miles})),r}},{key:"findNearestStop",value:function(e,t,a){var n={miles:-1,stop:null,stopId:null};return t.forEach((function(t){var r=ue(e,a[t]);(-1===n.miles||r<n.miles)&&(n={miles:r,stop:a[t],stopId:t})})),n}},{key:"render",value:function(){var e=this,t=this.props,a=t.position,n=t.zoom,r=t.spiderSelection,i=this.state.isValidLocation,l={width:"100%",height:this.state.height},c=this.getStartMarkers();return o.a.createElement("div",null,o.a.createElement(Je,{showAlert:!i}),o.a.createElement(_.a,{center:a||this.agency.initialMapCenter,zoom:n||this.agency.initialMapZoom,style:l,minZoom:5,maxZoom:18,onClick:this.handleMapClick,onLocationfound:this.handleLocationFound,ref:this.mapRef},o.a.createElement(W.a,{attribution:'Map tiles by <a href="http://stamen.com">Stamen Design</a>, under <a href="http://creativecommons.org/licenses/by/3.0">CC BY 3.0</a>. Data by <a href="http://openstreetmap.org">OpenStreetMap</a>, under <a href="http://www.openstreetmap.org/copyright">ODbL</a>.',url:"https://stamen-tiles.a.ssl.fastly.net/toner-lite/{z}/{x}/{y}.png",opacity:.3}),o.a.createElement(this.DownstreamLines,null),c,o.a.createElement(this.SpiderOriginMarker,{spiderLatLng:r.latLng}),o.a.createElement(U.a,{position:"topright"},o.a.createElement("div",{className:"map-instructions"},r.latLng&&c&&c.length?"Click anywhere along a route to see statistics for trips between the two stops.":"Click anywhere in the city to see the routes near that point.")),o.a.createElement(U.a,{position:"bottomleft"},o.a.createElement(C.a,{variant:"contained",color:"primary",onClick:this.handleGeoLocate},o.a.createElement(j.a,null),"\xa0 Routes near me"),"\xa0",o.a.createElement(C.a,{variant:"contained",color:"secondary",onClick:function(){return e.props.onSpiderMapClick([],null)}},"Clear map"),o.a.createElement("br",null),o.a.createElement("br",null))))}}]),t}(i.Component),Qe=Object(s.connect)((function(e){return{routes:e.routes.data,statsByRouteId:e.agencyMetrics.statsByRouteId,graphParams:e.graphParams,spiderSelection:e.spiderSelection,query:e.location.query}}),(function(e){return{onSpiderMapClick:function(t,a){return e(Ye(t,a))},dispatch:e}}))(Xe),Ze=a(28),Ke=a(227),et=a(5),tt=a(362),at=a(15),nt=a(45),rt=a(394),it=a(365),ot=a(366),lt=a(367),ct=a(361),st=a(359),ut=a(360),dt=a(396),mt=a(119),pt=a(315),ht=a(395),ft=a(206),gt=a.n(ft),vt=a(74),Et=a.n(vt),yt=a(63),bt=a.n(yt);function Ot(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function Tt(e){var t=e.order,a=e.orderBy,n=e.onRequestSort,r=e.columns;return o.a.createElement(st.a,null,o.a.createElement(ut.a,null,r.map((function(e){return o.a.createElement(ct.a,{key:e.id,align:e.numeric?"right":"left",padding:"none",style:{paddingRight:6,paddingBottom:3},sortDirection:a===e.id&&t},o.a.createElement(dt.a,{active:a===e.id,direction:t,onClick:(r=e.id,function(e){n(e,r)})},e.label));var r}))))}var St=Object(tt.a)((function(e){return{root:{paddingLeft:e.spacing(2),paddingRight:e.spacing(1)},highlight:"light"===e.palette.type?{color:e.palette.secondary.main,backgroundColor:Object(at.e)(e.palette.secondary.light,.85)}:{color:e.palette.text.primary,backgroundColor:e.palette.secondary.dark},spacer:{flex:"1 1 100%"},actions:{color:e.palette.text.secondary},title:{flex:"0 0 auto"},popover:{padding:e.spacing(2),maxWidth:500}}})),It=function(e){var t=St(),a=e.numSelected,n=e.columns,r=Object(i.useState)(null),l=Object(Y.a)(r,2),c=l[0],s=l[1];return o.a.createElement(p.a,{className:Object(et.a)(t.root,Object(Ze.a)({},t.highlight,a>0))},o.a.createElement("div",{className:t.title},a>0?o.a.createElement(mt.a,{color:"inherit",variant:"subtitle1"},a," selected"):o.a.createElement(mt.a,{variant:"h6",id:"tableTitle"},"Routes",o.a.createElement(pt.a,{size:"small",onClick:function(e){s(e.currentTarget)}},o.a.createElement(Et.a,{fontSize:"small"})))),o.a.createElement("div",{className:t.spacer}),o.a.createElement("div",{className:t.actions},o.a.createElement(ht.a,{title:"Filter list"},o.a.createElement(pt.a,{"aria-label":"Filter list"},o.a.createElement(gt.a,null)))),o.a.createElement(it.a,{open:Boolean(c),anchorEl:c,onClose:function(){s(null)},anchorOrigin:{vertical:"bottom",horizontal:"center"},transformOrigin:{vertical:"top",horizontal:"center"}},o.a.createElement("div",{className:t.popover},n.map((function(e){return e.helpContent?o.a.createElement("p",{key:e.id},e.helpContent):null})))))},Rt=Object(tt.a)((function(e){return{root:{width:"100%",marginTop:e.spacing(3)},tableWrapper:{overflowX:"auto"}}}));function kt(e,t){return o.a.createElement(rt.a,{style:{color:se(t),backgroundColor:le(t)},label:e})}var wt=Object(s.connect)((function(e){return{spiderSelection:e.spiderSelection,statsByRouteId:e.agencyMetrics.statsByRouteId,query:e.location.query}}))((function(e){var t=Rt(),a=o.a.useState("asc"),n=Object(Y.a)(a,2),r=n[0],l=n[1],c=o.a.useState("title"),s=Object(Y.a)(c,2),u=s[0],d=s[1],m=Object(nt.a)(),p=e.statsByRouteId,h=e.routes?ae(e.routes):[],f=e.spiderSelection.stops;if(f&&f.length>0){var g=f.map((function(e){return e.routeId}));h=h.filter((function(e){return g.includes(e.id)}))}var v=h.map((function(e){return function(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?Ot(a,!0).forEach((function(t){Object(Ze.a)(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):Ot(a).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}({route:e},p[e.id]||{})})),E=[{id:"title",numeric:!1,label:"Name",rowValue:function(t){return o.a.createElement(bt.a,{style:{color:m.palette.primary.dark,textDecoration:"none"},to:{type:"ROUTESCREEN",payload:{agencyId:t.route.agencyId,routeId:t.route.id},query:e.query}},t.route.title)}},{id:"totalScore",numeric:!0,label:"Score",rowValue:function(e){return kt(null==e.totalScore?"--":e.totalScore,e.totalScore)},helpContent:o.a.createElement(i.Fragment,null,o.a.createElement("b",null,"Score")," is the average of subscores (0-100) for median wait, on-time %, average speed, and travel time variability. Click on a route to see its metrics and explanations of how the subscores are calculated.")},{id:"medianWaitTime",numeric:!0,label:"Median Wait",rowValue:function(e){return kt(null==e.medianWaitTime?"--":"".concat(e.medianWaitTime.toFixed(0)," min"),e.medianWaitScore)},helpContent:o.a.createElement(i.Fragment,null,o.a.createElement("b",null,"Median Wait")," is the 50th percentile (typical) wait time for a rider arriving randomly at a stop while the route is running.")},{id:"onTimeRate",numeric:!0,label:"On-Time %",rowValue:function(e){return kt(null==e.onTimeRate?"--":"".concat((100*e.onTimeRate).toFixed(0),"%"),e.onTimeRateScore)},helpContent:o.a.createElement(i.Fragment,null,o.a.createElement("b",null,"On-Time %")," is the percentage of scheduled departure times where a vehicle departed less than 5 minutes after the scheduled departure time or less than 1 minute before the scheduled departure time.")},{id:"averageSpeed",numeric:!0,label:"Average Speed",rowValue:function(e){return kt(null==e.averageSpeed?"--":"".concat(e.averageSpeed.toFixed(0)," mph"),e.speedScore)},helpContent:o.a.createElement(i.Fragment,null,o.a.createElement("b",null,"Average Speed")," is the speed of the 50th percentile (typical) end to end trip, averaged for all directions.")},{id:"travelTimeVariability",numeric:!0,label:"Travel Time Variability",rowValue:function(e){return kt(null==e.travelTimeVariability?"--":"\xb1 ".concat((e.travelTimeVariability/2).toFixed(0)," min"),e.travelVarianceScore)},helpContent:o.a.createElement(i.Fragment,null,o.a.createElement("b",null,"Travel time variability")," is the 90th percentile end to end travel time minus the 10th percentile travel time. This measures how much extra travel time is needed for some trips.")}];return o.a.createElement("div",null,o.a.createElement(It,{columns:E,numSelected:0}),o.a.createElement("div",{className:t.tableWrapper},o.a.createElement(ot.a,{"aria-labelledby":"tableTitle",size:"small"},o.a.createElement(Tt,{order:r,orderBy:u,onRequestSort:function(e,t){l(u===t&&"desc"===r?"asc":"desc"),d(t)},rowCount:v.length,columns:E}),o.a.createElement(lt.a,null,function(e,t,a){if("title"===a)return"desc"===t?Object(Ke.a)(e).reverse():e;var n=function(e,t){var a="desc"===e?1:-1;return function(e,n){var r=e[t],i=n[t];return null==r&&null==i?0:null==r?1:null==i?-1:i<r?-a:i>r?a:0}}(t,a),r=e.map((function(e,t){return[e,t]}));return r.sort((function(e,t){var a=n(e[0],t[0]);return 0!==a?a:e[1]-t[1]})),r.map((function(e){return e[0]}))}(v,r,u).map((function(e){return o.a.createElement(ut.a,{hover:!0,role:"checkbox",tabIndex:-1,key:e.route.id},E.map((function(t){return o.a.createElement(ct.a,{key:t.id,align:t.numeric?"right":"left",padding:"none",style:{border:"none",paddingTop:6,paddingBottom:6}},t.rowValue(e))})))}))))))}));function xt(e){return o.a.createElement(i.Fragment,null,o.a.createElement(yt.NavLink,{to:{type:"DASHBOARD",query:e.query},exact:!0,strict:!0},o.a.createElement("img",{src:"".concat("frontend/build","/images/OpenTransit.png?v3"),style:{maxHeight:"38px",paddingTop:"5px",paddingLeft:"5px",paddingRight:"14px"},alt:"logo"})))}var Mt=a(391),Ct=a(369),Dt=a(316),jt=a(371),Pt=a(208),Lt=a.n(Pt),Nt=a(207),At=a.n(Nt),_t=a(370),Wt=a(209),Ft=a.n(Wt),Vt=a(210),zt=a.n(Vt),Ut=a(211),Bt=a.n(Ut),$t=a(212),qt=a.n($t),Yt=a(372),Ht=a(43),Gt=Object(Ze.a)({ABOUT:"About",ISOCHRONE:"Isochrone",LANDING:"Landing",DASHBOARD:"Dashboard",ROUTESCREEN:"RouteScreen",DATADIAGNOSTIC:"DataDiagnostic"},Ht.NOT_FOUND,"NotFound");function Jt(e){for(var t=null,a=Object.keys(Gt),n=0;n<a.length;n++)if(e===Gt[a[n]]){t=a[n];break}return t}var Xt=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"DASHBOARD",t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return Gt[t.type]||e};var Qt=Object(s.connect)((function(e){return{currentPage:e.page,currentLocation:e.location}}))((function(e){var t=e.currentPage,a=o.a.useState(!1),n=Object(Y.a)(a,2),r=n[0],i=n[1];function l(){i(!r)}var c={fontWeight:"bold",color:Object(nt.a)().palette.primary.dark,textDecoration:"none",cursor:"default"},s={fontWeight:"normal",color:"#000000",textDecoration:"none",cursor:"pointer"};return o.a.createElement("div",null,o.a.createElement(pt.a,{color:"inherit","aria-label":"Open drawer",onClick:l,edge:"start"},o.a.createElement(At.a,null)),o.a.createElement(Mt.a,{anchor:"left",open:r,onClose:l},o.a.createElement("div",{style:{width:250}},o.a.createElement(pt.a,{color:"inherit","aria-label":"Open drawer",onClick:l,edge:"start"},o.a.createElement(Lt.a,{color:"primary"})),o.a.createElement(Ct.a,null,o.a.createElement(Dt.a,{component:yt.NavLink,to:{type:"DASHBOARD",query:e.currentLocation.query},activeStyle:c,exact:!0,style:s,button:!0,selected:t===Gt.DASHBOARD},o.a.createElement(_t.a,null,o.a.createElement(Ft.a,{color:"primary"})),o.a.createElement(jt.a,{primary:"Dashboard"})),o.a.createElement(Dt.a,{component:yt.NavLink,to:{type:"ISOCHRONE",query:e.currentLocation.query},activeStyle:c,exact:!0,style:s,button:!0,selected:t===Gt.ISOCHRONE},o.a.createElement(_t.a,null,o.a.createElement(zt.a,{color:"primary"})),o.a.createElement(jt.a,{primary:"Isochrone"})),o.a.createElement(Dt.a,{component:yt.NavLink,to:{type:"DATADIAGNOSTIC",query:e.currentLocation.query},activeStyle:c,exact:!0,style:s,button:!0,selected:t===Gt.DATADIAGNOSTIC},o.a.createElement(_t.a,null,o.a.createElement(Bt.a,{color:"primary"})),o.a.createElement(jt.a,{primary:"Developer Tools"})),o.a.createElement(Yt.a,{light:!0}),o.a.createElement(Dt.a,{component:"a",href:"https://sites.google.com/view/opentransit",target:"_blank",onClick:l,button:!0},o.a.createElement(_t.a,null,o.a.createElement(qt.a,{color:"primary"})),o.a.createElement(jt.a,{primary:"About",style:s}))))))})),Zt=a(384),Kt=a(380),ea=a(168),ta=a.n(ea),aa=a(169),na=a.n(aa),ra=a(214),ia=a.n(ra),oa=a(390),la=a(374),ca=a(375),sa=a(379),ua=a(373),da=a(377),ma=a(386),pa=a(388),ha=a(378),fa=a(317),ga=a(213),va=a.n(ga);function Ea(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function ya(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?Ea(a,!0).forEach((function(t){Object(Ze.a)(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):Ea(a).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}var ba=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0,a=t.type,n=/(REQUEST|RECEIVED|ERROR)_(.*)/.exec(a);if(!n)return e;var r=Object(Y.a)(n,3),i=r[1],o=r[2];return ya({},e,Object(Ze.a)({},o,"REQUEST"===i))};function Oa(e){return Object.keys(e.loading).reduce((function(t,a){return t||e.loading[a]}),!1)}var Ta="OpenTransit",Sa=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Ta,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};switch(t.type){case"DASHBOARD":return"Dashboard | ".concat(Ta);case"ABOUT":return"About | ".concat(Ta);case"ISOCHRONE":return"Isochrone | ".concat(Ta);case"ROUTESCREEN":return"Routes | ".concat(Ta);case"DATADIAGNOSTIC":return"Developer Tools | ".concat(Ta);case"LANDING":return"Landing | ".concat(Ta);default:return e}};function Ia(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function Ra(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?Ia(a,!0).forEach((function(t){Object(Ze.a)(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):Ia(a).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}var ka=ye()(Date.now()-864e5),wa={agencyId:null,routeId:null,directionId:null,startStopId:null,endStopId:null,firstDateRange:{startTime:null,endTime:null,date:ka.format("YYYY-MM-DD"),startDate:ka.format("YYYY-MM-DD"),daysOfTheWeek:Ra({},Pe.reduce((function(e,t){return e[t.value]=!0,e}),{}),{},Le.reduce((function(e,t){return e[t.value]=!0,e}),{}))},secondDateRange:null};function xa(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:wa,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"RECEIVED_GRAPH_PARAMS":return Ra({},e,{},t.params);default:return e}}var Ma={agencyId:null,data:null};function Ca(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Ma,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"REQUEST_ROUTES":return Ra({},e,{agencyId:t.agencyId});case"RECEIVED_ROUTES":return Ra({},e,{data:t.data,agencyId:t.agencyId});case"ERROR_ROUTES":default:return e}}var Da={data:null,error:null};function ja(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Da,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"REQUEST_TRIP_METRICS":return Ra({},e,{error:null,data:null});case"RECEIVED_TRIP_METRICS":return Ra({},e,{error:null,data:t.data});case"ERROR_TRIP_METRICS":return Ra({},e,{error:t.error,data:null})}return e}var Pa={data:null,url:null,error:null};function La(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Pa,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"RECEIVED_ARRIVALS":return Ra({},e,{data:t.data,url:t.url,error:null});case"ERROR_ARRIVALS":return Ra({},e,{data:null,error:t.error});default:return e}}var Na={stops:[],latLng:null};function Aa(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Na,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"RECEIVED_SPIDER_MAP_CLICK":return Ra({},e,{stops:t.stops,latLng:t.latLng});default:return e}}function _a(e,t){e.forEach((function(e){var a=0,n=0;e.directions.forEach((function(e){var r=e[t];null!=r&&(a+=r,n+=1)})),e[t]=n>0?a/n:null}))}function Wa(e){Object.assign(e,re(e.medianWaitTime,e.onTimeRate,e.averageSpeed,e.travelTimeVariability))}function Fa(e){var t=e?e.interval.routes:[],a=t.filter((function(t){return!te({agencyId:e.agencyId,id:t.routeId})}));_a(t,"medianWaitTime"),_a(t,"averageSpeed"),_a(t,"onTimeRate"),_a(t,"travelTimeVariability"),de(a,"medianWaitTime",1,"waitRank","waitRankCount"),de(a,"averageSpeed",-1,"speedRank","speedRankCount"),de(a,"onTimeRate",-1,"onTimeRank","onTimeRankCount"),de(a,"travelTimeVariability",1,"variabilityRank","variabilityRankCount"),t.forEach((function(e){Wa(e),e.directions.forEach((function(e){Wa(e)}))})),de(a,"totalScore",-1,"scoreRank","scoreRankCount");var n={};return t.forEach((function(e){n[e.routeId]=e})),n}var Va={variablesJson:null,data:null,statsByRouteId:{}};function za(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Va,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"RECEIVED_AGENCY_METRICS":return Ra({},e,{variablesJson:t.variablesJson,data:t.data,statsByRouteId:Fa(t.data)});case"REQUEST_AGENCY_METRICS":return Ra({},e,{variablesJson:t.variablesJson,data:null,statsByRouteId:{}});default:return e}}function Ua(e){var t={};return e.interval.directions.forEach((function(e){var a={};e.segments.forEach((function(e){a[e.fromStopId]=e})),t[e.directionId]=a})),t}var Ba={variablesJson:null,data:null,segmentsMap:{}};function $a(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Ba,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"RECEIVED_ROUTE_METRICS":return Ra({},e,{variablesJson:t.variablesJson,data:t.data,segmentsMap:Ua(t.data)});case"REQUEST_ROUTE_METRICS":return Ra({},e,{variablesJson:t.variablesJson,data:null,segmentsMap:{}});default:return e}}var qa=a(76),Ya=a.n(qa),Ha=a(118);function Ga(e){var t=wa.firstDateRange;if(!e)return null;var a=e.date,n=e.startDate,r=e.startTime,i=e.endTime,o=e.daysOfTheWeek,l={date:a||t.date,startDate:n||t.startDate,startTime:r||null,endTime:i||null};return l.daysOfTheWeek=o?Object.keys(o).reduce((function(e,t){return"string"===typeof o[t]?e[t]="TRUE"===o[t].toUpperCase():e[t]=o[t],e}),{}):t.daysOfTheWeek,l}function Ja(e){var t=e().location,a=wa.firstDateRange,n=null;return t.query&&((a=Ga(t.query.firstDateRange))||(a=wa.firstDateRange),n=Ga(t.query.secondDateRange)),{agencyId:E[0].id,firstDateRange:a,secondDateRange:n}}function Xa(e){var t={},a=wa.firstDateRange;if(e)return e.startDate!==a.startDate&&(t.startDate=e.startDate),e.date!==a.date&&(t.date=e.date),e.startTime!==a.startTime&&(t.startTime=e.startTime),e.endTime!==a.endTime&&(t.endTime=e.endTime),JSON.stringify(a.daysOfTheWeek)!==JSON.stringify(e.daysOfTheWeek)&&(t.daysOfTheWeek=e.daysOfTheWeek),t}function Qa(e){var t={};return t.firstDateRange=Xa(e.firstDateRange),t.secondDateRange=Xa(e.secondDateRange),t.secondDateRange&&0===Object.entries(t.secondDateRange).length&&(t.secondDateRange.isActive=!0),t}var Za={ABOUT:"/about",LANDING:"/landing",ISOCHRONE:{path:"/isochrone",thunk:function(){var e=Object(Ha.a)(Ya.a.mark((function e(t,a){var n;return Ya.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=Ja(a),t(He(n));case 2:case"end":return e.stop()}}),e)})));return function(t,a){return e.apply(this,arguments)}}()},DASHBOARD:{path:"/",thunk:function(){var e=Object(Ha.a)(Ya.a.mark((function e(t,a){var n;return Ya.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=Ja(a),t(He(n));case 2:case"end":return e.stop()}}),e)})));return function(t,a){return e.apply(this,arguments)}}()},DATADIAGNOSTIC:{path:"/dataDiagnostic",thunk:function(){var e=Object(Ha.a)(Ya.a.mark((function e(t,a){var n;return Ya.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=Ja(a),t(He(n));case 2:case"end":return e.stop()}}),e)})));return function(t,a){return e.apply(this,arguments)}}()},ROUTESCREEN:{path:"/route/:routeId/:directionId?/:startStopId?/:endStopId?",thunk:function(){var e=Object(Ha.a)(Ya.a.mark((function e(t,a){var n,r,i,o,l,c,s,u;return Ya.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=a(),r=n.location,i=r.payload,o=i.routeId,l=i.directionId,c=i.startStopId,s=i.endStopId,u={routeId:o,directionId:l,startStopId:c,endStopId:s},Object.assign(u,Ja(a)),t(He(u));case 5:case"end":return e.stop()}}),e)})));return function(t,a){return e.apply(this,arguments)}}()}},Ka=function(e,t){for(var a=0;a<t.length;a++)if(e[t[a].value])return!1;return!0},en=function(e,t){for(var a=0;a<t.length;a++)if(!e[t[a].value])return!1;return!0};function tn(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function an(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?tn(a,!0).forEach((function(t){Object(Ze.a)(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):tn(a).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}var nn=Object(tt.a)((function(e){return{secondaryHeading:{fontSize:e.typography.pxToRem(12),color:e.palette.text.secondary,textAlign:"left"},formControl:{leftMargin:e.spacing(1),rightMargin:e.spacing(1),minWidth:240},closeButton:{position:"absolute",right:e.spacing(1),top:e.spacing(1),color:e.palette.grey[500]}}}));var rn=Object(s.connect)((function(e){return{graphParams:e.graphParams,currentPage:e.page}}),(function(e){return{dispatch:e}}))((function(e){var t=e.graphParams,a=e.anchorEl,n=e.setAnchorEl,r=a?a.id:"firstDateRange",l=Object(i.useState)(t[r]||wa.firstDateRange),c=Object(Y.a)(l,2),s=c[0],u=c[1],d=Object(i.useCallback)((function(){u(t[r]||wa.firstDateRange)}),[t,r]);Object(i.useEffect)((function(){d()}),[r,t,d]);var p=nn(),h=ye()(Date.now()).format("YYYY-MM-DD");function f(){d(),n(null)}function g(e){var t=an({},s,{},e);u(t)}var v=s.startTime&&s.endTime?"".concat(s.startTime,"-").concat(s.endTime):Me,E=function(e){var t=ye()(Date.now()),a=ye()(e);return a.isAfter(t)&&(a=t),a},y=function(e){var t=e.target.value,a=an({},s.daysOfTheWeek);a[t]=e.target.checked,g({daysOfTheWeek:a})},b=function(e){for(var t="weekdays"===e.target.value?Pe:Le,a=an({},s.daysOfTheWeek),n=!en(a,t),r=0;r<t.length;r++)a[t[r].value]=n;g({daysOfTheWeek:a})},O=Boolean(a),T=O?"simple-popover":void 0;return o.a.createElement(it.a,{id:T,open:O,anchorEl:a,onClose:f,anchorOrigin:{vertical:"bottom",horizontal:"right"},transformOrigin:{vertical:"top",horizontal:"right"}},o.a.createElement(pt.a,{size:"small","aria-label":"close",className:p.closeButton,onClick:f},o.a.createElement(va.a,null)),o.a.createElement(Ct.a,{style:{color:"black",marginTop:32}},o.a.createElement(Dt.a,null,o.a.createElement(ua.a,{className:p.formControl},o.a.createElement(pa.a,{id:"startDate",label:"Start Date",type:"date",value:s.startDate,InputProps:{inputProps:{max:s.date,min:ye()(s.date).subtract(De,"days").format("YYYY-MM-DD")}},className:p.textField,InputLabelProps:{shrink:!0},onChange:function(e){e.target.value&&g({startDate:E(e.target.value).format("YYYY-MM-DD")})}}))),o.a.createElement(Dt.a,null,o.a.createElement(ua.a,{className:p.formControl},o.a.createElement(pa.a,{id:"date",label:"End Date",type:"date",value:s.date,InputProps:{inputProps:{max:h}},className:p.textField,InputLabelProps:{shrink:!0},onChange:function(e){var t=e.target.value;if(t){var a=ye()(s.startDate),n=E(t),r={date:n.format("YYYY-MM-DD")};n.isBefore(a)?r.startDate=t:n.diff(a,"days")>De&&(r.startDate=n.subtract(De,"days").format("YYYY-MM-DD")),g(r)}else;}}))),o.a.createElement(Dt.a,null,o.a.createElement(m.a,{container:!0,style:{maxWidth:250}},je.map((function(e){return o.a.createElement(m.a,{item:!0,xs:6,key:e.value},o.a.createElement(C.a,{key:e.value,onClick:function(){!function(e){var t=wa.firstDateRange.date;g({date:t,startDate:ye()(t).subtract(e-1,"days").format("YYYY-MM-DD")})}(e.value)}},e.label))})))),o.a.createElement(Dt.a,null,o.a.createElement(ua.a,{component:"fieldset",className:p.formControl},o.a.createElement(fa.a,{component:"legend",className:p.secondaryHeading},"Days of the Week"),o.a.createElement(m.a,{container:!0},o.a.createElement(m.a,{item:!0},o.a.createElement(da.a,null,o.a.createElement(ha.a,{control:o.a.createElement(oa.a,{value:"weekdays",checked:!Ka(s.daysOfTheWeek,Pe),indeterminate:!Ka(s.daysOfTheWeek,Pe)&&!en(s.daysOfTheWeek,Pe),onChange:b}),label:"Weekdays"}),o.a.createElement(Yt.a,{variant:"middle",style:{marginLeft:0}}),Pe.map((function(e){return o.a.createElement(ha.a,{control:o.a.createElement(oa.a,{checked:s.daysOfTheWeek[e.value],onChange:y,value:e.value}),key:e.value,label:e.label})})))),o.a.createElement(m.a,{item:!0},o.a.createElement(da.a,null,o.a.createElement(ha.a,{control:o.a.createElement(oa.a,{value:"weekends",checked:!Ka(s.daysOfTheWeek,Le),indeterminate:!Ka(s.daysOfTheWeek,Le)&&!en(s.daysOfTheWeek,Le),onChange:b}),label:"Weekends"}),o.a.createElement(Yt.a,{variant:"middle",style:{marginLeft:0}}),Le.map((function(e){return o.a.createElement(ha.a,{control:o.a.createElement(oa.a,{checked:s.daysOfTheWeek[e.value],onChange:y,value:e.value}),key:e.value,label:e.label})}))))))),o.a.createElement(Dt.a,null,o.a.createElement(ua.a,{className:p.formControl},o.a.createElement(ca.a,{htmlFor:"time-helper"},"Time Range"),o.a.createElement(ma.a,{value:v,onChange:function(e){if(e.target.value===Me)g({startTime:null,endTime:null});else{var t=e.target.value.split("-");g({startTime:t[0],endTime:t[1]})}},input:o.a.createElement(la.a,{name:"time_range",id:"time_range"})},Ce.map((function(e){return o.a.createElement(sa.a,{value:e.value,key:e.value},e.shortLabel,e.restOfLabel)}))))),o.a.createElement(Dt.a,null,o.a.createElement(m.a,{container:!0,alignItems:"flex-start",justify:"space-between",direction:"row"},o.a.createElement(C.a,{onClick:function(){u(wa.firstDateRange)}},"Reset"),o.a.createElement(C.a,{onClick:function(){!function(){var a=Object.assign({},t);a[r]=s;var n=Jt(e.currentPage);e.dispatch({type:n,payload:t,query:Qa(a)})}(),n(null)},color:"primary",variant:"contained"},"Apply")))))})),on=Object(tt.a)((function(e){return{button:{textTransform:"none",display:"flex",justifyContent:"flex-start"},heading:{fontSize:e.typography.pxToRem(15)},secondaryHeading:{fontSize:e.typography.pxToRem(12),color:e.palette.text.secondary,textAlign:"left"},column:{flexGrow:"1"},dateTime:{whiteSpace:"nowrap",display:"flex"},root:{display:"flex",flexWrap:"wrap"},popover:{padding:e.spacing(2),maxWidth:400}}}));var ln=Object(s.connect)((function(e){return{graphParams:e.graphParams,isLoading:Oa(e),currentPage:e.page}}),(function(e){return{dispatch:e}}))((function(e){var t=e.graphParams,a=e.dateRangeSupported,n=on(),r=o.a.useState(null),l=Object(Y.a)(r,2),c=l[0],s=l[1],u=Object(i.useState)(null),d=Object(Y.a)(u,2),m=d[0],p=d[1];function h(e){s(e.currentTarget)}function f(){var a=Object.assign({},t);a.secondDateRange=null;var n=Jt(e.currentPage);e.dispatch({type:n,payload:t,query:Qa(a)})}function g(e){return ye()(e).format("MM/DD/YYYY")}var v=Boolean(c)&&"firstDateRange"===c.id,E=Boolean(c)&&"secondDateRange"===c.id,y=null;function b(e){var a=e.target;if("secondDateRange"===a&&null===t.secondDateRange)return o.a.createElement(C.a,{variant:"contained",className:n.button,onClick:h,id:a},o.a.createElement(mt.a,{className:n.secondaryHeading},"Compare Dates"),E?o.a.createElement(ta.a,null):o.a.createElement(na.a,null));var r=t[a],l=g(r.date),c="";r.startDate!==r.date&&(l="".concat(g(r.startDate)," - ").concat(l),c="".concat(function(e){var t=en(e,Pe),a=en(e,Le),n=Ka(e,Pe),r=Ka(e,Le);if(t&&a)return"Every day";if(t&&r)return"Weekdays";if(n&&a)return"Weekends";var i=Pe.concat(Le),o=i.filter((function(t){return e[t.value]}));if(0===o.length)return"No days";if(o.length===i.length-1){var l=i.filter((function(t){return!e[t.value]}));return"Except ".concat(l[0].shortLabel)}return o.reduce((function(e,t){return e.push(t.shortLabel),e}),[]).join()}(r.daysOfTheWeek),", "));var s=r.startTime&&r.endTime?"".concat(r.startTime,"-").concat(r.endTime):Me;return c+=Ce.find((function(e){return e.value===s})).shortLabel,o.a.createElement(i.Fragment,null,o.a.createElement(C.a,{variant:"contained",className:n.button,onClick:h,id:a},o.a.createElement("div",{className:n.dateTime},o.a.createElement("span",null,o.a.createElement(mt.a,{className:n.heading,display:"inline"},l,"\xa0"),o.a.createElement(mt.a,{className:n.secondaryHeading,display:"inline"},c)),"firstDateRange"===a&&v||"secondDateRange"===a&&E?o.a.createElement(ta.a,null):o.a.createElement(na.a,null))),"secondDateRange"===a?o.a.createElement(pt.a,{color:"inherit",size:"small",onClick:f,"aria-label":"Remove"},o.a.createElement(ia.a,null)):null)}(t.firstDateRange.startDate!==t.firstDateRange.date||t.secondDateRange&&t.secondDateRange.startDate!==t.secondDateRange.date)&&(a||(y=o.a.createElement(i.Fragment,null,o.a.createElement(pt.a,{size:"small",color:"inherit",onClick:function(e){p(e.currentTarget)}},o.a.createElement(Et.a,{fontSize:"small"})),o.a.createElement(it.a,{open:Boolean(m),anchorEl:m,onClose:function(){p(null)},anchorOrigin:{vertical:"bottom",horizontal:"center"},transformOrigin:{vertical:"top",horizontal:"center"}},o.a.createElement("div",{className:n.popover},"Date ranges are not implemented for the current screen. Currently showing data for one day.")))));var O=b({target:"firstDateRange"}),T=b({target:"secondDateRange"});return o.a.createElement("div",{className:n.root},e.isLoading?o.a.createElement(Zt.a,{p:1},o.a.createElement(Kt.a,{variant:"indeterminate",disableShrink:!0,style:{color:"white"},size:24})):null,y,O,"\xa0",T,o.a.createElement(rn,{anchorEl:c,setAnchorEl:s}))}));var cn=Object(s.connect)((function(e){return{routes:e.routes.data}}),(function(e){return{fetchRoutes:function(t){return e(ze())},handleGraphParams:function(t){return e(He(t))}}}))((function(e){var t=e.routes,a=e.fetchRoutes,n=e.handleGraphParams,r=E[0];return Object(i.useEffect)((function(){t||a(),n({})}),[t,a,n]),o.a.createElement("div",{className:"flex-screen"},o.a.createElement(h.a,{position:"relative"},o.a.createElement(p.a,null,o.a.createElement(Qt,null),o.a.createElement(xt,null),o.a.createElement("div",{className:"page-title"},r.title),o.a.createElement(ln,{dateRangeSupported:!0}))),o.a.createElement(m.a,{container:!0,spacing:0},o.a.createElement(m.a,{item:!0,xs:12,sm:6},o.a.createElement(Qe,null)),o.a.createElement(m.a,{item:!0,xs:12,sm:6,style:{padding:12}},o.a.createElement(wt,{routes:t}))))})),sn=a(229),un=a(221),dn=a.n(un),mn=a(222),pn=a.n(mn),hn=a(389),fn=a(7),gn=a(385),vn=a(382),En=a(387),yn=a(84),bn=a.n(yn);function On(e,t){if(!e.percentiles)return null;var a=e.percentiles.find((function(e){return e.percentile===t}));return a?a.value:0}a(113);var Tn=function(e){var t=Object(i.useState)("average_time"),a=Object(Y.a)(t,2),n=a[0],r=a[1],l=Object(i.useState)([]),c=Object(Y.a)(l,2),s=c[0],u=c[1],d=e.byDayData,m=e.routes,p=e.graphParams,h=function(e){r(e.target.value)},f=function(){u([])},g=function(e,t){var a;return"speed"===t&&(a=m?function(e,t){if(e&&e.endStopId){var a=e.directionId,n=e.routeId,r=t.find((function(e){return e.id===n})),i=r.directions.find((function(e){return e.id===a}));return he(r,i,e.startStopId,e.endStopId)}return 0}(p,m):null),function(n){var r=0;if(null!=n[e])if("average_time"===t)r=n[e].median;else if("planning_time"===t)r=On(n[e],90);else if("on_time_rate"===t){var i=n[e];r=i&&i.scheduledCount>0?100*i.onTimeCount/i.scheduledCount:null}else"speed"===t?r=a?a/(n[e].median/60):0:"travel_variability"===t&&(r=(On(n[e],90)-On(n[e],10))/2);return void 0===r&&(r=0),{x:ye()(n.dates[0]).format("dd MM/DD"),y:r}}},v=d&&d.map(g("waitTimes",n)),E=d&&d.map(g("tripTimes",n)),y=v&&v.length>0&&v.reduce((function(e,t){return e+t.y}),0)/v.length,b=E&&E.length>0&&E.reduce((function(e,t){return e+t.y}),0)/E.length,O=v&&[{x:v[0].x,y:y},{x:v[v.length-1].x,y:y}],T=E&&[{x:E[0].x,y:y+b},{x:E[E.length-1].x,y:y+b}],S=v&&v.length>0&&v.reduce((function(e,t){return e>t.y?e:t.y}),0),I=E&&E.length>0&&E.reduce((function(e,t){return e>t.y?e:t.y}),0),R=[{title:"Travel time",color:Re[1],strokeWidth:10},{title:"Wait time",color:Re[0],strokeWidth:10}],k=d&&d.map(g("departureScheduleAdherence","on_time_rate")),w=d&&d.map(g("tripTimes","speed")),x=w&&w.length>0&&w.reduce((function(e,t){return e>t.y?e:t.y}),0),M=d&&d.map(g("tripTimes","travel_variability")),C=M&&M.length>0&&M.reduce((function(e,t){return e>t.y?e:t.y}),0),D=d&&d.map((function(e,t){var a=re(v[t].y,k[t].y/100,w[t].y,M[t].y);return{x:ye()(e.dates[0]).format("dd MM/DD"),y:a.totalScore}})),j=D&&D.length>0&&D.reduce((function(e,t){return e>t.y?e:t.y}),0),P={left:40,right:10,top:10,bottom:60};if(p.secondDateRange)return o.a.createElement("div",null,o.a.createElement("p",null),"Performance by day is not available when comparing date ranges. Remove the second date range to see performance by day.");if(p.firstDateRange.date===p.firstDateRange.startDate)return o.a.createElement("div",null,o.a.createElement("p",null),"To see performance by day, select a start date and end date.");var L=function(){};return o.a.createElement("div",null,d?o.a.createElement("div",null,o.a.createElement(ua.a,null,o.a.createElement("div",{className:"controls"},o.a.createElement(ha.a,{control:o.a.createElement(En.a,{id:"average_time",type:"radio",value:"average_time",checked:"average_time"===n,onChange:h}),label:"Median"}),o.a.createElement(ha.a,{control:o.a.createElement(En.a,{id:"planning_time",type:"radio",value:"planning_time",checked:"planning_time"===n,onChange:h}),label:"Planning (".concat(ke,"th percentile)")}))),o.a.createElement(fn.m,{xType:"ordinal",height:300,width:400,margin:P,stackBy:"y",yDomain:[0,S+I],onMouseLeave:f},o.a.createElement(fn.f,null),o.a.createElement(fn.l,{tickLabelAngle:-90}),o.a.createElement(fn.n,{hideLine:!0}),o.a.createElement(fn.i,{data:v,color:Re[0],onNearestX:function(e,t){var a=t.index;u([v[a],E[a]])},stack:!0}),o.a.createElement(fn.i,{data:E,color:Re[1],stack:!0}),o.a.createElement(fn.h,{data:O,color:Re[2],strokeDasharray:"5, 5"}),o.a.createElement(fn.h,{data:T,color:Re[3],strokeDasharray:"5, 5"}),o.a.createElement(fn.b,{text:"minutes",className:"alt-y-label",includeMargin:!1,xPercent:.06,yPercent:.06,style:{transform:"rotate(-90)",textAnchor:"end"}}),s.length>0&&o.a.createElement(fn.c,{values:s,style:xe},o.a.createElement("div",{className:"rv-crosshair__inner__content"},o.a.createElement("p",null,"Onboard time:"," ",s[1]?Math.round(s[1].y):""),o.a.createElement("p",null,"Wait time: ",Math.round(s[0].y))))),o.a.createElement(bn.a,{orientation:"horizontal",width:300,items:R}),"On-Time %",o.a.createElement(fn.m,{xType:"ordinal",height:300,width:400,margin:P,yDomain:[0,100],onMouseLeave:f},o.a.createElement(fn.f,null),o.a.createElement(fn.l,{tickLabelAngle:-90}),o.a.createElement(fn.n,{hideLine:!0}),o.a.createElement(fn.g,{data:k,color:Re[0],onNearestX:L,stack:!0}),o.a.createElement(fn.b,{text:"Long Wait %",className:"alt-y-label",includeMargin:!1,xPercent:.06,yPercent:.06,style:{transform:"rotate(-90)",textAnchor:"end"}}),s.length>0&&!1),"Median Speed",o.a.createElement(fn.m,{xType:"ordinal",height:300,width:400,margin:P,yDomain:[0,x],onMouseLeave:f},o.a.createElement(fn.f,null),o.a.createElement(fn.l,{tickLabelAngle:-90}),o.a.createElement(fn.n,{hideLine:!0}),o.a.createElement(fn.g,{data:w,color:Re[1],onNearestX:L,stack:!0}),o.a.createElement(fn.b,{text:"Median Speed (mph)",className:"alt-y-label",includeMargin:!1,xPercent:.06,yPercent:.06,style:{transform:"rotate(-90)",textAnchor:"end"}}),s.length>0&&!1),"Travel Variability",o.a.createElement(fn.m,{xType:"ordinal",height:300,width:400,margin:P,yDomain:[0,C],onMouseLeave:f},o.a.createElement(fn.f,null),o.a.createElement(fn.l,{tickLabelAngle:-90}),o.a.createElement(fn.n,{hideLine:!0}),o.a.createElement(fn.g,{data:M,color:Re[1],onNearestX:L,stack:!0}),o.a.createElement(fn.b,{text:"Variability (\xb1 min)",className:"alt-y-label",includeMargin:!1,xPercent:.06,yPercent:.06,style:{transform:"rotate(-90)",textAnchor:"end"}}),s.length>0&&!1),"Score",o.a.createElement(fn.m,{xType:"ordinal",height:300,width:400,margin:P,yDomain:[0,j],onMouseLeave:f},o.a.createElement(fn.f,null),o.a.createElement(fn.l,{tickLabelAngle:-90}),o.a.createElement(fn.n,{hideLine:!0}),o.a.createElement(fn.g,{data:D,color:Re[2],onNearestX:L,stack:!0}),o.a.createElement(fn.b,{text:"Score",className:"alt-y-label",includeMargin:!1,xPercent:.06,yPercent:.06,style:{transform:"rotate(-90)",textAnchor:"end"}}),s.length>0&&!1)):o.a.createElement("code",null,"No data."))},Sn=function(e){function t(e){var a;return Object(I.a)(this,t),(a=Object(k.a)(this,Object(w.a)(t).call(this,e))).handleOptionChange=function(e){a.setState({selectedOption:e.target.value})},a.onMouseLeave=function(){a.setState({crosshairValues:[]})},a.onNearestX=function(e,t){var n=t.index;a.setState({crosshairValues:[a.waitData[n],a.tripData[n]]})},a.state={selectedOption:t.AVERAGE_TIME,crosshairValues:[]},a}return Object(M.a)(t,e),Object(R.a)(t,[{key:"mapInterval",value:function(e){var a=this;return function(n){var r=0;return null!=n[e]&&(r=a.state.selectedOption===t.AVERAGE_TIME?On(n[e],50):On(n[e],ke)),void 0===r&&(r=0),{x:"".concat(n.startTime," - ").concat(n.endTime),y:r}}}},{key:"render",value:function(){var e=this.props.tripMetrics,a=e.timeRanges,n=e.timeRanges2;this.waitData=a?a.map(this.mapInterval("waitTimes")):null,this.tripData=a?a.map(this.mapInterval("tripTimes")):null,this.waitData2=n?n.map(this.mapInterval("waitTimes")):null,this.tripData2=n?n.map(this.mapInterval("tripTimes")):null;var r=[{title:"Travel time",color:Re[1],strokeWidth:10},{title:"Wait time",color:Re[0],strokeWidth:10}];return o.a.createElement("div",null,a?o.a.createElement("div",null,o.a.createElement(ua.a,null,o.a.createElement("div",{className:"controls"},o.a.createElement(ha.a,{control:o.a.createElement(En.a,{id:"average_time",type:"radio",value:t.AVERAGE_TIME,checked:this.state.selectedOption===t.AVERAGE_TIME,onChange:this.handleOptionChange}),label:"Median"}),o.a.createElement(ha.a,{control:o.a.createElement(En.a,{id:"planning_time",type:"radio",value:t.PLANNING_TIME,checked:this.state.selectedOption===t.PLANNING_TIME,onChange:this.handleOptionChange}),label:"Planning (".concat(ke,"th percentile)")}))),o.a.createElement(fn.m,{xType:"ordinal",height:300,width:400,stackBy:"y",onMouseLeave:this.onMouseLeave},o.a.createElement(fn.f,null),o.a.createElement(fn.l,null),o.a.createElement(fn.n,{hideLine:!0}),o.a.createElement(fn.i,{cluster:"first",data:this.waitData,color:Re[0],onNearestX:this.onNearestX}),o.a.createElement(fn.i,{cluster:"first",data:this.tripData,color:Re[1]}),this.waitData2?o.a.createElement(fn.i,{cluster:"second",data:this.waitData2,color:Re[2],onNearestX:this.onNearestX}):null,this.waitData2?o.a.createElement(fn.i,{cluster:"second",data:this.tripData2,color:Re[3]}):null,o.a.createElement(fn.b,{text:"minutes",className:"alt-y-label",includeMargin:!1,xPercent:.06,yPercent:.06,style:{transform:"rotate(-90)",textAnchor:"end"}}),this.state.crosshairValues.length>0&&o.a.createElement(fn.c,{values:this.state.crosshairValues,style:xe},o.a.createElement("div",{className:"rv-crosshair__inner__content"},o.a.createElement("p",null,"Onboard time:"," ",Math.round(this.state.crosshairValues[1].y)),o.a.createElement("p",null,"Wait time: ",Math.round(this.state.crosshairValues[0].y))))),o.a.createElement(bn.a,{orientation:"horizontal",width:300,items:r})):null)}}]),t}(i.Component);Sn.AVERAGE_TIME="average_time",Sn.PLANNING_TIME="planning_time";var In=Sn,Rn=a(75),kn=a.n(Rn),wn=a(116),xn=a.n(wn);var Mn=function(e){var t=Object(i.useState)([]),a=Object(Y.a)(t,2),n=a[0],r=a[1],l=function(e){r([e])},c=e.firstWaits,s=e.secondWaits,u=e.firstTravels,d=e.secondTravels,m=[{title:o.a.createElement(i.Fragment,null,o.a.createElement(kn.a,{fontSize:"small",style:{verticalAlign:"sub"}}),"\xa0Travel"),color:Re[1],strokeWidth:10},{title:o.a.createElement(i.Fragment,null,o.a.createElement(xn.a,{fontSize:"small",style:{verticalAlign:"sub"}}),"\xa0Wait"),color:Re[0],strokeWidth:10}];return o.a.createElement("div",null,o.a.createElement("div",{style:{display:"flex"}},o.a.createElement(fn.m,{xType:"ordinal",height:125,width:175,margin:{left:40,right:10,top:0,bottom:30},stackBy:"y",onMouseLeave:function(){r([])}},o.a.createElement(fn.f,null),o.a.createElement(fn.l,null),o.a.createElement(fn.n,{hideLine:!0}),o.a.createElement(fn.i,{cluster:"first",color:Re[0],onValueMouseOver:l,data:[{x:"Typical",y:c[0]},{x:"Planning",y:c[1]}]}),o.a.createElement(fn.i,{cluster:"first",color:Re[1],onValueMouseOver:l,data:[{x:"Typical",y:u[0]},{x:"Planning",y:u[1]}]}),o.a.createElement(fn.i,{cluster:"second",color:Re[2],onValueMouseOver:l,data:[{x:"Typical",y:s[0]},{x:"Planning",y:s[1]}]}),o.a.createElement(fn.i,{cluster:"second",color:Re[3],onValueMouseOver:l,data:[{x:"Typical",y:d[0]},{x:"Planning",y:d[1]}]}),o.a.createElement(fn.b,{text:"minutes",className:"alt-y-label",includeMargin:!1,xPercent:0,yPercent:.06,style:{transform:"rotate(-90)",textAnchor:"end"}}),n.length>0&&o.a.createElement(fn.c,{values:n,style:xe},o.a.createElement("div",{className:"rv-crosshair__inner__content"},Math.round(n[0].y-(n[0].y0?n[0].y0:0))," ","min"))),o.a.createElement(bn.a,{orientation:"vertical",width:110,items:m})))},Cn=a(393);function Dn(e){var t=e.score,a=e.hideRating,n=e.title,r=e.largeValue,l=e.smallValue,c=e.bottomContent,s=e.popoverContent,u=Object(tt.a)((function(e){return{popover:{padding:e.spacing(2),maxWidth:500}}}))(),d=Object(i.useState)(null),p=Object(Y.a)(d,2),h=p[0],f=p[1];var g={background:null!=t?le(t):"gray",color:null!=t?se(t):"black",margin:4},v=null!=t?Math.max(Math.round(t/10)/2,.5):0;return o.a.createElement(i.Fragment,null,o.a.createElement(m.a,{item:!0,xs:!0,component:sn.a,style:g},o.a.createElement(Zt.a,{display:"flex",flexDirection:"column",justifyContent:"flex-start",height:"100%"},o.a.createElement(mt.a,{variant:"overline"},n),o.a.createElement(Zt.a,{flexGrow:1}," ",o.a.createElement(mt.a,{variant:"h3",display:"inline"},r),o.a.createElement(mt.a,{variant:"h5",display:"inline"},l),a?null:o.a.createElement(Cn.a,{readOnly:!0,size:"small",value:v,precision:.5})),o.a.createElement(Zt.a,{display:"flex",justifyContent:"space-between",alignItems:"flex-end",pt:2},c,o.a.createElement(pt.a,{size:"small",onClick:function(e){f(e.currentTarget)}},o.a.createElement(Et.a,{fontSize:"small"}))))),o.a.createElement(it.a,{open:Boolean(h),anchorEl:h,onClose:function(){f(null)},anchorOrigin:{vertical:"bottom",horizontal:"center"},transformOrigin:{vertical:"top",horizontal:"center"}},o.a.createElement("div",{className:u.popover},s)))}function jn(e){var t=e.rows;return o.a.createElement(ot.a,null,o.a.createElement(lt.a,null,t.map((function(e){return o.a.createElement(ut.a,{key:e.value},o.a.createElement(ct.a,null,e.label),o.a.createElement(ct.a,{align:"right",style:{color:se(e.value),backgroundColor:le(e.value)}},e.value))}))))}function Pn(e){var t=Object(i.useState)(null),a=Object(Y.a)(t,2),n=a[0],r=a[1],l=Object(i.useState)(null),c=Object(Y.a)(l,2),s=c[0],u=c[1];function d(e){r(e.currentTarget)}function p(e){u(e.currentTarget)}var h=e.tripMetrics,f=e.graphParams,g=e.routes,v=h?h.interval.waitTimes:null,E=h?h.interval.tripTimes:null,y=h?h.interval.departureScheduleAdherence:null,b=h&&h.interval2?h.interval2.waitTimes:null,O=h&&h.interval2?h.interval2.tripTimes:null,T=h&&h.interval2?h.interval2.departureScheduleAdherence:null,S=g?function(e,t){if(e&&e.endStopId){var a=e.directionId,n=e.routeId,r=t.find((function(e){return e.id===n})),i=r.directions.find((function(e){return e.id===a}));return he(r,i,e.startStopId,e.endStopId)}return 0}(f,g):null,I=E&&E.count>0&&S?S/(E.avg/60):0,R=O&&O.count>0&&S?S/(O.avg/60):0,k=y&&y.scheduledCount>0?y.onTimeCount/y.scheduledCount:null,w=T&&T.scheduledCount>0?T.onTimeCount/T.scheduledCount:null,x=null;E&&(x=On(E,ke)-On(E,we));var M=0;O&&(M=On(O,ke)-On(O,we));var C=I&&v.median?re(v.median,k,I,x):null,D=R&&b.median?re(b.median,w,R,M):{},j=null;S?E&&E.count?I?v.median||(j="No median wait time available."):j="Unable to determine speed between selected stops.":j="No trip data between selected stops.":j="Unable to determine distance between selected stops.";var P=Object(tt.a)((function(e){return{uncolored:{margin:e.spacing(1)},popover:{padding:e.spacing(2),maxWidth:500}}}))(),L=Math.round(On(v,ke)),N=Math.round(On(E,ke)),A=b?Math.round(On(b,ke)):null,_=O?Math.round(On(O,ke)):null,W=Math.round(v.median),F=Math.round(E.median),V=b?Math.round(b.median):null,z=b?Math.round(O.median):null,U=o.a.createElement(i.Fragment,null,"Trip score of ",C.totalScore," is the average of the following subscores:",o.a.createElement(Zt.a,{pt:2},o.a.createElement(ot.a,null,o.a.createElement(lt.a,null,o.a.createElement(ut.a,null,o.a.createElement(ct.a,null,"Median wait"),o.a.createElement(ct.a,{align:"right"},C.medianWaitScore)),o.a.createElement(ut.a,null,o.a.createElement(ct.a,null,"Long wait probability"),o.a.createElement(ct.a,{align:"right"},C.longWaitScore)),o.a.createElement(ut.a,null,o.a.createElement(ct.a,null,"Speed for median trip"),o.a.createElement(ct.a,{align:"right"}," ",C.speedScore)),o.a.createElement(ut.a,null,o.a.createElement(ct.a,null,"Travel time variability"),o.a.createElement(ct.a,{align:"right"}," ",C.travelVarianceScore)))))),B=o.a.createElement(i.Fragment,null,"Median wait of"," ",v&&null!=v.median?v.median.toFixed(1):"--"," ","min gets a score of ",C.medianWaitScore,".",o.a.createElement(Zt.a,{pt:2},o.a.createElement(jn,{rows:[{label:"5 min or less",value:100},{label:"6.25 min",value:75},{label:"7.5 min",value:50},{label:"8.75",value:25},{label:"10 min or more",value:0}]}))),$=o.a.createElement(i.Fragment,null,"The on-time percentage is the percentage of scheduled departure times where a vehicle departed less than 5 minutes after the scheduled departure time or less than 1 minute before the scheduled departure time. Probability of"," ",(100*k).toFixed(1),"% gets a score of ",C.onTimeRateScore,"."),q=o.a.createElement(i.Fragment,null,"Speed for median trip of ",I.toFixed(1)," mph gets a score of"," ",C.speedScore,".",o.a.createElement(Zt.a,{pt:2},o.a.createElement(jn,{rows:[{label:"10 mph or more",value:100},{label:"8.75 mph",value:75},{label:"7.5 mph",value:50},{label:"6.25 mph",value:25},{label:"5 mph or less",value:0}]}))),H=o.a.createElement(i.Fragment,null,"Travel time variability is the difference between the 90th percentile travel time and the 10th percentile travel time. This measures how much extra travel time is needed for some trips. Variability of"," ","\xb1".concat((x/2).toFixed(1))," min gets a score of"," ",C.travelVarianceScore,".",o.a.createElement(Zt.a,{pt:2},o.a.createElement(jn,{rows:[{label:"5 min or less",value:100},{label:"6.25 min",value:75},{label:"7.5 min",value:50},{label:"8.75 min",value:25},{label:"10 min or more",value:0}]})));return o.a.createElement(i.Fragment,null,o.a.createElement("div",{style:{padding:8}},C?o.a.createElement(i.Fragment,null,o.a.createElement(m.a,{container:!0,spacing:4},b?o.a.createElement(i.Fragment,null,o.a.createElement(m.a,{item:!0,xs:!0,component:sn.a,className:P.uncolored},o.a.createElement(mt.a,{variant:"overline"},"Journey Times"),o.a.createElement("br",null),o.a.createElement(Mn,{firstWaits:[W,L],secondWaits:[V,A],firstTravels:[F,N],secondTravels:[z,_]}))):o.a.createElement(i.Fragment,null,o.a.createElement(m.a,{item:!0,xs:!0,component:sn.a,className:P.uncolored},o.a.createElement(mt.a,{variant:"overline"},"Typical journey"),o.a.createElement("br",null),o.a.createElement(mt.a,{variant:"h3",display:"inline"},W+F),o.a.createElement(mt.a,{variant:"h5",display:"inline"},"\xa0min"),o.a.createElement(Zt.a,{display:"flex",justifyContent:"space-between",alignItems:"flex-end",pt:2},o.a.createElement(mt.a,{variant:"body1"},o.a.createElement(xn.a,{fontSize:"small",style:{verticalAlign:"sub"}}),"\xa0",W," min",o.a.createElement("br",null),o.a.createElement(kn.a,{fontSize:"small",style:{verticalAlign:"sub"}}),"\xa0",F," min"),o.a.createElement(pt.a,{size:"small",onClick:d},o.a.createElement(Et.a,{fontSize:"small"})))),o.a.createElement(m.a,{item:!0,xs:!0,component:sn.a,className:P.uncolored},o.a.createElement(mt.a,{variant:"overline"},"Journey planning"),o.a.createElement("br",null),o.a.createElement(mt.a,{variant:"h3",display:"inline"},L+N),o.a.createElement(mt.a,{variant:"h5",display:"inline"},"\xa0min"),o.a.createElement(Zt.a,{display:"flex",justifyContent:"space-between",alignItems:"flex-end",pt:2},o.a.createElement(mt.a,{variant:"body1"},o.a.createElement(xn.a,{fontSize:"small",style:{verticalAlign:"sub"}}),"\xa0",L," min",o.a.createElement("br",null),o.a.createElement(kn.a,{fontSize:"small",style:{verticalAlign:"sub"}}),"\xa0",N," min"),o.a.createElement(pt.a,{size:"small",onClick:p},o.a.createElement(Et.a,{fontSize:"small"}))))),o.a.createElement(Dn,{score:C.totalScore,title:"Trip Score",hideRating:!0,largeValue:null!=C.totalScore?C.totalScore:"--",smallValue:"".concat(b?" vs ".concat(D.totalScore):"","/").concat(ie),bottomContent:"\xa0",popoverContent:U}),o.a.createElement(Dn,{score:C.medianWaitScore,title:"Median Wait",hideRating:b,largeValue:Math.round(v.median),smallValue:"".concat(b?" vs ".concat(Math.round(b.median)):"","\xa0min"),bottomContent:"\xa0",popoverContent:B}),o.a.createElement(Dn,{score:C.onTimeRateScore,title:"On-Time %",hideRating:b,largeValue:Math.round(100*k),smallValue:"".concat(b?" vs ".concat(Math.round(100*w)):"","%"),bottomContent:y?"".concat(y.onTimeCount," times out of ").concat(y.scheduledCount):null,popoverContent:$}),o.a.createElement(Dn,{score:C.speedScore,title:"Median Trip Speed",hideRating:O,largeValue:I.toFixed(0),smallValue:"".concat(O?" vs ".concat(R.toFixed(0)):"","\xa0mph"),bottomContent:"".concat(null!=S?S.toFixed(1):"--"," miles"),popoverContent:q}),o.a.createElement(Dn,{score:C.travelVarianceScore,title:"Travel Time Variability",hideRating:O,largeValue:null!=x?"\xb1".concat((x/2).toFixed(0)):"-",smallValue:"".concat(O?" vs \xb1".concat((M/2).toFixed(0)):"","\xa0min"),bottomContent:"\xa0",popoverContent:H})),o.a.createElement(it.a,{open:Boolean(n),anchorEl:n,onClose:function(){r(null)},anchorOrigin:{vertical:"bottom",horizontal:"center"},transformOrigin:{vertical:"top",horizontal:"center"}},o.a.createElement("div",{className:P.popover},"This is the median wait time when a rider arrives randomly at a stop or a rider starts checking predictions. This is combined with the median trip time.")),o.a.createElement(it.a,{open:Boolean(s),anchorEl:s,onClose:function(){u(null)},anchorOrigin:{vertical:"bottom",horizontal:"center"},transformOrigin:{vertical:"top",horizontal:"center"}},o.a.createElement("div",{className:P.popover},"When planning to arrive by a specific time, the 90th percentile wait time and 90th percentile travel time suggest how far in advance to start checking predictions. Walking time should also be added."))):"No trip summary (".concat(j,")")))}var Ln=function(e){var t=o.a.useState({}),a=Object(Y.a)(t,2),n=a[0],r=a[1],i=o.a.useState(0),l=Object(Y.a)(i,2),c=l[0],s=l[1],u=e.tripMetrics,d=e.tripMetricsError,m=e.tripMetricsLoading,p=e.graphParams,f=e.routes,g=u?u.interval.headways:null,v=u?u.interval.waitTimes:null,E=u?u.interval.tripTimes:null,y=u?u.byDay:null,b=u&&u.interval2?u.interval2.headways:null,O=u&&u.interval2?u.interval2.waitTimes:null,T=u&&u.interval2?u.interval2.tripTimes:null,S=g&&g.histogram?g.histogram.map((function(e){return{x0:e.binStart,x:e.binEnd,y:e.count}})):null,I=v&&v.histogram?v.histogram.map((function(e){return{x0:e.binStart,x:e.binEnd,y:e.count}})):null,R=E&&E.histogram?E.histogram.map((function(e){return{x0:e.binStart,x:e.binEnd,y:e.count}})):null,k=b&&b.histogram?b.histogram.map((function(e){return{x0:e.binStart,x:e.binEnd,y:e.count}})):null,w=O&&O.histogram?O.histogram.map((function(e){return{x0:e.binStart,x:e.binEnd,y:e.count}})):null,x=T&&T.histogram?T.histogram.map((function(e){return{x0:e.binStart,x:e.binEnd,y:e.count}})):null;function M(){r({})}function C(e,t){var a=t.index;r({headway:[S[a]]})}function D(e){return{id:"simple-tab-".concat(e),"aria-controls":"simple-tabpanel-".concat(e)}}return o.a.createElement("div",null,o.a.createElement("br",null),o.a.createElement(h.a,{position:"static",color:"default"},o.a.createElement(gn.a,{value:c,onChange:function(e,t){s(t)},"aria-label":"tab bar",variant:"scrollable",scrollButtons:"on"},o.a.createElement(vn.a,Object.assign({style:{minWidth:72},label:"Summary"},D(0))),o.a.createElement(vn.a,Object.assign({style:{minWidth:72},label:"By Day"},D(1))),o.a.createElement(vn.a,Object.assign({style:{minWidth:72},label:"By Time of Day"},D(2))),o.a.createElement(vn.a,Object.assign({style:{minWidth:72},label:"Headways"},D(3))),o.a.createElement(vn.a,Object.assign({style:{minWidth:72},label:"Wait Times"},D(4))),o.a.createElement(vn.a,Object.assign({style:{minWidth:72},label:"Trip Times"},D(5))))),g&&f?o.a.createElement("div",null,o.a.createElement(Zt.a,{p:2,hidden:0!==c},o.a.createElement(Pn,{tripMetrics:u,graphParams:p,routes:f})),o.a.createElement(Zt.a,{p:2,hidden:1!==c},o.a.createElement(mt.a,{variant:"h5",display:"inline"},"Performance by Day"),o.a.createElement(Tn,{byDayData:y,graphParams:p,routes:f})),o.a.createElement(Zt.a,{p:2,hidden:2!==c},o.a.createElement(mt.a,{variant:"h5",display:"inline"},"Performance by Time of Day"),o.a.createElement(In,{tripMetrics:u})),o.a.createElement(Zt.a,{p:2,hidden:3!==c},o.a.createElement(mt.a,{variant:"h5",display:"inline"},"Headways (Time Between Vehicles)"),o.a.createElement("p",null,g.count+1," arrivals, median headway"," ",Math.round(g.median)," minutes, max headway"," ",Math.round(g.max)," minutes"),o.a.createElement(fn.m,{xDomain:[0,Math.max(60,Math.round(g.max)+5)],height:200,width:400,onMouseLeave:M},o.a.createElement(fn.f,null),o.a.createElement(fn.l,null),o.a.createElement(fn.n,{hideLine:!0}),o.a.createElement(fn.k,{cluster:"first",data:S,onNearestX:C,stroke:"white",fill:Re[0],style:{strokeWidth:2}}),k?o.a.createElement(fn.i,{cluster:"second",data:k,onNearestX:C,stroke:"white",fill:Re[2],style:{strokeWidth:2}}):null,o.a.createElement(fn.b,{text:"arrivals",className:"alt-y-label",includeMargin:!1,xPercent:.06,yPercent:.06,style:{transform:"rotate(-90)",textAnchor:"end"}}),o.a.createElement(fn.b,{text:"minutes",className:"alt-x-label",includeMargin:!1,xPercent:.9,yPercent:.94}),n.headway&&o.a.createElement(fn.c,{values:n.headway,style:xe},o.a.createElement("div",{className:"rv-crosshair__inner__content"},"Arrivals: ",Math.round(n.headway[0].y)))))):null,v?o.a.createElement(Zt.a,{p:2,hidden:4!==c},o.a.createElement(mt.a,{variant:"h5",display:"inline"},"Wait Times"),o.a.createElement("p",null,"median wait time ",Math.round(v.median)," minutes, max wait time ",Math.round(v.max)," minutes"),o.a.createElement(fn.m,{xDomain:[0,Math.max(60,Math.round(v.max)+5)],height:200,width:400,onMouseLeave:M},o.a.createElement(fn.f,null),o.a.createElement(fn.l,null),o.a.createElement(fn.n,{hideLine:!0,tickFormat:function(e){return"".concat(e,"%")}}),o.a.createElement(fn.k,{cluster:"first",data:I,onNearestX:function(e,t){var a=t.index;r({wait:[I[a]]})},stroke:"white",fill:Re[0],style:{strokeWidth:2}}),w?o.a.createElement(fn.i,{cluster:"second",data:w,onNearestX:C,stroke:"white",fill:Re[2],style:{strokeWidth:2}}):null,o.a.createElement(fn.b,{text:"chance",className:"alt-y-label",includeMargin:!1,xPercent:.06,yPercent:.06,style:{transform:"rotate(-90)",textAnchor:"end"}}),o.a.createElement(fn.b,{text:"minutes",className:"alt-x-label",includeMargin:!1,xPercent:.9,yPercent:.94}),n.wait&&o.a.createElement(fn.c,{values:n.wait,style:xe},o.a.createElement("div",{className:"rv-crosshair__inner__content"},"Chance: ",Math.round(n.wait[0].y),"%")))):null,E?o.a.createElement(Zt.a,{p:2,hidden:5!==c},o.a.createElement(mt.a,{variant:"h5",display:"inline"},"Trip Times"),o.a.createElement("p",null,E.count," trips, median ",Math.round(E.median)," ","minutes, max ",Math.round(E.max)," minutes"),o.a.createElement(fn.m,{xDomain:[0,Math.max(60,Math.round(E.max)+5)],height:200,width:400,onMouseLeave:M},o.a.createElement(fn.f,null),o.a.createElement(fn.l,null),o.a.createElement(fn.n,{hideLine:!0}),o.a.createElement(fn.k,{cluster:"first",data:R,onNearestX:function(e,t){var a=t.index;r({trip:[R[a]]})},stroke:"white",fill:Re[1],style:{strokeWidth:2}}),x?o.a.createElement(fn.i,{cluster:"second",data:x,onNearestX:C,stroke:"white",fill:Re[3],style:{strokeWidth:2}}):null,o.a.createElement(fn.b,{text:"trips",className:"alt-y-label",includeMargin:!1,xPercent:.06,yPercent:.06,style:{transform:"rotate(-90)",textAnchor:"end"}}),o.a.createElement(fn.b,{text:"minutes",className:"alt-x-label",includeMargin:!1,xPercent:.9,yPercent:.94}),n.trip&&o.a.createElement(fn.c,{values:n.trip,style:xe},o.a.createElement("div",{className:"rv-crosshair__inner__content"},"Trips: ",Math.round(n.trip[0].y))))):null,d?o.a.createElement(Zt.a,{p:2},o.a.createElement("code",null,"Error: ",d)):null,m?o.a.createElement(Zt.a,{p:2},"Loading..."):null)},Nn=a(139),An=a.n(Nn),_n=a(397),Wn=a(218),Fn=a.n(Wn),Vn=function(e){function t(e){var a;return Object(I.a)(this,t),(a=Object(k.a)(this,Object(w.a)(t).call(this,e))).populateStop=function(e,t,n,r,i,l){var c=null,s=a.props.theme.palette.primary;return c=t?V.a.divIcon({className:"custom-icon",iconSize:[240,24],iconAnchor:[12,12],html:"".concat('<svg width="24" height="24" viewBox="-10 -10 10 10">'+'<circle cx="-5" cy="-5" r="4.5" fill="white" stroke="'.concat(s.main,'" stroke-width="0.75"/>')+'</svg><div style="position:relative; top: -26px; left:2px">',"\n              ").concat(Fn.a.renderToString(o.a.createElement(d.a,{theme:a.props.theme},o.a.createElement(t,{color:"primary",fontSize:"small"}))),"\n          </div>")+'<div style="position:relative; top:-50px; left:25px; font-weight:bold; color:'.concat(s.main,"; ")+"text-shadow: -1px 1px 0 #fff,1px 1px 0 #fff,1px -1px 0 #fff,"+'-1px -1px 0 #fff;">'.concat(e.title,"</div>")}):V.a.divIcon({className:"id".concat(e.id),iconSize:[20,20],iconAnchor:[10,10],html:'<svg viewBox="-10 -10 10 10"><g transform="rotate('.concat(r,' -5 -5)">')+'<circle cx="-5" cy="-5" r="3" fill="white" stroke="'.concat(s.dark,'" stroke-width="0.75"/>')+'<polyline points="-5.5,-6 -4,-5 -5.5,-4" stroke-linecap="round" stroke-linejoin="round"\n            stroke="'.concat(s.dark,'" stroke-width="0.6" fill="none"/>')+"</g></svg>"}),o.a.createElement(P.a,{key:"".concat(e.id,"-marker"),position:n,icon:c,onClick:function(e){e.sourceTarget.closeTooltip(),i()}},l)},a.angleFromTo=function(e,t){var a=t.lon-e.lon,n=e.lat-t.lat;return Math.round(180*Math.atan2(n,a)/Math.PI)},a.populateStops=function(e,t){var n=t.stops,r=t.id;return n.map((function(n){var i=e.stops[n],l=[i.lat,i.lon],c=n===a.props.graphParams.startStopId,s=n===a.props.graphParams.endStopId,u=o.a.createElement(N.a,null,i.title,o.a.createElement("br",null),t.title),d=null;c?d=kn.a:s&&(d=An.a);var m=0,p=t.stop_geometry[i.id];if(p){var h=t.coords[p.after_index],f=t.coords[p.after_index+1];m=a.angleFromTo(h,f)}return a.populateStop(i,d,l,m,(function(){return a.handleStopSelect(i,r)}),u)}))},a.populateSpeed=function(e,t){for(var n=t.id,r=t.stops,i=[],l=a.props.graphParams,c=t.loop?r.length:r.length-1,s=l.startStopId?r.indexOf(l.startStopId):-1,u=l.endStopId?r.indexOf(l.endStopId):-1,d=0;d<c;d++){var m=r[d],p=r[(d+1)%r.length],h=e.stops[p],f=a.getSpeed(e,t,m,p),g="white",v=12;-1!==s&&-1!==u&&(t.loop&&s>=u?d>=s||d<u:d>=s&&d<u)&&(g=a.props.theme.palette.primary.main,v=14);var E=pe(e,t,m,p);i.push(o.a.createElement(A.a,{key:"poly-speed-white-".concat(n,"-").concat(m),positions:E,color:g,opacity:1,weight:v})),i.push(o.a.createElement(A.a,{key:"poly-speed-".concat(n,"-").concat(m),positions:E,color:f<0?"white":a.speedColor(f),opacity:1,weight:7,onClick:function(e){e.originalEvent.view.L.DomEvent.stopPropagation(e)}},o.a.createElement(N.a,null,f<0?"?":f.toFixed(1)," mph to ",h.title)))}return i},a.getSpeed=function(e,t,n,r){var i=a.props.segmentMetricsMap,o=i?i[t.id]:null,l=o?o[n]:null;if(!l||l.toStopId!==r)return-1;var c=l.medianTripTime,s=he(e,t,n,r);return c>0?s/c*60:-1},a.SpeedLegend=function(){var e=[2.5,6.25,8.75,12.5],t=[" < 5","5-7.5","7.5-10","10+"],n=e.map((function(n){return o.a.createElement("div",{key:n},o.a.createElement("i",{style:{backgroundColor:a.speedColor(n),width:18,float:"left"}},"\xa0")," ","\xa0",t[e.indexOf(n)])}));return o.a.createElement(U.a,{position:"bottomright"},o.a.createElement("div",{style:{backgroundColor:"white",padding:"5px"}},"Speed (mph)",n))},a.handleStopSelect=function(e,t){var n=a.props.graphParams,r=n.routeId,i=n.startStopId,o=n.endStopId,l=n.directionId;if(i)if(o)i=e.id,o=null,l=t;else if(l!==t)i=e.id,o=null,l=t;else{var c=a.props.routes.find((function(e){return e.id===r})).directions.find((function(e){return e.id===l})),s=c.stops;!c.loop&&s.indexOf(e.id)<s.indexOf(i)?(o=i,i=e.id):o=e.id}else i=e.id,o=null,l=t;a.props.dispatch({type:"ROUTESCREEN",payload:{routeId:r,directionId:l,startStopId:i,endStopId:o},query:a.props.query})},a.agency=E[0],a.state={height:a.computeHeight()},a}return Object(M.a)(t,e),Object(R.a)(t,[{key:"componentDidMount",value:function(){this.boundUpdate=this.updateDimensions.bind(this),window.addEventListener("resize",this.boundUpdate)}},{key:"componentWillUnmount",value:function(){window.removeEventListener("resize",this.updateDimensions.bind(this))}},{key:"computeHeight",value:function(){return(window.innerWidth>=640?window.innerHeight:window.innerHeight/2)-64-50}},{key:"updateDimensions",value:function(){var e=this.computeHeight();this.setState({height:e})}},{key:"speedColor",value:function(e){return B.b().domain([2.5,12.5]).range(["#8d1212","#e60000","#f07d02","#84ca50"])(e)}},{key:"render",value:function(){var e=this,t=this.props,a=t.position,n=t.zoom,r={width:"100%",height:this.state.height},i=this.props,l=i.routes,c=i.graphParams,s=null,u=[];l&&c&&(s=l.find((function(e){return e.id===c.routeId})))&&s.directions.forEach((function(t){c.directionId&&c.directionId!==t.id||(u.push(e.populateStops(s,t)),u.unshift(e.populateSpeed(s,t)))}));var d=c.directionId?c.startStopId?c.endStopId?"":"Click a destination stop.":"Click an origin stop.":"Select a direction to see stops in that direction.";return o.a.createElement(_.a,{center:a||this.agency.initialMapCenter,bounds:s?s.bounds:null,zoom:n||this.agency.initialMapZoom,style:r},o.a.createElement(W.a,{attribution:'Map tiles by <a href="http://stamen.com">Stamen Design</a>, under <a href="http://creativecommons.org/licenses/by/3.0">CC BY 3.0</a>. Data by <a href="http://openstreetmap.org">OpenStreetMap</a>, under <a href="http://www.openstreetmap.org/copyright">ODbL</a>.',url:"https://stamen-tiles.a.ssl.fastly.net/toner-lite/{z}/{x}/{y}.png",opacity:.3}),u,o.a.createElement(this.SpeedLegend,null),o.a.createElement(U.a,{position:"topright"},c.startStopId&&c.endStopId?null:o.a.createElement("div",{className:"map-instructions"},d)))}}]),t}(i.Component),zn=Object(s.connect)((function(e){return{graphParams:e.graphParams,segmentMetricsMap:e.routeMetrics.segmentsMap,query:e.location.query}}),(function(e){return{handleGraphParams:function(t){return e(He(t))},dispatch:e}}))(Object(_n.a)(Vn)),Un=a(26),Bn=a(226),$n=a(368),qn=a(314),Yn=a(220),Hn=a.n(Yn);function Gn(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function Jn(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?Gn(a,!0).forEach((function(t){Object(Ze.a)(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):Gn(a).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}var Xn=350,Qn=30,Zn=Object(u.a)({palette:{background:{focus:"rgba(0, 0, 0, 0.05)"}}}),Kn=Object(tt.a)({input:{display:"flex","&:focus":{backgroundColor:Zn.palette.background.focus}},selectInput:{minWidth:"100%"},valueContainer:{display:"flex",flex:1,alignItems:"center",minWidth:0,maxWidth:"100%"},textContent:{display:"flex",flex:1,whiteSpace:"nowrap"},placeholder:{color:"hsl(0, 0%, 75%)"},menu:{position:"absolute",zIndex:1200}}),er={dropdownIndicator:function(e){return Jn({},e,{paddingLeft:0,paddingRight:0})},input:function(e,t){return Jn({},e,{marginLeft:0,marginRight:0,maxWidth:"100%",overflow:"hidden",minWidth:t.minWidth})}};function tr(e){var t,a=e.children,n=e.innerProps,r=e.selectProps,i=r.labelRef,l=r.textRef,c=r.classes,s=r.textFieldProps,u=s.InputLabelProps;return u.ref=i,o.a.createElement(pa.a,{ref:l,fullWidth:!0,InputProps:{inputComponent:"div",inputProps:Jn({children:a},n,{className:c.input,tabIndex:0,onKeyUp:(t=e,function(e){"Enter"!==e.key&&"ArrowDown"!==e.key||(t.selectProps.selectRef.current.focus(),t.selectProps.setMenuIsOpen(!0))})})},label:s.label,InputLabelProps:u})}function ar(e){var t=e.children,a=e.selectProps.classes,n=t[1],r=t[0];return o.a.createElement("div",{className:a.valueContainer},[n,r])}function nr(e){var t=e.selectProps,a=t.setTextFieldDOMRect,n=t.textRef;return function(){return a(n.current.getBoundingClientRect())}}function rr(e){var t=e.onChange,a=e.selectProps.setInputMinWidth;return function(e){t(e),e.target.value?(a("100%"),e.target.style.minWidth="100%"):a(0)}}function ir(e){return o.a.createElement(Un.z.Input,Object.assign({},e,{tabIndex:-1,minWidth:e.selectProps.inputMinWidth,className:e.selectProps.classes.selectInput,onKeyUp:nr(e),onChange:rr(e),onBlur:(t=e,function(e){t.onBlur(e),t.selectProps.setInputMinWidth(0)})}));var t}function or(e){var t=e.children,a=e.selectProps.classes;return o.a.createElement("div",{className:"".concat(a.textContent," ").concat(a.placeholder)},t)}function lr(e){return o.a.createElement("div",{className:e.selectProps.classes.textContent},e.children)}function cr(e){return o.a.createElement(Un.z.DropdownIndicator,e,o.a.createElement(Hn.a,{color:"action"}))}function sr(e){var t=e.children,a=e.innerProps,n=e.selectProps,r=n.classes,l=n.focusedOptionRef,c=n.labelRef,s=n.menuRef,u=n.menuIsOpenTransition,d=n.menuPlacementTop,m=n.menuTransition,p=n.textFieldDOMRect,h={},f=m.current?Xn:0,g=Object(i.useState)(0),v=Object(Y.a)(g,2),E=v[0],y=v[1],b=Object(i.useState)(0),O=Object(Y.a)(b,2),T=O[0],S=O[1];return d.current=p.top>document.documentElement.clientHeight-p.bottom,E&&(h.right=E),T&&(h.bottom=T),Object(i.useEffect)((function(){var e=c.current.clientHeight,t=p.height+e,a=p.left+s.current.clientWidth>window.innerWidth,n=p.right-s.current.clientWidth<0,r=p.right-document.documentElement.clientWidth;a&&!n?E!==r&&y(r):E&&y(0),d.current?T!==t&&S(t):T&&S(0),l.current&&(l.current.parentNode.scrollTop=l.current.offsetTop-s.current.clientHeight/2+l.current.clientHeight/2)}),[l,c,s,d,T,E,p]),o.a.createElement(qn.a,{in:u,timeout:f,style:{transformOrigin:"0 0 0"}},o.a.createElement($n.a,{in:u,timeout:f},o.a.createElement(sn.a,Object.assign({ref:s,style:h,className:r.menu},a),t)))}function ur(e){var t,a=e.children,n=e.selectProps,r=n.labelRef,i=n.menuPlacementTop,l=n.textFieldDOMRect,c=document.documentElement.clientHeight-Zn.spacing(2);return(t=i.current?l.top-r.current.clientHeight-Zn.spacing(2):document.documentElement.clientHeight-l.bottom-Zn.spacing(2))>c&&(t=c),o.a.createElement(Un.z.MenuList,Object.assign({},e,{maxHeight:t}),a)}function dr(e){var t=e.innerRef,a=e.isSelected,n=e.selectProps.focusedOptionRef;return function(e){a&&(n.current=e),t&&t(e)}}function mr(e){var t=e.children,a=e.innerProps,n=e.isFocused,r=e.isSelected,i=e.data,l=i.label,c=i.value.icon,s=e.selectProps,u=s.handleItemMouseOver,d=s.handleItemMouseOut,m={};return n?(u(c,l),r||(m.backgroundColor=Zn.palette.action.hover)):d(c),o.a.createElement(sa.a,Object.assign({ref:dr(e),selected:r,style:m},a),t)}function pr(e,t,a,n){var r=e;return function(){r.current=!0,t(!0),a(!0),n()}}function hr(e,t,a,n){var r=e;return function(){r.current=!0,document.activeElement.blur(),t(!1),setTimeout((function(){return a(!1)}),Xn),n()}}var fr={};function gr(e,t,a,n,r){return fr["".concat(t).concat(e)]=function(){clearTimeout(window["".concat(t,"Timeout")]),window["".concat(t,"Timeout")]=setTimeout((function(){a.current=!1,n(r.current.getBoundingClientRect())}),"scroll"===e?Qn:0)},fr["".concat(t).concat(e)]}function vr(e){var t,a=Kn(),n=Object(i.useRef)(),r=Object(i.useRef)(),l=Object(i.useRef)(),c=Object(i.useRef)(),s=Object(i.useRef)(),u=Object(i.useState)(!1),d=Object(Y.a)(u,2),m=d[0],p=d[1],h=Object(i.useState)(!1),f=Object(Y.a)(h,2),g=f[0],v=f[1],E=Object(i.useRef)(!1),y=Object(i.useRef)(!0),b=Object(i.useState)({}),O=Object(Y.a)(b,2),T=O[0],S=O[1],I=Object(i.useState)(0),R=Object(Y.a)(I,2),k=R[0],w=R[1],x={Control:tr,ValueContainer:ar,Input:ir,Placeholder:or,SingleValue:lr,IndicatorSeparator:null,DropdownIndicator:cr,Menu:sr,MenuList:ur,Option:mr};return Object(i.useEffect)((function(){var t=document.getElementById(e.inputId);return window.addEventListener("scroll",gr("Scroll",e.inputId,y,S,c)),window.addEventListener("resize",gr("Resize",e.inputId,y,S,c)),t.addEventListener("focus",gr("Focus",e.inputId,y,S,c)),function(){window.removeEventListener("scroll",fr["".concat(e.inputId,"Scroll")]),window.removeEventListener("resize",fr["".concat(e.inputId,"Resize")]),t.removeEventListener("focus",fr["".concat(e.inputId,"Focus")])}}),[e.inputId,S]),o.a.createElement(Bn.a,Object.assign({components:x,menuIsOpen:m,onMenuOpen:pr(y,v,p,e.onOpen),onMenuClose:hr(y,v,p,e.onClose),placeholder:"Type here to search...",ref:l,styles:er,value:e.options.filter((t=e.stopId,function(e){return e.value.stopId===t}))},e,{focusedOptionRef:s,labelRef:n,menuRef:r,selectRef:l,textRef:c,classes:a,inputMinWidth:k,menuIsOpenTransition:g,menuPlacementTop:E,menuTransition:y,setInputMinWidth:w,setMenuIsOpen:p,setTextFieldDOMRect:S,textFieldDOMRect:T}))}function Er(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function yr(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?Er(a,!0).forEach((function(t){Object(Ze.a)(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):Er(a).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}var br=Object(tt.a)((function(e){return{root:{display:"flex",flexWrap:"wrap"},formControl:{margin:e.spacing(1),minWidth:120,maxWidth:"100%"}}}));var Or=Object(s.connect)((function(e){return{graphParams:e.graphParams,query:e.location.query}}),(function(e){return{dispatch:e}}))((function(e){var t=e.routes,a=e.graphParams,n=[],r=Object(i.useState)(!1),l=Object(Y.a)(r,2),c=l[0],s=l[1],u=function(){var a=e.graphParams.routeId;return t?t.find((function(e){return e.id===a})):null}();function d(e,t){e&&c&&(e.classList.add("on-hover"),e.style.setProperty("--stop-name",'"'.concat(t,'"')))}function p(e){e&&e.classList.remove("on-hover")}function h(){s(!1),document.querySelectorAll(".on-hover").forEach((function(e){return e.classList.remove("on-hover")}))}var f=null;u&&u.directions&&a.directionId&&(f=u.directions.find((function(e){return e.id===a.directionId}))),f&&(n=me(0,f,a.startStopId));var g=br(),v=f?f.stops:[];return o.a.createElement("div",{className:"ControlPanel"},o.a.createElement(m.a,{container:!0},o.a.createElement(m.a,{item:!0,xs:!0},o.a.createElement(ua.a,{className:g.formControl},o.a.createElement(ca.a,{htmlFor:"route"},"Route"),o.a.createElement(ma.a,{value:a.routeId||0,onChange:function(t){var a=t.target.value,n=e.routes?e.routes.find((function(e){return e.id===a})):null;if(n){var r=n.directions.length>0?n.directions[0].id:null;e.dispatch({type:"ROUTESCREEN",payload:{routeId:a,directionId:r},query:e.query})}},input:o.a.createElement(la.a,{name:"route",id:"route"})},(t||[]).map((function(e){return o.a.createElement(sa.a,{key:e.id,value:e.id},e.title)}))))),u?o.a.createElement(m.a,{item:!0,xs:!0},o.a.createElement(ua.a,{className:g.formControl},o.a.createElement(ca.a,{htmlFor:"direction"},"Direction"),o.a.createElement(ma.a,{value:a.directionId||"",onChange:function(t){var n=t.target.value;e.dispatch({type:"ROUTESCREEN",payload:{routeId:a.routeId,directionId:n},query:e.query})},input:o.a.createElement(la.a,{name:"direction",id:"direction"})},(u.directions||[]).map((function(e){return o.a.createElement(sa.a,{key:e.id,value:e.id},e.title)}))))):null,f?o.a.createElement(m.a,{container:!0},o.a.createElement(m.a,{item:!0,xs:!0},o.a.createElement(Zt.a,{ml:1},o.a.createElement(kn.a,{fontSize:"small",color:"primary"}),o.a.createElement(ua.a,{className:g.formControl},o.a.createElement(vr,{onChange:function(t){var n=t.value.stopId;e.dispatch({type:"ROUTESCREEN",payload:yr({},a,{startStopId:n}),query:e.query})},inputId:"fromstop",textFieldProps:{label:"From Stop",InputLabelProps:{htmlFor:"fromstop",shrink:!0}},options:v.map((function(e){return{value:{stopId:e,icon:document.querySelector(".id".concat(e))},label:(u.stops[e]||{title:e}).title}})),stopId:a.startStopId,onOpen:function(){return s(!0)},onClose:h,handleItemMouseOver:d,handleItemMouseOut:p})))),o.a.createElement(m.a,{item:!0,xs:!0},o.a.createElement(Zt.a,{ml:1},o.a.createElement(An.a,{fontSize:"small",color:"primary"}),o.a.createElement(ua.a,{className:g.formControl},o.a.createElement(vr,{onChange:function(t){var n=t.value.stopId;e.dispatch({type:"ROUTESCREEN",payload:yr({},a,{endStopId:n}),query:e.query})},inputId:"tostop",textFieldProps:{label:"To Stop",InputLabelProps:{htmlFor:"tostop",shrink:!0}},options:(n||[]).map((function(e){return{value:{stopId:e,icon:document.querySelector(".id".concat(e))},label:(u.stops[e]||{title:e}).title}})),stopId:a.endStopId,onOpen:function(){return s(!0)},onClose:h,handleItemMouseOver:d,handleItemMouseOut:p}))))):null))}));var Tr=Object(s.connect)((function(e){return{routes:e.routes.data,routeMetrics:e.routeMetrics.data,graphParams:e.graphParams}}))((function(e){var t=Object(i.useState)([]),a=Object(Y.a)(t,2),n=a[0],r=a[1],l=e.graphParams,c=e.routeMetrics,s=e.routes,u=[],d=null,m=null,p=null,h=null,f=l.routeId,g=l.directionId;return s&&f&&(d=(p=(u=function(e,t,a){var n=e?e.interval.directions.find((function(e){return e.directionId===a})):null,r=null,i={};n&&n.cumulativeSegments.forEach((function(e){i[e.toStopId]=e,r=e.fromStopId}));var o=[],l=t?t.directions.find((function(e){return e.id===a})):null;if(l){var c=l.stop_geometry[r],s=c?c.distance:0;if(l.stops.forEach((function(e,a){var n=l.stop_geometry[e],c=t.stops[e].title,u=i[e];e===r?o.push({x:0,y:0,title:c,stopIndex:a}):u&&null!=u.medianTripTime&&n&&o.push({x:ne(n.distance-s),y:u.medianTripTime,title:c,stopIndex:a,numTrips:u.trips})})),l.loop&&r){var u=i[r];u&&null!=u.medianTripTime&&o.push({x:ne(l.distance),y:u.medianTripTime,title:t.stops[r].title,stopIndex:l.stops.length,numTrips:u.trips})}}return o}(c,s.find((function(e){return e.id===f})),g)).length)>0?u[p-1].y:null,m=p>0?u[p-1].x:null,h=p>0?u[p-1].numTrips:null),g?o.a.createElement(i.Fragment,null,o.a.createElement(mt.a,{variant:"h5"},"Travel time along route"),"Median travel time:"," ",d>0?d.toFixed(1):"?"," min \xa0\xa0 Average speed:"," ",d>0?(60*m/d).toFixed(1):"?"," ","mph",o.a.createElement("br",null),o.a.createElement(fn.m,{height:300,width:400,xDomain:[0,u.reduce((function(e,t){return t.x>e?t.x:e}),0)],yDomain:[0,u.reduce((function(e,t){return t.y>e?t.y:e}),0)],onMouseLeave:function(){r([])}},o.a.createElement(fn.f,null),o.a.createElement(fn.j,null),o.a.createElement(fn.l,{tickPadding:4}),o.a.createElement(fn.n,{hideLine:!0,tickPadding:4}),o.a.createElement(fn.g,{data:u,stroke:"#aa82c5",color:"aa82c5",style:{strokeWidth:"3px"},size:"1",onNearestX:function(e){r([e])}}),o.a.createElement(fn.b,{text:"Minutes",className:"alt-y-label",includeMargin:!0,xPercent:.02,yPercent:.2,style:{transform:"rotate(-90)",textAnchor:"end"}}),o.a.createElement(fn.b,{text:"Distance Along Route (miles)",className:"alt-x-label",includeMargin:!0,xPercent:.7,yPercent:.86,style:{textAnchor:"end"}}),n.length>0&&o.a.createElement(fn.c,{values:n,style:{line:{background:"none"}}},o.a.createElement("div",{className:"rv-crosshair__inner__content"},o.a.createElement("p",null,Math.round(n[0].y)," min"),o.a.createElement("p",null,n[0].title),o.a.createElement("p",null,"(Stop #",n[0].stopIndex+1,")")))),o.a.createElement(bn.a,{orientation:"horizontal",width:300,items:[{title:"Actual",color:"#aa82c5",strokeWidth:10}]}),"Distance:"," ",null!=m?m.toFixed(1):"?"," mi \xa0\xa0 Stops: ",p>0?p:"?"," \xa0\xa0 Completed trips: ",null!=h?h:"0"):o.a.createElement(i.Fragment,null,"Select a direction to see the travel time chart.")}));a(309);function Sr(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}var Ir=Object(s.connect)((function(e){return{routes:e.routes.data,graphParams:e.graphParams,arrivals:e.arrivals.data,arrivalsErr:e.arrivals.error}}),(function(e){return{fetchArrivals:function(t){return e($e(t))}}}))((function(e){var t=e.graphParams,a=e.arrivals,n=e.arrivalsErr,r=e.routes,l=e.hidden,c=e.fetchArrivals,s=Object(i.useState)(),u=Object(Y.a)(s,2),d=u[0],m=u[1],p=Object(i.useState)(),h=Object(Y.a)(p,2),f=h[0],g=h[1],v=Object(i.useState)(),E=Object(Y.a)(v,2),y=E[0],b=E[1],O=Object(i.useState)("Inbound_and_outbound"),T=Object(Y.a)(O,2),I=T[0],R=T[1],k=S(t.agencyId),w=k?k.timezoneId:"UTC",x=t.date===t.startDate;if(Object(i.useEffect)((function(){!a&&t.routeId&&!l&&x&&c(t)}),[t,c,a,l,x]),Object(i.useEffect)((function(){if(a&&r){var e=function(e,t){var a={byTripId:{},earliestArrivalTime:null,latestArrivalTime:null},n=e.stops,r=e.start_time,i=ye.a.unix(r).tz(w).hour(),o=e.route_id,l=t.find((function(e){return e.id===o})),c=[];Object.keys(n).forEach((function(e){var t=n[e].arrivals;Object.keys(t).forEach((function(a){t[a].forEach((function(t){c.push(function(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?Sr(a,!0).forEach((function(t){Object(Ze.a)(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):Sr(a).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}({stopId:e,directionId:a},t))}))}))})),c.sort((function(e,t){return e.t-t.t}));var s={};return l.directions.forEach((function(e){s[e.id]=e})),c.forEach((function(e){!function(e,t,a,n,r,i,o){var l=e,c=t.i,s=t.v;if(void 0===l.byTripId[c]&&(l.byTripId[c]={tripId:c,vehicleId:s,series:[],directionInfo:r}),r&&r.stop_geometry[a]){var u=r.stop_geometry[a].distance;"0"===r.id&&(u=r.distance-u),u=ne(u);var d=ye.a.unix(t.t).tz(w),m=(t.t-i)/60/60+o;if(l.byTripId[c].series.push({stopId:a,title:n.stops[a].title,arrivalTimeString:d.format("h:mm a"),vehicleId:s,x:u,y:m}),(null===l.earliestArrivalTime||m<l.earliestArrivalTime)&&(l.earliestArrivalTime=m),(null===l.latestArrivalTime||m>l.latestArrivalTime)&&(l.latestArrivalTime=m),t.e-t.t>Ne){var p=ye.a.unix(t.e).tz(w),h=(t.e-i)/60/60+o;l.byTripId[c].series.push({stopId:a,title:n.stops[a].title,arrivalTimeString:p.format("h:mm a"),vehicleId:s,x:u,y:h})}}}(a,e,e.stopId,l,s[e.directionId],r,i)})),a}(a,r);b(e)}else b(null)}),[a,r,w]),!x)return o.a.createElement("div",null,"The Marey chart is only available when viewing a single date.");var M=null,C=0,D=12;return y&&(M=function(e){var t=B.b([0,9],B.d),a=[];return Object.keys(e.byTripId).forEach((function(n){var r=e.byTripId[n];if("Inbound_and_outbound"===I||r.directionInfo&&r.directionInfo.id===I){var i=r.series;a.push(o.a.createElement(fn.g,{key:n,data:i,stroke:t(r.vehicleId%9),style:{strokeWidth:f===n?"3px":"1px"},size:"1",onValueMouseOver:function(e){return m(e)},onSeriesMouseOver:function(){g(n)}}))}})),a}(y),C=Math.floor(y.earliestArrivalTime),D=Math.ceil(y.latestArrivalTime)),t.startTime&&(C=parseInt(t.startTime,10)),t.endTime&&(D=parseInt(t.endTime,10),t.endTime.endsWith("+1")&&(D+=24)),y?o.a.createElement(i.Fragment,null,o.a.createElement(mt.a,{variant:"h5"},"Marey chart"),"Vehicle runs: ",M.length," ",o.a.createElement("br",null),o.a.createElement(ua.a,null,o.a.createElement("div",{className:"controls"},o.a.createElement(ha.a,{control:o.a.createElement(En.a,{id:"inbound_and_outbound",type:"radio",value:"Inbound_and_outbound",checked:"Inbound_and_outbound"===I,onChange:function(e){return R(e.target.value)}}),label:"Inbound and Outbound"}),o.a.createElement(ha.a,{control:o.a.createElement(En.a,{id:"inbound",type:"radio",value:"1",checked:"1"===I,onChange:function(e){return R(e.target.value)}}),label:"Inbound only"}),o.a.createElement(ha.a,{control:o.a.createElement(En.a,{id:"outbound",type:"radio",value:"0",checked:"0"===I,onChange:function(e){return R(e.target.value)}}),label:"Outbound only"}))),o.a.createElement(fn.m,{height:100*(D-C),width:600,yDomain:[D,C],margin:{left:80}},M,o.a.createElement(fn.a,{style:{bottom:{fill:"#fff"},left:{fill:"#fff"},right:{fill:"#fff"},top:{fill:"#fff"}}}),o.a.createElement(fn.f,null),o.a.createElement(fn.j,null),o.a.createElement(fn.l,{tickPadding:4}),o.a.createElement(fn.n,{hideLine:!0,tickPadding:4,tickFormat:function(e){var t="",a=e;a>=24&&(a-=24,t="+1");var n="am";a>=12&&(n="pm"),a>=13&&(a-=12),0===a&&(a=12);var r="".concat(parseInt(a,10),":").concat((60*(a-parseInt(a,10))).toString().padStart(2,"0"));return"".concat(r," ").concat(n).concat(t)}}),o.a.createElement(fn.b,{text:"Time",className:"alt-y-label",includeMargin:!0,xPercent:.02,yPercent:.3,style:{transform:"rotate(-90)"}}),o.a.createElement(fn.b,{text:"Inbound Distance Along Route (miles)",className:"alt-x-label",includeMargin:!0,xPercent:.7,yPercent:1-85/(100*(D-C)),style:{textAnchor:"end"}}),d?o.a.createElement(fn.e,{value:d,format:function(e){return[{title:"Stop",value:e.title},{title:"Time",value:e.arrivalTimeString},{title:"Vehicle ID",value:e.vehicleId}]}}):null)):o.a.createElement(i.Fragment,null,n||"Loading...")}));var Rr=Object(s.connect)((function(e){return{routes:e.routes.data,graphParams:e.graphParams,statsByRouteId:e.agencyMetrics.statsByRouteId}}))((function(e){var t=e.graphParams,a=e.statsByRouteId,n=o.a.useState(0),r=Object(Y.a)(n,2),l=r[0],c=r[1],s=t.routeId,u=t.directionId,d=a[s]||{directions:[]},p=null,f=null!=(p=u?d.directions.find((function(e){return e.directionId===u}))||{}:d).totalScore?o.a.createElement(i.Fragment,null,"Route score of ",p.totalScore," is the average of the following subscores:",o.a.createElement(Zt.a,{pt:2},o.a.createElement(ot.a,null,o.a.createElement(lt.a,null,o.a.createElement(ut.a,null,o.a.createElement(ct.a,null,"Median wait"),o.a.createElement(ct.a,{align:"right"},p.medianWaitScore)),o.a.createElement(ut.a,null,o.a.createElement(ct.a,null,"On-Time rate"),o.a.createElement(ct.a,{align:"right"},p.onTimeRateScore)),o.a.createElement(ut.a,null,o.a.createElement(ct.a,null,"Average speed"),o.a.createElement(ct.a,{align:"right"}," ",p.speedScore)),o.a.createElement(ut.a,null,o.a.createElement(ct.a,null,"Travel time variability"),o.a.createElement(ct.a,{align:"right"}," ",p.travelVarianceScore)))))):null,g=null!=p.medianWaitTime?o.a.createElement(i.Fragment,null,"Median wait of ",p.medianWaitTime.toFixed(1)," min gets a score of"," ",p.medianWaitScore,".",o.a.createElement(Zt.a,{pt:2},o.a.createElement(jn,{rows:[{label:"5 min or less",value:100},{label:"6.25 min",value:75},{label:"7.5 min",value:50},{label:"8.75",value:25},{label:"10 min or more",value:0}]}))):null,v=null!=p.onTimeRate?o.a.createElement(i.Fragment,null,"The on-time percentage is the percentage of scheduled departure times where a vehicle departed less than 5 minutes after the scheduled departure time or less than 1 minute before the scheduled departure time. The on-time percentage for the entire route is the median of the on-time percentage for each stop along the route. Probability of"," ",(100*p.onTimeRate).toFixed(1),"% gets a score of ",p.onTimeRateScore,"."):null,E=null!=p.averageSpeed?o.a.createElement(i.Fragment,null,"This is the average of the speeds for median end to end trips, in all directions. Average speed of ",p.averageSpeed.toFixed(1)," mph gets a score of ",p.speedScore,".",o.a.createElement(Zt.a,{pt:2},o.a.createElement(jn,{rows:[{label:"10 mph or more",value:100},{label:"8.75 mph",value:75},{label:"7.5 mph",value:50},{label:"6.25 mph",value:25},{label:"5 mph or less",value:0}]}))):null,y=null!=p.travelTimeVariability?o.a.createElement(i.Fragment,null,"Travel time variability is difference between the 90th percentile end to end travel time and the 10th percentile travel time. This measures how much extra travel time is needed for some trips. Variability of"," \xb1",(p.travelTimeVariability/2).toFixed(1)," min gets a score of"," ",p.travelVarianceScore,".",o.a.createElement(Zt.a,{pt:2},o.a.createElement(jn,{rows:[{label:"5 min or less",value:100},{label:"6.25 min",value:75},{label:"7.5 min",value:50},{label:"8.75 min",value:25},{label:"10 min or more",value:0}]}))):null;function b(e){return{id:"simple-tab-".concat(e),"aria-controls":"simple-tabpanel-".concat(e)}}return o.a.createElement(i.Fragment,null,o.a.createElement("br",null),o.a.createElement(h.a,{position:"static",color:"default"},o.a.createElement(gn.a,{value:l,onChange:function(e,t){c(t)},"aria-label":"tab bar",variant:"scrollable",scrollButtons:"on"},o.a.createElement(vn.a,Object.assign({style:{minWidth:72},label:"Summary"},b(0))),o.a.createElement(vn.a,Object.assign({style:{minWidth:72},label:"Travel Time"},b(1))),o.a.createElement(vn.a,Object.assign({style:{minWidth:72},label:"Marey Chart"},b(2))))),o.a.createElement(Zt.a,{p:2,hidden:0!==l},o.a.createElement("div",{style:{padding:8}},o.a.createElement(m.a,{container:!0,spacing:4},o.a.createElement(Dn,{score:p.totalScore,hideRating:!0,title:"Route Score",largeValue:null!=p.totalScore?p.totalScore:"--",smallValue:"/".concat(ie),bottomContent:null!=p.scoreRank?"#".concat(p.scoreRank," of ").concat(p.scoreRankCount," routes"):"",popoverContent:f}),o.a.createElement(Dn,{score:p.medianWaitScore,title:"Median Wait",largeValue:null!=p.medianWaitTime?p.medianWaitTime.toFixed(0):"--",smallValue:"\xa0min",bottomContent:o.a.createElement(i.Fragment,null,null!=p.waitRank?"#".concat(p.waitRank," of ").concat(p.waitRankCount," routes"):null),popoverContent:g}),o.a.createElement(Dn,{score:p.onTimeRateScore,title:"On-Time %",largeValue:null!=p.onTimeRate?(100*p.onTimeRate).toFixed(0):"--",smallValue:"%",popoverContent:v,bottomContent:null!=p.onTimeRank?"#".concat(p.onTimeRank," of ").concat(p.onTimeRankCount," routes"):""}),o.a.createElement(Dn,{score:p.speedScore,title:"Average Speed",largeValue:null!=p.averageSpeed?p.averageSpeed.toFixed(0):"--",smallValue:"\xa0mph",bottomContent:o.a.createElement(i.Fragment,null,null!=p.speedRank?"#".concat(p.speedRank," of ").concat(p.speedRankCount," routes"):null),popoverContent:E}),o.a.createElement(Dn,{score:p.travelVarianceScore,title:"Travel Time Variability",largeValue:null!=p.travelTimeVariability?"\xb1".concat((p.travelTimeVariability/2).toFixed(0)):"--",smallValue:"\xa0min",bottomContent:null!=p.variabilityRank?"#".concat(p.variabilityRank," of ").concat(p.variabilityRankCount," routes"):"",popoverContent:y})))),o.a.createElement(Zt.a,{p:2,hidden:1!==l,style:{overflowX:"auto"}},o.a.createElement(Tr,null)),o.a.createElement(Zt.a,{p:2,hidden:2!==l,style:{overflowX:"auto"}},o.a.createElement(Ir,{hidden:2!==l})))}));function kr(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function wr(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?kr(a,!0).forEach((function(t){Object(Ze.a)(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):kr(a).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}var xr=Object(tt.a)((function(e){return{breadCrumbStyling:{fontWeight:"bold",textTransform:"initial",display:"inline"},darkLinks:{color:e.palette.primary.dark},breadCrumbsWrapper:{padding:"1%",paddingRight:"0"}}}));var Mr=Object(s.connect)((function(e){return{tripMetrics:e.tripMetrics.data,tripMetricsError:e.tripMetrics.error,tripMetricsLoading:e.loading.TRIP_METRICS,routes:e.routes.data,graphParams:e.graphParams,query:e.location.query}}),(function(e){return{fetchRoutes:function(t){return e(ze())}}}))((function(e){var t=e.tripMetrics,a=e.tripMetricsLoading,n=e.tripMetricsError,r=e.graphParams,l=e.routes,c=e.fetchRoutes,s=r?r.agencyId:null;Object(i.useEffect)((function(){!l&&s&&c({agencyId:s})}),[s,l,c]);var u=S(s),d=l&&r&&r.routeId?l.find((function(e){return e.id===r.routeId&&e.agencyId===s})):null,f=d&&r.directionId?d.directions.find((function(e){return e.id===r.directionId})):null,g=f&&r.startStopId?d.stops[r.startStopId]:null,v=f&&r.endStopId?d.stops[r.endStopId]:null,E=xr(),y=E.breadCrumbStyling,b=E.breadCrumbsWrapper;return o.a.createElement(i.Fragment,null,o.a.createElement(h.a,{position:"relative"},o.a.createElement(p.a,null,o.a.createElement(yt.NavLink,{to:{type:"DASHBOARD",query:e.query},exact:!0,strict:!0},o.a.createElement(pt.a,{"aria-label":"Back to dashboard",edge:"start"},o.a.createElement(dn.a,{style:{color:"#ffffff"}}))),o.a.createElement(xt,null),o.a.createElement("div",{className:"page-title"},u?u.title:null),o.a.createElement("div",{style:{flexGrow:1}}),o.a.createElement(ln,{dateRangeSupported:!0}))),o.a.createElement(sn.a,{className:b},o.a.createElement(hn.a,{separator:o.a.createElement(pn.a,{fontSize:"default",className:y})},function(t,a){var n=a.breadCrumbStyling,r=a.darkLinks,i={type:"ROUTESCREEN",query:e.query},l=["routeId","directionId","startStopId","endStopId"];return t.filter((function(e){return!!e})).map((function(e,a){var c=t[a+1],s=l[a],u={};u[s]=e.id;var d=Object.assign(wr({},i.payload),u);i=Object.assign(wr({},i),{payload:d});var m=function(e,t){var a={startStopId:"from ",endStopId:"to "};return{label:t,specialLabel:a[e]?a[e]:null}}(s,e.title),p=m.label,h=m.specialLabel,f=0===a?"h1":null;return c?o.a.createElement(mt.a,{variant:"subtitle1",component:f,key:p,className:"".concat(n," ").concat(r)}," ",h," ",o.a.createElement(bt.a,{to:i,className:"".concat(n," ").concat(r)}," ",p," ")," "):o.a.createElement(mt.a,{variant:"subtitle1",component:f,key:p,className:n}," ",h," ",p," ")}))}([d,f,g?Object.assign(wr({},g),{id:r.startStopId}):null,v?Object.assign(wr({},v),{id:r.endStopInfo}):null],E))),o.a.createElement(m.a,{container:!0,spacing:0},o.a.createElement(m.a,{item:!0,xs:12,sm:6},o.a.createElement(zn,{routes:l})),o.a.createElement(m.a,{item:!0,xs:12,sm:6},o.a.createElement(Or,{routes:l}),t||n||a?o.a.createElement(Ln,{tripMetrics:t,tripMetricsError:n,tripMetricsLoading:a,graphParams:r,routes:l}):o.a.createElement(Rr,null))))}));var Cr=Object(s.connect)((function(e){return{statsByRouteId:e.agencyMetrics.statsByRouteId}}))((function(e){var t=e.statsByRouteId,a=[],n=0,r=0;return Object.keys(t).forEach((function(e){var i=t[e];null!=i.medianWaitTime&&null!=i.averageSpeed&&(r=Math.max(r,i.medianWaitTime),n=Math.max(n,i.averageSpeed),a.push({x:i.medianWaitTime,y:i.averageSpeed,title:i.routeId}))})),o.a.createElement(fn.m,{height:600,width:1e3,xDomain:[r,0],yDomain:[0,n]},o.a.createElement(fn.f,null),o.a.createElement(fn.j,null),o.a.createElement(fn.l,{top:300,style:{text:{stroke:"none",fill:"#cccccc"}}}),o.a.createElement(fn.n,{left:500,style:{text:{stroke:"none",fill:"#cccccc"}}}),o.a.createElement(fn.d,{className:"custom-marking",customComponent:function(e){return o.a.createElement("g",{className:"inner-inner-component"},o.a.createElement("circle",{cx:"0",cy:"0",r:e.size||3,fill:"#aa82c5"}),o.a.createElement("text",{x:0,y:0,fontSize:"75%",fill:"#450042"},o.a.createElement("tspan",{x:"5",y:"4"},"".concat(e.title))))},data:a}),o.a.createElement(fn.b,{text:"speed (mph)",className:"alt-y-label",includeMargin:!1,xPercent:.54,yPercent:.06,style:{transform:"rotate(-90)",textAnchor:"end"}}),o.a.createElement(fn.b,{text:"avg wait (min)",className:"alt-x-label",includeMargin:!1,xPercent:.94,yPercent:.5}))})),Dr=Object(tt.a)({title:{flexGrow:1}});var jr=Object(s.connect)((function(e){return{routes:e.routes.data,graphParams:e.graphParams}}),(function(e){return{fetchRoutes:function(t){return e(ze())},handleGraphParams:function(t){return e(He(t))}}}))((function(e){var t=e.graphParams,a=e.routes,n=E[0],r=e.fetchRoutes,l=e.handleGraphParams;Object(i.useEffect)((function(){l({}),a||r()}),[a,r,t,l]);var c=Dr();return o.a.createElement(i.Fragment,null,o.a.createElement(h.a,{position:"relative"},o.a.createElement(p.a,null,o.a.createElement(Qt,null),o.a.createElement(xt,null),o.a.createElement("div",{className:c.title},n.title),o.a.createElement(ln,{dateRangeSupported:!0}))),"Date: ",t.firstDateRange.date," Time:"," ",t.firstDateRange.startTime," -"," ",t.firstDateRange.endTime,o.a.createElement(Cr,null))}));a(310);function Pr(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function Lr(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?Pr(a,!0).forEach((function(t){Object(Ze.a)(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):Pr(a).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}var Nr={5:{color:"#057F79"},10:{color:"#02BB0F"},15:{color:"#3ae100"},20:{color:"#83dd00"},25:{color:"#cad900"},30:{color:"#d59d00"},35:{color:"#d25400"},40:{color:"#ce0d00"},45:{color:"#c200b6"},50:{color:"#8b00bf"},55:{color:"#4900bf"},60:{color:"#220D3B"}},Ar={color:"#666"},_r=new V.a.Icon({iconUrl:"".concat("frontend/build","/marker-icon-2x-red.png"),shadowUrl:"https://cdnjs.cloudflare.com/ajax/libs/leaflet/0.7.7/images/marker-shadow.png",iconSize:[25,41],iconAnchor:[12,41],popupAnchor:[1,-34],shadowSize:[41,41]}),Wr={};function Fr(e,t){return t.directions.find((function(t){return t.id===e}))}var Vr=function(e){function t(e){var a;Object(I.a)(this,t),(a=Object(k.a)(this,Object(w.a)(t).call(this,e))).refContainer=function(e){a.container=e,e&&F.DomEvent.disableClickPropagation(a.container).disableScrollPropagation(a.container)};var n=E[0];a.agencyId=n.id,a.initialZoom=n.initialMapZoom,a.initialCenter=n.initialMapCenter;var r=n.defaultDisabledRoutes||[];a.state={maxTripMin:90,computedMaxTripMin:null,computeId:null,computing:!1,latLng:null,endLatLng:null,tripInfo:null,enabledRoutes:{},noData:!1};var i="".concat("frontend/build","/isochrone-worker.js?v=").concat(Math.random());f&&(i+="&base=".concat(encodeURIComponent(f))),i+="&s3_bucket=".concat(encodeURIComponent(v)),i+="&agency_id=".concat(encodeURIComponent(a.agencyId)),i+="&routes_version=".concat(encodeURIComponent(b)),i+="&precomputed_stats_version=".concat(encodeURIComponent(y));var l=new Worker(i);return a.isochroneWorker=l,a.layers=[],a.isochroneLayers=[],a.tripLayers=[],a.mapRef=o.a.createRef(),r.forEach((function(e){a.state.enabledRoutes[e]=!1})),a.handleMapClick=a.handleMapClick.bind(Object(x.a)(a)),a.handleToggleRoute=a.handleToggleRoute.bind(Object(x.a)(a)),a.handleMaxTripMinChange=a.handleMaxTripMinChange.bind(Object(x.a)(a)),a.selectAllRoutesClicked=a.selectAllRoutesClicked.bind(Object(x.a)(a)),a.selectNoRoutesClicked=a.selectNoRoutesClicked.bind(Object(x.a)(a)),a.resetMapClicked=a.resetMapClicked.bind(Object(x.a)(a)),a.onWorkerMessage=a.onWorkerMessage.bind(Object(x.a)(a)),a.recomputeIsochrones=a.recomputeIsochrones.bind(Object(x.a)(a)),a.maxTripMinChanged=a.maxTripMinChanged.bind(Object(x.a)(a)),l.onmessage=a.onWorkerMessage,a.container=null,a}return Object(M.a)(t,e),Object(R.a)(t,[{key:"componentDidMount",value:function(){this.props.routes||this.props.fetchRoutes()}},{key:"componentDidUpdate",value:function(e){this.props.date===e.date&&this.props.startTime===e.startTime&&this.props.endTime===e.endTime||this.recomputeIsochrones()}},{key:"onWorkerMessage",value:function(e){var t=e.data;if("reachableLocations"===t.type){var a=t.computeId;Wr[a]&&(Wr[a][t.tripMin]=t),a===this.state.computeId&&this.addReachableLocationsLayer(t),this.setState({noData:!1})}else"error"===t.type?t.error.status>=400&&t.error.status<500?this.setState({noData:!0}):this.showError(t.error.message):console.log(e.data)}},{key:"showError",value:function(e){alert(e)}},{key:"handleMapClick",value:function(e){this.state.computeId||(this.resetMap(),this.computeIsochrones(e.latlng,null))}},{key:"addReachableLocationsLayer",value:function(e){var t=this,a=e.tripMin,n=e.circles,r=e.geoJson;if(this.state.computeId===e.computeId){this.state.computing&&a===this.state.maxTripMin&&this.setState({computing:!1});var i=Nr["".concat(a)]||Ar,o=V.a.geoJson(r,Object.assign({bubblingMouseEvents:!1,fillOpacity:.4,stroke:!1},i)),l=this.mapRef.current.leafletElement;o.addTo(l),o.on("click",(function(e){var a=e.latlng;t.showTripInfo(a,n)})),o.on("dblclick",(function(e){t.resetMap(),t.computeIsochrones(e.latlng)})),this.isochroneLayers.push({tripMin:a,layer:o});var c=this.state.endLatLng;if(c&&!this.tripLayers.length){var s=!0,u=!1,d=void 0;try{for(var m,p=n[Symbol.iterator]();!(s=(m=p.next()).done);s=!0){var h=m.value;if(l.distance(h,c)<=h.radius){this.showTripInfo(c,n);break}}}catch(f){u=!0,d=f}finally{try{s||null==p.return||p.return()}finally{if(u)throw d}}}}}},{key:"showTripInfo",value:function(e,t){var a=this;this.setState({endLatLng:e});var n=this.mapRef.current.leafletElement,r=[];if(t.forEach((function(t){var a=n.distance(t,e);if(a<=t.radius){var i=a/60,o=i+t.tripMin;r.push({tripMin:o,walkMin:i,circle:t})}})),this.clearTripLayers(!1),r.length){r=r.sort((function(e,t){return e.tripMin-t.tripMin}));var i={},l=0,c=[],s=!0,u=!1,d=void 0;try{for(var m,p=r[Symbol.iterator]();!(s=(m=p.next()).done);s=!0){var h=m.value,f=h.circle;if(!i[f.routes]&&(i[f.routes]=!0,l<2||!f.tripItems.length)){l+=1;var g=!0,v=!1,E=void 0;try{for(var y,b=function(){var e=y.value;if(e.route){var t=a.props.routes.find((function(t){return t.id===e.route}));if(t){var r=Fr(e.direction,t),i=e.fromStop,o=e.toStop,l=t.stops[i],c=t.stops[o],s=pe(t,r,i,o);if(s.length){var u=V.a.polyline(s).addTo(n);u.bindTooltip(t.id,{direction:"center",opacity:.9,permanent:!0}),a.tripLayers.push(u),a.tripLayers.push(V.a.circle(l,40,{color:"#090",fillOpacity:.8,stroke:!1}).addTo(n)),a.tripLayers.push(V.a.circle(c,40,{color:"#900",fillOpacity:.8,stroke:!1}).addTo(n))}}}},O=f.tripItems[Symbol.iterator]();!(g=(y=O.next()).done);g=!0)b()}catch(S){v=!0,E=S}finally{try{g||null==O.return||O.return()}finally{if(v)throw E}}c.push(o.a.createElement("div",{key:l,className:"isochrone-trip"},o.a.createElement("div",null,o.a.createElement("strong",null,"".concat(h.tripMin.toFixed(1)," min [").concat(f.routes||"walk","]"))),f.tripItems.map((function(e,t){return o.a.createElement("div",{key:t},o.a.createElement("em",null,e.t.toFixed(1)," min"),": ",e.desc)})),h.walkMin>.05&&f.tripItems.length?o.a.createElement("div",null,o.a.createElement("em",null,h.walkMin.toFixed(1)," min"),": walk to destination"):null))}}}catch(S){u=!0,d=S}finally{try{s||null==p.return||p.return()}finally{if(u)throw d}}var T=V.a.marker(e,{icon:_r}).addTo(n);this.tripLayers.push(T),this.setState({tripInfo:c})}}},{key:"computeIsochrones",value:function(e,t){var a=this;if(fe(this.agencyId,e)){var n=this.props.date,r=this.props.startTime,i=this.props.endTime,o=r&&i?"".concat(r,"-").concat(i):"",l=this.state,c=l.maxTripMin,s=l.enabledRoutes,u=[];this.props.routes.forEach((function(e){!1!==s[e.id]&&u.push(e.id)}));var d=[e.lat,e.lng,n,o,c,u.join(",")].join(",");this.setState({latLng:e,endLatLng:t,computedMaxTripMin:c,computeId:d});var m,p=this.mapRef.current.leafletElement,h=V.a.marker(e,{draggable:!0}).addTo(p);if(h.on("move",(function(e){m=e.latlng})),h.on("moveend",(function(){m&&(a.resetMap(),a.computeIsochrones(m))})),this.layers.push(h),Wr[d]&&Wr[d][c])for(var f=5;f<=c;f+=5){var g=Wr[d][f];g&&this.addReachableLocationsLayer(g)}else{Wr[d]={};for(var v=[],E=5;E<=c&&E<=60;E+=5)v.push(E);c>60&&v.push(c),this.setState({computing:!0}),this.isochroneWorker.postMessage({action:"computeIsochrones",latlng:e,routes:u,dateStr:n,timeStr:o,tripMins:v,computeId:d})}}}},{key:"handleMaxTripMinChange",value:function(e){this.setState({maxTripMin:parseInt(e.target.value,10)},this.maxTripMinChanged)}},{key:"maxTripMinChanged",value:function(){var e=this.state,t=e.maxTripMin,a=e.computedMaxTripMin;if(a&&(t>a||!this.isochroneLayers.find((function(e){return e.tripMin===t}))))this.recomputeIsochrones();else{var n=this.mapRef.current.leafletElement;this.isochroneLayers.forEach((function(e){e.tripMin<=t?e.layer.addTo(n):e.layer.remove()}))}}},{key:"handleToggleRoute",value:function(e){var t=e.target.value,a=e.target.checked;this.setState({enabledRoutes:Lr({},this.state.enabledRoutes,Object(Ze.a)({},t,a))},this.recomputeIsochrones)}},{key:"selectAllRoutesClicked",value:function(){this.selectAllRoutes(!0)}},{key:"selectNoRoutesClicked",value:function(){this.selectAllRoutes(!1)}},{key:"resetMapClicked",value:function(){this.resetMap()}},{key:"recomputeIsochrones",value:function(){var e=this.state,t=e.latLng,a=e.endLatLng;t&&(this.resetMap(),this.computeIsochrones(t,a))}},{key:"resetMap",value:function(){this.mapRef.current.leafletElement.closePopup(),this.setState({computeId:null,latLng:null,endLatLng:null}),this.isochroneLayers.forEach((function(e){e.layer.remove()})),this.layers.forEach((function(e){e.remove()})),this.layers=[],this.isochroneLayers=[],this.clearTripLayers()}},{key:"clearTripLayers",value:function(e){this.tripLayers.forEach((function(e){e.remove()})),this.tripLayers=[],!1!==e&&this.setState({tripInfo:null})}},{key:"selectAllRoutes",value:function(e){var t=this.props.routes;if(t){var a={};t.forEach((function(t){a[t.id]=e})),this.setState({enabledRoutes:a},this.recomputeIsochrones)}}},{key:"makeRouteToggle",value:function(e){var t=this.state.enabledRoutes[e.id];return null==t&&(t=!0),o.a.createElement(Dt.a,{key:e.id},o.a.createElement(ha.a,{control:o.a.createElement(oa.a,{checked:t,onChange:this.handleToggleRoute,value:e.id,color:"primary"}),label:e.id}))}},{key:"render",value:function(){for(var e=this,t=this.props.routes,a=[],n=[],r=5;r<=60;r+=5)a.push(o.a.createElement("div",{key:r,style:{backgroundColor:Nr[r].color}})),n.push(o.a.createElement("div",{key:r},r));a.push(o.a.createElement("div",{key:"default",style:{backgroundColor:Ar.color}}));for(var i=[],l=15;l<=60;l+=15)i.push(l);return i.push(90),o.a.createElement("div",{className:"flex-screen"},o.a.createElement(h.a,{position:"relative"},o.a.createElement(p.a,null,o.a.createElement(Qt,null),o.a.createElement(xt,null),o.a.createElement("div",{className:"page-title"},"Isochrone"),o.a.createElement(ln,null))),o.a.createElement(_.a,{center:this.initialCenter,zoom:this.initialZoom,className:"isochrone-map",minZoom:5,maxZoom:18,onClick:this.handleMapClick,ref:this.mapRef},o.a.createElement(W.a,{attribution:'Map tiles by <a href="http://stamen.com">Stamen Design</a>, under <a href="http://creativecommons.org/licenses/by/3.0">CC BY 3.0</a>. Data by <a href="http://openstreetmap.org">OpenStreetMap</a>, under <a href="http://www.openstreetmap.org/copyright">ODbL</a>.',url:"https://stamen-tiles.a.ssl.fastly.net/toner-lite/{z}/{x}/{y}.png"}),o.a.createElement(U.a,{position:"topleft",className:""},o.a.createElement("div",{ref:this.refContainer},o.a.createElement(m.a,{container:!0,className:"isochrone-controls",direction:"column"},o.a.createElement(m.a,{item:!0},o.a.createElement(mt.a,{variant:"subtitle1"},"Max Trip Time")),o.a.createElement(m.a,{item:!0},o.a.createElement(ma.a,{value:this.state.maxTripMin,onChange:this.handleMaxTripMinChange},i.map((function(e){return o.a.createElement(sa.a,{key:e,value:e},e," minutes")}))))),o.a.createElement(m.a,{container:!0,className:"isochrone-controls",direction:"column"},o.a.createElement(m.a,{item:!0},o.a.createElement(mt.a,{variant:"subtitle1"},"Routes")),o.a.createElement(m.a,{container:!0,item:!0,direction:"row",alignItems:"flex-start"},o.a.createElement(m.a,{item:!0},o.a.createElement(C.a,{onClick:this.selectAllRoutesClicked},"all"),o.a.createElement(C.a,{onClick:this.selectNoRoutesClicked},"none"))),o.a.createElement(m.a,{item:!0},o.a.createElement(Ct.a,{className:"isochrone-routes"},(t||[]).map((function(t){return e.makeRouteToggle(t)}))))))),o.a.createElement(U.a,{position:"topright"},this.state.tripInfo?o.a.createElement("div",{className:"isochrone-trip-info"},this.state.tripInfo):o.a.createElement("div",{className:"isochrone-instructions"},this.state.noData?"There is no data for the selected date. Choose another date.":this.state.latLng?this.state.computing?"Computing...":"Click anywhere in the shaded area to see routes and trip times between the two points, or drag the blue pin to see trip times from a new point.":"Click anywhere in the city to see the trip times from that point to the rest of the city via transit and walking.")),o.a.createElement(U.a,{position:"bottomright"},o.a.createElement("div",{className:"isochrone-legend"},"trip times (minutes)",o.a.createElement("div",{className:"isochrone-legend-colors"},a),o.a.createElement("div",{className:"isochrone-legend-times"},n))),o.a.createElement(U.a,{position:"bottomleft"},o.a.createElement(C.a,{variant:"contained",color:"secondary",onClick:this.resetMapClicked},"Clear map"),o.a.createElement("br",null),o.a.createElement("br",null))))}}]),t}(o.a.Component),zr={About:function(){return o.a.createElement(i.Fragment,null,o.a.createElement("h3",null,"About Us"))},Isochrone:Object(s.connect)((function(e){return{routes:e.routes.data,date:e.graphParams.firstDateRange.date,startTime:e.graphParams.firstDateRange.startTime,endTime:e.graphParams.firstDateRange.endTime}}),(function(e){return{fetchRoutes:function(t){return e(ze())}}}))(Vr),Landing:function(){return o.a.createElement(i.Fragment,null,o.a.createElement("h3",null,"Landing Page"))},Dashboard:cn,RouteScreen:Mr,DataDiagnostic:jr,NotFound:function(){return o.a.createElement("h3",null,"404")}},Ur=Object(u.a)({palette:{primary:{main:"#0177BF"},secondary:{main:"#D02143"}}}),Br=Object(s.connect)((function(e){return{page:e.page}}))((function(e){var t=e.page,a=zr[t];return o.a.createElement(d.a,{theme:Ur},o.a.createElement(a,null))})),$r=a(96),qr=a(223),Yr=a.n(qr),Hr=a(224);function Gr(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}var Jr=window.__REDUX_DEVTOOLS_EXTENSION_COMPOSE__?window.__REDUX_DEVTOOLS_EXTENSION_COMPOSE__({actionCreators:n}):$r.d;var Xr=function(e){var t=Object(Ht.connectRoutes)(Za,{querySerializer:Yr.a}),a=t.reducer,n=t.middleware,i=t.enhancer,o=Object($r.c)(function(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?Gr(a,!0).forEach((function(t){Object(Ze.a)(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):Gr(a).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}({},r,{location:a})),l=Object($r.a)(Hr.a,n),c=Jr(i,l);return{store:Object($r.e)(o,e,c)}}().store;c.a.render(o.a.createElement(s.Provider,{store:Xr},o.a.createElement(Br,null)),document.getElementById("root"))}},[[243,1,2]]]);
//# sourceMappingURL=main.bab3110b.chunk.js.map