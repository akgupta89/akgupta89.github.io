(window["webpackJsonpmetrics-mvp"]=window["webpackJsonpmetrics-mvp"]||[]).push([[0],{209:function(e,t,a){e.exports=a(277)},218:function(e,t,a){},219:function(e,t,a){},275:function(e,t,a){},277:function(e,t,a){"use strict";a.r(t);var n={};a.r(n),a.d(n,"generateRoutesURL",(function(){return $e})),a.d(n,"generateTripTimesURL",(function(){return Xe})),a.d(n,"generateWaitTimesURL",(function(){return qe})),a.d(n,"generateArrivalsURL",(function(){return Ze})),a.d(n,"fetchGraphData",(function(){return Qe})),a.d(n,"resetGraphData",(function(){return Je})),a.d(n,"fetchRoutes",(function(){return Ke})),a.d(n,"fetchPrecomputedWaitAndTripData",(function(){return et})),a.d(n,"fetchArrivals",(function(){return tt})),a.d(n,"resetArrivals",(function(){return at})),a.d(n,"handleSpiderMapClick",(function(){return nt})),a.d(n,"handleGraphParams",(function(){return rt}));var r={};a.r(r),a.d(r,"fetchGraph",(function(){return Mn})),a.d(r,"loading",(function(){return Sa})),a.d(r,"routes",(function(){return ba})),a.d(r,"page",(function(){return Rn}));var i=a(0),o=a.n(i),l=a(18),c=a.n(l),s=a(21);a(218),a(219);function u(){return o.a.createElement(i.Fragment,null,o.a.createElement("h3",null,"About Us"))}function m(){return o.a.createElement(i.Fragment,null,o.a.createElement("h3",null,"Landing Page"))}function d(){return o.a.createElement("h3",null,"404")}var p=a(342),h=a(330),f=a(347),g=Object({NODE_ENV:"production",PUBLIC_URL:"frontend/build"}).REACT_APP_METRICS_BASE_URL,v=window.OpentransitConfig,E=v.S3Bucket,b=v.Agencies,y=v.WaitTimesVersion,O=v.TripTimesVersion,S=v.RoutesVersion,I=v.ArrivalsVersion,w={};function T(e){return w[e]}b.forEach((function(e){w[e.id]=e}));var P=a(53),k=a(64),C=a(69),x=a(65),j=a(38),M=a(68),D=a(325),R=a(184),N=a.n(R),_=a(156),L=a(154),A=a(159),W=a(157),F=a(155),V=a(158),G=a(8),z=a.n(G),U=a(50),B=a.n(U),H=a(28),Y=a(357),$=a(29),X="route",q="direction",Z="fromStop",Q="toStop",J=function e(){var t=this;Object(P.a)(this,e),this.buildPath=function(e,a){var n=t.path;n.lastIndexOf("/")===n.length-1&&(n=n.substring(0,n.length-1));var r=n.split("/"),i=r.indexOf(e);return-1===i?(t.path="".concat(n,"/").concat(e,"/").concat(a),t):(r[i+1]=a,t.path=r.slice(0,i+2).join("/"),t)},this.commitPath=function(){var e=t.path;Object($.push)(e)},this.path=document.location.pathname},K=a(19),ee=a(123),te=a(178),ae=a.n(te),ne=a(179),re=a.n(ne),ie=a(180),oe=a.n(ie),le=a(181),ce=a.n(le);function se(e,t){if(!e)return null;var a={};return Object.keys(e).forEach((function(n){a[n]=e[n][t]})),a}function ue(e){return[e.startTime?"".concat(e.startTime,"-").concat(e.endTime):"",e.date]}function me(e){return e?"_".concat(e.replace(/:/g,"").replace("-","_").replace(/\+/g,"%2B")):""}function de(e,t,a,n){var r=ue(t),i=Object(K.a)(r,2),o=i[0],l=i[1];if(!e)return null;var c=t.agencyId,s=e["".concat(c,"-").concat(l+o,"-p10-median-p90")];if(!s)return null;var u=s.routes[a];return u?u[n]:null}function pe(e,t,a){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"median",r=a.directions;return r.reduce((function(r,i){var o=function(e,t,a,n){var r=ue(t),i=Object(K.a)(r,2),o=i[0],l=i[1],c=t.agencyId,s=e["".concat(c,"-").concat(l+o,"-median-p90-plt20m")];if(!s)return null;var u=s.routes[a];if(!u)return null;var m=u[n];return m||null}(e,t,a.id,i.id);return o&&o.median?"plt20m"===n?r+o.median[2]:r+o.median[0]:NaN}),0)/r.length}function he(e){return e.filter((function(e){var t=T(e.agencyId).routeHeuristics;return!t||!t[e.id]||!t[e.id].ignoreRoute}))}function fe(e,t,a,n){if(!e||!e[t])return!1;var r=e[t][a];return!!r&&(!!r[n]&&r[n])}function ge(e,t,a,n,r){var i=de(e,t,n,r);if(!i||!a)return{tripTimesForFirstStop:null,directionInfo:null};var o=a.find((function(e){return e.id===n})).directions.find((function(e){return e.id===r})),l=function(e,t,a){return fe(e,t,a,"ignoreFirstStop")}(T(t.agencyId).routeHeuristics,n,r),c=i[!0!==l&&!1!==l?l:o.stops[l?1:0]];return c&&Object.keys(c).length||(c=Object.values(i).reduce((function(e,t){return Object.values(t).length>Object.values(e).length?t:e}),{})),{tripTimesForFirstStop:c,directionInfo:o}}function ve(e,t,a,n,r){var i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"median",o=ge(e,t,a,n,r),l=o.tripTimesForFirstStop,c=o.directionInfo;if(!l)return"?";var s=function(e,t,a){return fe(e,t,a,"ignoreLastStop")}(T(t.agencyId).routeHeuristics,n,r),u=null,m=1;"p90"===i?m=2:"p10"===i&&(m=0);var d=null;return l[u=!0!==s&&!1!==s?s:c.stops[c.stops.length-(s?2:1)]]&&(d=l[u][m]),d||(d=Math.max.apply(Math,Object(ee.a)(Object.values(se(l,m))))),d}function Ee(e){return e/1609.344}function be(e,t,a){var n=null;return a&&(n=(n=he(a).map((function(a){return{routeId:a.id,wait:pe(e,t,a),longWait:1-pe(e,t,a,"plt20m")}}))).filter((function(e){return!Number.isNaN(e.wait)}))).sort((function(e,t){return t.wait-e.wait})),n}function ye(e,t,a){var n=null;return a&&(n=(n=he(a).map((function(n){var r=function(e,t,a,n){var r=a.find((function(e){return e.id===n})),i=r.directions.map((function(n){var i=n.distance,o=ve(e,t,a,r.id,n.id),l=ve(e,t,a,r.id,n.id,"p90"),c=ve(e,t,a,r.id,n.id,"p10");return i<=0||Number.isNaN(o)?-1:{speed:Ee(Number.parseFloat(i))/o*60,variability:(l-c)/2}}));if(0===(i=i.filter((function(e){return e.speed>=0}))).length)return 0;var o=i.reduce((function(e,t){return e+t.speed}),0),l=i.reduce((function(e,t){return e+t.variability}),0);return{speed:o/i.length,variability:l/i.length}}(e,t,a,n.id);return{routeId:n.id,speed:r.speed,variability:r.variability}}))).filter((function(e){return e.speed>0}))).sort((function(e,t){return t.speed-e.speed})),n}function Oe(e,t,a,n){var r,i=H.a().domain([5,10]).rangeRound([100,0]).clamp(!0),o=H.c().domain([5,7.5,10]).range(["A","B","C","D"]),l=H.a().domain([.1,.33]).rangeRound([100,0]).clamp(!0),c=H.a().domain([5,10]).rangeRound([0,100]).clamp(!0),s=H.c().domain([5,7.5,10]).range(["D","C","B","A"]),u=H.a().domain([5,10]).rangeRound([100,0]).clamp(!0),m=H.c().domain([25,50,75]).range(["D","C","B","A"]),d=0,p="",h=0,f=0,g="",v=0;return null!=e&&(d=i(e),p=o(e)),null!=t&&(h=l(t)),null!=a&&(f=c(a),g=s(a)),null!=n&&(v=u(n)),{medianWaitScore:d,medianWaitGrade:p,longWaitScore:h,speedScore:f,speedGrade:g,travelVarianceScore:v,totalScore:r=Math.round((d+h+f+v)/4),totalGrade:m(r),highestPossibleScore:100}}function Se(e,t,a){var n=[];return e.forEach((function(e){var r=a.find((function(t){return t.routeId===e.id})),i=t.find((function(t){return t.routeId===e.id}));if(i&&r){var o=Oe(i.wait,i.longWait,r.speed,r.variability);n.push({routeId:e.id,totalScore:o.totalScore,medianWaitScore:o.medianWaitScore,longWaitScore:o.longWaitScore,speedScore:o.speedScore,travelVarianceScore:o.travelVarianceScore})}})),n.sort((function(e,t){return t.totalScore-e.totalScore})),n}var Ie=H.c().domain([.25,.5,.75]).range([ae.a[300],re.a[300],oe.a[800],ce.a[900]]),we=H.c().domain([.25,.5,.75]).range(["black","black","white","white"]),Te=H.c().domain([.25,.5,.75]).range(["black","black","#8a8a8a","#8a8a8a"]);function Pe(e,t){return Ee(function(e,t,a,n){var r=[e,t,a,n].map((function(e){return e*Math.PI/180})),i=Object(K.a)(r,4),o=i[0],l=i[1],c=i[2],s=c-o,u=i[3]-l,m=Math.pow(Math.sin(s/2),2)+Math.cos(o)*Math.cos(c)*Math.pow(Math.sin(u/2),2);return 6371e3*(2*Math.atan2(Math.sqrt(m),Math.sqrt(1-m)))}(e.lat,e.lon,t.lat,t.lon))}var ke=a(25),Ce=a(91),xe=a.n(Ce),je=a(33),Me=a.n(je),De=a(182),Re={GRAY:"#a4a6a9",PURPLE:"#aa82c5",BLUE:"blue",RED:"red",GREEN:"green",INDIGO:a.n(De).a[400]},Ne=[Re.GRAY,Re.PURPLE],_e=90,Le=10,Ae={line:{background:"none"}},We="allday",Fe=[{value:We,shortLabel:"All Day",restOfLabel:""},{value:"07:00-19:00",shortLabel:"Daytime",restOfLabel:" (7AM - 7PM)"},{value:"03:00-07:00",shortLabel:"Early Morning",restOfLabel:" (3AM - 7AM)"},{value:"07:00-10:00",shortLabel:"AM Peak",restOfLabel:" (7AM - 10AM)"},{value:"10:00-16:00",shortLabel:"Midday",restOfLabel:" (10AM - 4PM)"},{value:"16:00-19:00",shortLabel:"PM Peak",restOfLabel:" (4PM - 7PM)"},{value:"19:00-03:00+1",shortLabel:"Late Evening",restOfLabel:" (7PM - 3AM)"}],Ve=90,Ge=[{value:"1",label:"Yesterday"},{value:"7",label:"Last week"},{value:"30",label:"Last 30 days"},{value:"90",label:"Last 90 days"}],ze=[{value:"1",label:"Monday"},{value:"2",label:"Tuesday"},{value:"3",label:"Wednesday"},{value:"4",label:"Thursday"},{value:"5",label:"Friday"}],Ue=[{value:"6",label:"Saturday"},{value:"0",label:"Sunday"}],Be=120;function He(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function Ye(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?He(a,!0).forEach((function(t){Object(ke.a)(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):He(a).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function $e(e){return"https://".concat(E,".s3.amazonaws.com/routes/").concat(S,"/routes_").concat(S,"_").concat(e,".json.gz?f")}function Xe(e,t,a,n){return"https://".concat(E,".s3.amazonaws.com/trip-times/").concat(O,"/").concat(e,"/").concat(t.replace(/-/g,"/"),"/trip-times_").concat(O,"_").concat(e,"_").concat(t,"_").concat(a).concat(n,".json.gz?e")}function qe(e,t,a,n){return"https://".concat(E,".s3.amazonaws.com/wait-times/").concat(y,"/").concat(e,"/").concat(t.replace(/-/g,"/"),"/wait-times_").concat(y,"_").concat(e,"_").concat(t,"_").concat(a).concat(n,".json.gz?e")}function Ze(e,t,a){return"https://".concat(E,".s3.amazonaws.com/arrivals/").concat(I,"/").concat(e,"/").concat(t.replace(/-/g,"/"),"/arrivals_").concat(I,"_").concat(e,"_").concat(t,"_").concat(a,".json.gz?d")}function Qe(e){var t=function(e){var t=Me()(e.date),a=Me()(e.startDate),n=t.diff(a,"days"),r=Math.abs(n)+1;n<0&&(t=a),r>Ve&&(r=Ve);for(var i=[],o=0;o<r;o++)e.daysOfTheWeek[t.day()]&&i.push(t.format("YYYY-MM-DD")),t.subtract(1,"days");return i}(e);return function(a){var n="query($agencyId:String!, $routeId:String!, $startStopId:String!, $endStopId:String,\n    $directionId:String, $date:[String!], $startTime:String, $endTime:String) {\n  routeMetrics(agencyId:$agencyId, routeId:$routeId) {\n    trip(startStopId:$startStopId, endStopId:$endStopId, directionId:$directionId) {\n      interval(dates:$date, startTime:$startTime, endTime:$endTime) {\n        headways {\n          count median max\n          percentiles(percentiles:[90]) { percentile value }\n          histogram { binStart binEnd count }\n        }\n        tripTimes {\n          count median avg max\n          percentiles(percentiles:[90]) { percentile value }\n          histogram { binStart binEnd count }\n        }\n        waitTimes {\n          median max\n          percentiles(percentiles:[90]) { percentile value }\n          histogram { binStart binEnd count }\n        }\n      }\n      timeRanges(dates:$date) {\n        startTime endTime\n        waitTimes {\n          percentiles(percentiles:[50,90]) { percentile value }\n        }\n        tripTimes {\n          percentiles(percentiles:[50,90]) { percentile value }\n        }\n      }\n    }\n  }\n}".replace(/\s+/g," ");a({type:"REQUEST_GRAPH_DATA"}),xe.a.get("/api/graphql",{params:{query:n,variables:JSON.stringify(Ye({},e,{date:t}))},baseURL:g}).then((function(t){t.data&&t.data.errors?a({type:"ERROR_GRAPH_DATA",payload:t.data.errors[0].message}):a({type:"RECEIVED_GRAPH_DATA",payload:t.data,graphParams:e})})).catch((function(e){var t=e.response&&e.response.data&&e.response.data.error?e.response.data.error:e.message;a({type:"ERROR_GRAPH_DATA",payload:t})}))}}function Je(){return function(e){e({type:"RESET_GRAPH_DATA",payload:null})}}function Ke(e){return function(t){var a=e.agencyId;t({type:"REQUEST_ROUTES"}),xe.a.get($e(a)).then((function(e){var n=e.data.routes;n.forEach((function(e){e.agencyId=a})),t({type:"RECEIVED_ROUTES",payload:n})})).catch((function(e){t({type:"ERROR_ROUTES",payload:e})}))}}function et(e){return function(t,a){var n=e.startTime?"".concat(e.startTime,"-").concat(e.endTime):"",r=e.date,i=e.agencyId,o=a().routes.tripTimesCache,l="".concat(i,"-").concat(r+n,"-").concat("p10-median-p90");if(!o[l]){var c=Xe(i,r,"p10-median-p90",me(n));t({type:"REQUEST_PRECOMPUTED_TRIP_TIMES"}),xe.a.get(c).then((function(e){t({type:"RECEIVED_PRECOMPUTED_TRIP_TIMES",payload:[e.data,l]})})).catch((function(){t({type:"ERROR_PRECOMPUTED_TRIP_TIMES"})}))}var s="".concat(i,"-").concat(r+n,"-").concat("median-p90-plt20m");if(!a().routes.waitTimesCache[s]){var u=qe(i,r,"median-p90-plt20m",me(n));t({type:"REQUEST_PRECOMPUTED_WAIT_TIMES"}),xe.a.get(u).then((function(e){t({type:"RECEIVED_PRECOMPUTED_WAIT_TIMES",payload:[e.data,s]})})).catch((function(){t({type:"ERROR_PRECOMPUTED_WAIT_TIMES"})}))}}}function tt(e){return function(t){var a=e.date,n=Ze(e.agencyId,a,e.routeId);t({type:"REQUEST_ARRIVALS"}),xe.a.get(n).then((function(n){t({type:"RECEIVED_ARRIVALS",payload:[n.data,a,e.routeId]})})).catch((function(e){t({type:"ERROR_ARRIVALS",payload:"No data."}),console.error(e)}))}}function at(){return function(e){e({type:"ERROR_ARRIVALS",payload:null})}}function nt(e,t){return function(a){a({type:"RECEIVED_SPIDER_MAP_CLICK",payload:[e,t]})}}function rt(e){return function(t,a){t({type:"RECEIVED_GRAPH_PARAMS",payload:e});var n=a().routes.graphParams;n.date&&n.agencyId&&t(et(n)),n.agencyId&&n.routeId&&n.directionId&&n.startStopId&&n.endStopId?t(Qe(n)):t((function(e){e({type:"RESET_GRAPH_DATA",payload:null})}))}}var it=a(144);function ot(e,t){var a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:t.stops[0],n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:t.stops[t.stops.length-1],r=e.stops[a],i=e.stops[n],o=t.stop_geometry[a],l=t.stop_geometry[n],c=[];if(o&&l){c.push(r);for(var s=o.after_index+1;s<=l.after_index;s++)c.push(t.coords[s]);c.push(i)}else{var u=t.stops.indexOf(a),m=t.stops.indexOf(n);if(-1!==u&&-1!==m)for(var d=u;d<=m;d++){var p=e.stops[t.stops[d]];c.push(p)}}return c}function lt(e,t){var a=it.point([t.lng,t.lat]),n=T(e).serviceArea;return!n||n.features.some((function(e){return it.booleanWithin(a,e)}))}function ct(e){var t=e.routeText,a=e.color,n=e.waitScaled,r=null,i=9+1.25*n;return r=t.endsWith("R")||t.endsWith("X")?'<div style="width:30px; height:'.concat(2*i,"px; ")+"border-radius:".concat(t.endsWith("X")?i:0,"px; "):'<div style="width:'.concat(2*i,"px; height:").concat(2*i,"px; ")+"border-radius: ".concat(i,"px; "),r+="".concat("position:relative; top:5px; left:5px; border-style:solid; border-color:").concat(a,"; ")+"border-width: ".concat(n/1.5+1,"px;")+"background-color:white;"+"text-align:center; font-size:".concat(75+15*n,"%; font-weight: ").concat(400+75*n,'">').concat(t,"</div>")}function st(e){return o.a.createElement(Y.a,{message:"Location is not in service area",open:e.showAlert})}var ut=function(e){function t(e){var a;return Object(P.a)(this,t),(a=Object(C.a)(this,Object(x.a)(t).call(this,e))).routeColor=H.b([0,9],H.d),a.SpiderOriginMarker=function(e){var t=null;return e.spiderLatLng?o.a.createElement(_.a,{position:e.spiderLatLng,draggable:!0,onMove:function(e){t=e.latlng},onMoveEnd:function(){a.handleLocationFound({latlng:t})}}):null},a.generateShield=function(e,t){var n=e.downstreamStops[e.downstreamStops.length-1],r=[n.lat,n.lon],i=a.routeColor(e.routeIndex%10),l=z.a.divIcon({className:"custom-icon",html:ct({waitScaled:t,color:i,routeText:e.routeId})});return o.a.createElement(_.a,{key:"".concat(e.routeId,"-").concat(e.direction.id,"-Shield"),position:r,icon:l,riseOnHover:!0,onClick:function(t){t.originalEvent.view.L.DomEvent.stopPropagation(t),(new J).buildPath(X,e.routeId).buildPath(q,e.direction.id).buildPath(Z,e.stopId).buildPath(Q,n.stopId).commitPath()}})},a.getStartMarkers=function(){var e=null;return a.props.spiderSelection&&(e=a.props.spiderSelection.map((function(e,t){var n=[e.stop.lat,e.stop.lon],r=a.routeColor(e.routeIndex%10);return o.a.createElement(L.a,{key:"startMarker-".concat(t),center:n,radius:"8",fillColor:r,fillOpacity:.2,stroke:!1},o.a.createElement(A.a,null,e.routeTitle,o.a.createElement("br",null),e.direction.title,o.a.createElement("br",null),e.stop.title,o.a.createElement("br",null),Math.round(5280*e.miles)," feet"))}))),e},a.DownstreamLines=function(){var e=be(a.props.waitTimesCache,a.props.graphParams,a.props.routes),t=null;return a.props.spiderSelection&&(t=a.props.spiderSelection.map((function(t){var n=t.downstreamStops,r=[],i=e.findIndex((function(e){return e.routeId===t.routeId})),o=Math.trunc(i/e.length*3);isFinite(o)||(o=0);for(var l=0;l<n.length-1;l++)r.push(a.generatePolyline(t,o,l));return r.push(a.generateTerminalCircle(t,o)),r.push(a.generateShield(t,o)),r}))),o.a.createElement(i.Fragment,null,t)},a.generateTerminalCircle=function(e,t){var n=e.downstreamStops[e.downstreamStops.length-1],r=[n.lat,n.lon],i=a.routeColor(e.routeIndex%10);return o.a.createElement(L.a,{key:"startMarker-".concat(e.routeId,"-terminal-").concat(n.stopId),center:r,radius:3+t/2,fillColor:i,fillOpacity:.75,stroke:!1})},a.generatePolyline=function(e,t,n){var r=e.downstreamStops,i=1.5*t+3,l=a.routeColor(e.routeIndex%10);return o.a.createElement(W.a,{key:"poly-".concat(e.routeId,"-").concat(r[n].stopId),positions:ot(e.routeInfo,e.direction,r[n].stopId,r[n+1].stopId),color:l,opacity:.5,weight:i,onMouseOver:function(e){return e.target.setStyle({opacity:1,weight:i+4}),!0},onFocus:function(e){a.onMouseOver(e)},onMouseOut:function(e){return e.target.setStyle({opacity:.5,weight:i}),!0},onBlur:function(e){a.onMouseOut(e)},onClick:function(t){t.originalEvent.view.L.DomEvent.stopPropagation(t),(new J).buildPath(X,e.routeId).buildPath(q,e.direction.id).buildPath(Z,e.stopId).buildPath(Q,r[n+1].stopId).commitPath()}},o.a.createElement(A.a,null,e.routeTitle,o.a.createElement("br",null),e.direction.title,o.a.createElement("br",null),r[n+1].title,o.a.createElement("br",null)))},a.handleGeoLocate=function(e){e.preventDefault();var t=a.mapRef.current;null!=t&&t.leafletElement.locate()},a.handleMapClick=function(e){null!=a.mapRef.current&&a.handleLocationFound(e)},a.agency=b[0],a.state={isValidLocation:!0,height:a.computeHeight()},a.mapRef=Object(i.createRef)(),a.handleLocationFound=a.handleLocationFound.bind(Object(j.a)(a)),a}return Object(M.a)(t,e),Object(k.a)(t,[{key:"componentDidMount",value:function(){this.boundUpdate=this.updateDimensions.bind(this),window.addEventListener("resize",this.boundUpdate)}},{key:"componentWillUnmount",value:function(){window.removeEventListener("resize",this.updateDimensions.bind(this))}},{key:"updateDimensions",value:function(){var e=this.computeHeight();this.setState({height:e})}},{key:"computeHeight",value:function(){return(window.innerWidth>=640?window.innerHeight:window.innerHeight/2)-64}},{key:"handleLocationFound",value:function(e){var t=this,a=e.latlng;this.setState({isValidLocation:lt(this.agency.id,a)});var n=this.findStops(a);n.forEach((function(e){t.addDownstreamStops(e)})),(0,this.props.onSpiderMapClick)(n,a)}},{key:"addDownstreamStops",value:function(e){var t=e,a=this.props.routes.find((function(e){return e.id===t.routeId})),n=t.direction,r=n.stops.indexOf(t.stopId),i=n.stops.slice(r).map((function(e){return Object.assign(a.stops[e],{stopId:e})}));t.downstreamStops=i}},{key:"findStops",value:function(e){for(var t=this,a=this.props.routes,n={lat:e.lat,lon:e.lng},r=[],i=he(a),o=function(e){var a=i[e];a.directions&&a.directions.forEach((function(i){var o=i.stops,l=t.findNearestStop(n,o,a.stops);l.routeId=a.id,l.routeIndex=e,l.routeTitle=a.title,l.direction=i,l.routeInfo=a,r.push(l)}))},l=0;l<i.length;l++)o(l);return(r=r.filter((function(e){return e.miles<.25}))).sort((function(e,t){return e.miles-t.miles})),r}},{key:"findNearestStop",value:function(e,t,a){var n={miles:-1,stop:null,stopId:null};return t.forEach((function(t){var r=Pe(e,a[t]);(-1===n.miles||r<n.miles)&&(n={miles:r,stop:a[t],stopId:t})})),n}},{key:"render",value:function(){var e=this,t=this.props,a=t.position,n=t.zoom,r=this.state.isValidLocation,i={width:"100%",height:this.state.height},l=this.getStartMarkers();return o.a.createElement("div",null,o.a.createElement(st,{showAlert:!r}),o.a.createElement(F.a,{center:a||this.agency.initialMapCenter,zoom:n||this.agency.initialMapZoom,style:i,minZoom:5,maxZoom:18,onClick:this.handleMapClick,onLocationfound:this.handleLocationFound,ref:this.mapRef},o.a.createElement(V.a,{attribution:'Map tiles by <a href="http://stamen.com">Stamen Design</a>, under <a href="http://creativecommons.org/licenses/by/3.0">CC BY 3.0</a>. Data by <a href="http://openstreetmap.org">OpenStreetMap</a>, under <a href="http://www.openstreetmap.org/copyright">ODbL</a>.',url:"https://stamen-tiles.a.ssl.fastly.net/toner-lite/{z}/{x}/{y}.png",opacity:.3}),o.a.createElement(this.DownstreamLines,null),l,o.a.createElement(this.SpiderOriginMarker,{spiderLatLng:this.props.spiderLatLng}),o.a.createElement(B.a,{position:"topright"},o.a.createElement("div",{className:"map-instructions"},this.props.spiderLatLng&&l&&l.length?"Click anywhere along a route to see statistics for trips between the two stops.":"Click anywhere in the city to see the routes near that point.")),o.a.createElement(B.a,{position:"bottomleft"},o.a.createElement(D.a,{variant:"contained",color:"primary",onClick:this.handleGeoLocate},o.a.createElement(N.a,null),"\xa0 Routes near me"),"\xa0",o.a.createElement(D.a,{variant:"contained",color:"secondary",onClick:function(){return e.props.onSpiderMapClick([],null)}},"Clear map"),o.a.createElement("br",null),o.a.createElement("br",null))))}}]),t}(i.Component),mt=Object(s.connect)((function(e){return{routes:e.routes.routes,graphParams:e.routes.graphParams,waitTimesCache:e.routes.waitTimesCache,spiderLatLng:e.routes.spiderLatLng,spiderSelection:e.routes.spiderSelection}}),(function(e){return{onSpiderMapClick:function(t,a){return e(nt(t,a))}}}))(ut),dt=a(4),pt=a(329),ht=a(22),ft=a(332),gt=a(333),vt=a(334),Et=a(328),bt=a(326),yt=a(327),Ot=a(358),St=a(102),It=a(279),wt=a(359),Tt=a(198),Pt=a(186),kt=a.n(Pt),Ct=a(60),xt=a.n(Ct),jt=a(90),Mt=a.n(jt);function Dt(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function Rt(e,t,a){return Number.isNaN(e[a])&&Number.isNaN(t[a])?0:Number.isNaN(e[a])?-1:Number.isNaN(t[a])?1:t[a]<e[a]?-1:t[a]>e[a]?1:0}var Nt=[{id:"title",numeric:!1,disablePadding:!1,label:"Name"},{id:"totalScore",numeric:!0,disablePadding:!1,label:"Score"},{id:"wait",numeric:!0,disablePadding:!0,label:"Median Wait (min)"},{id:"longWait",numeric:!0,disablePadding:!0,label:"Long Wait %"},{id:"speed",numeric:!0,disablePadding:!0,label:"Average Speed (mph)"},{id:"variability",numeric:!0,disablePadding:!0,label:"Travel Time Variability (min)"}];function _t(e){var t=e.order,a=e.orderBy,n=e.onRequestSort;return o.a.createElement(bt.a,null,o.a.createElement(yt.a,null,Nt.map((function(e){return o.a.createElement(Et.a,{key:e.id,align:e.numeric?"right":"left",padding:e.disablePadding?"none":"default",sortDirection:a===e.id&&t},o.a.createElement(Ot.a,{active:a===e.id,direction:t,onClick:(r=e.id,function(e){n(e,r)})},e.label));var r}))))}var Lt=Object(pt.a)((function(e){return{root:{paddingLeft:e.spacing(2),paddingRight:e.spacing(1)},highlight:"light"===e.palette.type?{color:e.palette.secondary.main,backgroundColor:Object(ht.e)(e.palette.secondary.light,.85)}:{color:e.palette.text.primary,backgroundColor:e.palette.secondary.dark},spacer:{flex:"1 1 100%"},actions:{color:e.palette.text.secondary},title:{flex:"0 0 auto"},popover:{padding:e.spacing(2),maxWidth:500}}})),At=function(e){var t=Lt(),a=e.numSelected,n=Object(i.useState)(null),r=Object(K.a)(n,2),l=r[0],c=r[1];return o.a.createElement(h.a,{className:Object(dt.a)(t.root,Object(ke.a)({},t.highlight,a>0))},o.a.createElement("div",{className:t.title},a>0?o.a.createElement(St.a,{color:"inherit",variant:"subtitle1"},a," selected"):o.a.createElement(St.a,{variant:"h6",id:"tableTitle"},"Routes",o.a.createElement(It.a,{size:"small",onClick:function(e){c(e.currentTarget)}},o.a.createElement(xt.a,{fontSize:"small"})))),o.a.createElement("div",{className:t.spacer}),o.a.createElement("div",{className:t.actions},o.a.createElement(wt.a,{title:"Filter list"},o.a.createElement(It.a,{"aria-label":"Filter list"},o.a.createElement(kt.a,null)))),o.a.createElement(ft.a,{open:Boolean(l),anchorEl:l,onClose:function(){c(null)},anchorOrigin:{vertical:"bottom",horizontal:"center"},transformOrigin:{vertical:"top",horizontal:"center"}},o.a.createElement("div",{className:t.popover},o.a.createElement("b",null,"Score")," is the average of subscores (0-100) for median wait, long wait probability, average speed, and travel time variability.  Click on a route to see its metrics and explanations of how the subscores are calculated.",o.a.createElement("p",null),o.a.createElement("b",null,"Median Wait")," is the 50th percentile (typical) wait time for a rider arriving randomly at a stop while the route is running.",o.a.createElement("p",null),o.a.createElement("b",null,"Long wait probability")," is the chance a rider has of a wait of twenty minutes or longer after arriving randomly at a stop.",o.a.createElement("p",null),o.a.createElement("b",null,"Average speed")," is the speed of the 50th percentile (typical) end to end trip, averaged for all directions.",o.a.createElement("p",null),o.a.createElement("b",null,"Travel time variability")," is the 90th percentile end to end travel time minus the 10th percentile travel time.  This measures how much extra travel time is needed for some trips.")))},Wt=Object(pt.a)((function(e){return{root:{width:"100%",marginTop:e.spacing(3)},tableWrapper:{overflowX:"auto"}}}));var Ft=Object(s.connect)((function(e){return{graphParams:e.routes.graphParams,spiderSelection:e.routes.spiderSelection,waitTimesCache:e.routes.waitTimesCache,tripTimesCache:e.routes.tripTimesCache}}),(function(e){return{myFetchPrecomputedWaitAndTripData:function(t){return e(et(t))},handleGraphParams:function(t){return e(rt(t))}}}))((function(e){var t=Wt(),a=o.a.useState("asc"),n=Object(K.a)(a,2),r=n[0],l=n[1],c=o.a.useState("title"),s=Object(K.a)(c,2),u=s[0],m=s[1],d=Object(Tt.a)(),p=e.graphParams,h=e.myFetchPrecomputedWaitAndTripData;Object(i.useEffect)((function(){p.agencyId&&p.date&&h(p)}),[p,h]);var f=e.routes?he(e.routes):[],g=e.spiderSelection;if(g&&g.length>0){var v=g.map((function(e){return e.routeId}));f=f.filter((function(e){return v.includes(e.id)}))}var E=be(e.waitTimesCache,e.graphParams,f),b=ye(e.tripTimesCache,e.graphParams,f),y=Se(f,E,b);return f=f.map((function(e){var t=E.find((function(t){return t.routeId===e.id})),a=b.find((function(t){return t.routeId===e.id})),n=y.find((function(t){return t.routeId===e.id}));return function(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?Dt(a,!0).forEach((function(t){Object(ke.a)(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):Dt(a).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}({},e,{wait:t?t.wait:NaN,longWait:t?t.longWait:NaN,speed:a?a.speed:NaN,variability:a?a.variability:NaN,totalScore:n?n.totalScore:NaN,medianWaitScore:n?n.medianWaitScore:NaN,longWaitScore:n?n.longWaitScore:NaN,speedScore:n?n.speedScore:NaN,travelVarianceScore:n?n.travelVarianceScore:NaN})})),o.a.createElement("div",null,o.a.createElement(At,{numSelected:0}),o.a.createElement("div",{className:t.tableWrapper},o.a.createElement(gt.a,{"aria-labelledby":"tableTitle",size:"small"},o.a.createElement(_t,{order:r,orderBy:u,onRequestSort:function(e,t){l(u===t&&"desc"===r?"asc":"desc"),m(t)},rowCount:f.length}),o.a.createElement(vt.a,null,function(e,t,a,n){if("title"===n)return"desc"===a?Object(ee.a)(e).reverse():e;var r=e.map((function(e,t){return[e,t]}));return r.sort((function(e,a){var n=t(e[0],a[0]);return 0!==n?n:e[1]-a[1]})),r.map((function(e){return e[0]}))}(f,function(e,t){return"desc"===e?function(e,a){return Rt(e,a,t)}:function(e,a){return-Rt(e,a,t)}}(r,u),r,u).map((function(e,t){var a="enhanced-table-checkbox-".concat(t);return o.a.createElement(yt.a,{hover:!0,role:"checkbox",tabIndex:-1,key:e.id},o.a.createElement(Et.a,{component:"th",id:a,scope:"row",padding:"none"},o.a.createElement(Mt.a,{style:{color:d.palette.primary.dark,textDecoration:"none"},to:{type:"ROUTESCREEN",payload:{agencyId:e.agencyId,routeId:e.id,directionId:null,startStopId:null,endStopId:null}}},e.title)),o.a.createElement(Et.a,{align:"right",style:{color:we(e.totalScore/100),backgroundColor:Ie(e.totalScore/100)}},Number.isNaN(e.totalScore)?"--":e.totalScore),o.a.createElement(Et.a,{align:"right",padding:"none",style:{color:Te(e.medianWaitScore/100)}},Number.isNaN(e.wait)?"--":e.wait.toFixed(0)),o.a.createElement(Et.a,{align:"right",padding:"none",style:{color:Te(e.longWaitScore/100)}},Number.isNaN(e.longWait)?"--":o.a.createElement(i.Fragment,null,(100*e.longWait).toFixed(0),o.a.createElement("font",{style:{color:"#8a8a8a"}},"%"))),o.a.createElement(Et.a,{align:"right",padding:"none",style:{color:Te(e.speedScore/100)}},Number.isNaN(e.speed)?"--":e.speed.toFixed(0)),o.a.createElement(Et.a,{align:"right",padding:"none",style:{color:Te(e.travelVarianceScore/100)}},Number.isNaN(e.variability)?"--":o.a.createElement(i.Fragment,null,o.a.createElement("font",{style:{color:"#8a8a8a"}},"\xb1"," "),e.variability.toFixed(0))))}))))))})),Vt=a(355),Gt=a(335),zt=a(280),Ut=a(337),Bt=a(188),Ht=a.n(Bt),Yt=a(187),$t=a.n(Yt),Xt=a(336),qt=a(189),Zt=a.n(qt);var Qt=function(){var e=o.a.useState(!1),t=Object(K.a)(e,2),a=t[0],n=t[1];function r(){n(!a)}var i={fontWeight:"bold",color:"#3f51b5",textDecoration:"none",cursor:"default"};return o.a.createElement("div",null,o.a.createElement(It.a,{color:"inherit","aria-label":"Open drawer",onClick:r,edge:"start"},o.a.createElement($t.a,null)),o.a.createElement(Vt.a,{variant:"persistent",anchor:"left",open:a},o.a.createElement("div",{style:{width:250}},o.a.createElement(It.a,{color:"inherit","aria-label":"Open drawer",onClick:r,edge:"start"},o.a.createElement(Ht.a,null)),o.a.createElement(Gt.a,null,o.a.createElement(zt.a,null,o.a.createElement(jt.NavLink,{to:{type:"DASHBOARD"},activeStyle:i,exact:!0,strict:!0},"Dashboard")),o.a.createElement(zt.a,null,o.a.createElement(jt.NavLink,{to:{type:"ISOCHRONE"},activeStyle:i,exact:!0,strict:!0},"Isochrone")),o.a.createElement(zt.a,null,o.a.createElement(jt.NavLink,{to:{type:"DATADIAGNOSTIC"},activeStyle:i,exact:!0,strict:!0},"."))),o.a.createElement(Gt.a,{style:{position:"absolute",width:"100%",bottom:0}},o.a.createElement(zt.a,{button:!0,component:"a",href:"https://sites.google.com/view/opentransit",target:"_blank"},o.a.createElement(Xt.a,null,o.a.createElement(Zt.a,null)),o.a.createElement(Ut.a,{primary:"About"}))))))},Jt=a(349),Kt=a(354),ea=a(338),ta=a(345),aa=a(192),na=a.n(aa),ra=a(340),ia=a(341),oa=a(346),la=a(339),ca=a(343),sa=a(351),ua=a(352),ma=a(344),da=a(281),pa=a(193),ha=a.n(pa);function fa(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function ga(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?fa(a,!0).forEach((function(t){Object(ke.a)(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):fa(a).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}var va=Me()(Date.now()-864e5),Ea={routes:null,spiderSelection:[],graphParams:{agencyId:null,routeId:null,directionId:null,startStopId:null,endStopId:null,startTime:null,endTime:null,date:va.format("YYYY-MM-DD"),startDate:va.format("YYYY-MM-DD"),daysOfTheWeek:ga({},ze.reduce((function(e,t){return e[t.value]=!0,e}),{}),{},Ue.reduce((function(e,t){return e[t.value]=!0,e}),{}))},spiderLatLng:null,tripTimesCache:{},waitTimesCache:{}},ba=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Ea,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"RECEIVED_ROUTES":return ga({},e,{routes:t.payload});case"RECEIVED_SPIDER_MAP_CLICK":return ga({},e,{spiderSelection:t.payload[0],spiderLatLng:t.payload[1]});case"RECEIVED_GRAPH_PARAMS":return ga({},e,{graphParams:Object.assign({},e.graphParams,t.payload)});case"ERROR_ROUTES":return e;case"RECEIVED_PRECOMPUTED_TRIP_TIMES":return ga({},e,{tripTimesCache:ga({},e.tripTimesCache,Object(ke.a)({},t.payload[1],t.payload[0]))});case"RECEIVED_PRECOMPUTED_WAIT_TIMES":return ga({},e,{waitTimesCache:ga({},e.waitTimesCache,Object(ke.a)({},t.payload[1],t.payload[0]))});case"RECEIVED_ARRIVALS":return ga({},e,{arrivals:ga({},t.payload[0],{date:t.payload[1]}),arrivalsErr:null});case"ERROR_ARRIVALS":return ga({},e,{arrivals:null,arrivalsErr:t.payload});default:return e}};function ya(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function Oa(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?ya(a,!0).forEach((function(t){Object(ke.a)(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):ya(a).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}var Sa=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0,a=t.type,n=/(REQUEST|RECEIVED|ERROR)_(.*)/.exec(a);if(!n)return e;var r=Object(K.a)(n,3),i=r[1],o=r[2];return Oa({},e,Object(ke.a)({},o,"REQUEST"===i))};function Ia(e){return Object.keys(e.loading).reduce((function(t,a){return t||e.loading[a]}),!1)}function wa(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function Ta(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?wa(a,!0).forEach((function(t){Object(ke.a)(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):wa(a).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}var Pa=Object(pt.a)((function(e){return{button:{textTransform:"none",display:"flex",justifyContent:"flex-start"},heading:{fontSize:e.typography.pxToRem(15)},secondaryHeading:{fontSize:e.typography.pxToRem(12),color:e.palette.text.secondary,textAlign:"left"},column:{flexGrow:"1"},nowrap:{whiteSpace:"nowrap"},root:{display:"flex",flexWrap:"wrap"},formControl:{leftMargin:e.spacing(1),rightMargin:e.spacing(1),minWidth:240},closeButton:{position:"absolute",right:e.spacing(1),top:e.spacing(1),color:e.palette.grey[500]},popover:{padding:e.spacing(2),maxWidth:400}}}));var ka=Object(s.connect)((function(e){return{graphParams:e.routes.graphParams,isLoading:Ia(e)}}),(function(e){return{handleGraphParams:function(t){return e(rt(t))}}}))((function(e){var t=e.graphParams,a=e.dateRangeSupported,n=Pa(),r=Object(i.useState)(null),l=Object(K.a)(r,2),c=l[0],s=l[1],u=Object(i.useState)(null),m=Object(K.a)(u,2),d=m[0],h=m[1],f=Me()(Date.now()).format("YYYY-MM-DD");function g(){s(null)}function v(e){var t=new Date(e);return"".concat((t.getUTCMonth()+1).toString().padStart(2,"0"),"/").concat(t.getUTCDate().toString().padStart(2,"0"),"/").concat(t.getUTCFullYear())}var E=t.startTime&&t.endTime?"".concat(t.startTime,"-").concat(t.endTime):We,b=v(t.date),y=null;t.startDate!==t.date&&(a?b=v(t.startDate)+" - "+b:y=o.a.createElement(i.Fragment,null,o.a.createElement(It.a,{size:"small",color:"inherit",onClick:function(e){h(e.currentTarget)}},o.a.createElement(xt.a,{fontSize:"small"})),o.a.createElement(ft.a,{open:Boolean(d),anchorEl:d,onClose:function(){h(null)},anchorOrigin:{vertical:"bottom",horizontal:"center"},transformOrigin:{vertical:"top",horizontal:"center"}},o.a.createElement("div",{className:n.popover},"Date ranges are implemented for Dashboard statistics when a route, direction, and stops are selected. Currently showing data for one day."))));var O=Fe.find((function(e){return e.value===E})).shortLabel,S=function(a){var n=a.target.value,r=Ta({},t.daysOfTheWeek);r[n]=a.target.checked,e.handleGraphParams({daysOfTheWeek:r})},I=function(a){for(var n="weekdays"===a.target.value?ze:Ue,r=Ta({},t.daysOfTheWeek),i=!T(r,n),o=0;o<n.length;o++)r[n[o].value]=i;e.handleGraphParams({daysOfTheWeek:r})},w=function(e,t){for(var a=0;a<t.length;a++)if(e[t[a].value])return!1;return!0},T=function(e,t){for(var a=0;a<t.length;a++)if(!e[t[a].value])return!1;return!0},P=Boolean(c),k=P?"simple-popover":void 0;return o.a.createElement("div",{className:n.root},e.isLoading?o.a.createElement(Jt.a,{p:1},o.a.createElement(ea.a,{variant:"indeterminate",disableShrink:!0,style:{color:"white"},size:24})):null,y,o.a.createElement(D.a,{variant:"contained",className:n.button,onClick:function(e){s(e.currentTarget)}},o.a.createElement("div",{className:n.nowrap},o.a.createElement(St.a,{className:n.heading,display:"inline"},b,"\xa0"),o.a.createElement(St.a,{className:n.secondaryHeading,display:"inline"},O,o.a.createElement(na.a,null)))),o.a.createElement(ft.a,{id:k,open:P,anchorEl:c,onClose:g,anchorOrigin:{vertical:"bottom",horizontal:"right"},transformOrigin:{vertical:"top",horizontal:"right"}},o.a.createElement(It.a,{size:"small","aria-label":"close",className:n.closeButton,onClick:g},o.a.createElement(ha.a,null)),o.a.createElement(Gt.a,{style:{color:"black",marginTop:32}},o.a.createElement(zt.a,null,o.a.createElement(la.a,{className:n.formControl},o.a.createElement(ua.a,{id:"startDate",label:"Start Date",type:"date",value:t.startDate,InputProps:{inputProps:{max:t.date,min:Me()(t.date).subtract(Ve,"days").format("YYYY-MM-DD")}},className:n.textField,InputLabelProps:{shrink:!0},onChange:function(t){t.target.value&&e.handleGraphParams({startDate:t.target.value})}}))),o.a.createElement(zt.a,null,o.a.createElement(la.a,{className:n.formControl},o.a.createElement(ua.a,{id:"date",label:"End Date",type:"date",value:t.date,InputProps:{inputProps:{max:f}},className:n.textField,InputLabelProps:{shrink:!0},onChange:function(a){var n=a.target.value;if(n){var r=Me()(n),i=Me()(t.startDate),o={date:n};r.isBefore(t.startDate)?o.startDate=n:r.diff(i,"days")>Ve&&(o.startDate=r.subtract(Ve,"days").format("YYYY-MM-DD")),e.handleGraphParams(o)}else;}}))),o.a.createElement(zt.a,null,o.a.createElement(p.a,{container:!0,style:{maxWidth:250}},Ge.map((function(t){return o.a.createElement(p.a,{item:!0,xs:6,key:t.value},o.a.createElement(D.a,{key:t.value,onClick:function(){!function(t){var a=Ea.graphParams.date,n=Me()(a).subtract(t-1,"days");e.handleGraphParams({date:a,startDate:n.format("YYYY-MM-DD")})}(t.value)}},t.label))})))),o.a.createElement(zt.a,null,o.a.createElement(la.a,{component:"fieldset",className:n.formControl},o.a.createElement(da.a,{component:"legend",className:n.secondaryHeading},"Days of the Week"),o.a.createElement(p.a,{container:!0},o.a.createElement(p.a,{item:!0},o.a.createElement(ca.a,null,o.a.createElement(ma.a,{control:o.a.createElement(Kt.a,{value:"weekdays",checked:!w(t.daysOfTheWeek,ze),indeterminate:!w(t.daysOfTheWeek,ze)&&!T(t.daysOfTheWeek,ze),onChange:I}),label:"Weekdays"}),o.a.createElement(ta.a,{variant:"middle",style:{marginLeft:0}}),ze.map((function(e){return o.a.createElement(ma.a,{control:o.a.createElement(Kt.a,{checked:t.daysOfTheWeek[e.value],onChange:S,value:e.value}),key:e.value,label:e.label})})))),o.a.createElement(p.a,{item:!0},o.a.createElement(ca.a,null,o.a.createElement(ma.a,{control:o.a.createElement(Kt.a,{value:"weekends",checked:!w(t.daysOfTheWeek,Ue),indeterminate:!w(t.daysOfTheWeek,Ue)&&!T(t.daysOfTheWeek,Ue),onChange:I}),label:"Weekends"}),o.a.createElement(ta.a,{variant:"middle",style:{marginLeft:0}}),Ue.map((function(e){return o.a.createElement(ma.a,{control:o.a.createElement(Kt.a,{checked:t.daysOfTheWeek[e.value],onChange:S,value:e.value}),key:e.value,label:e.label})}))))))),o.a.createElement(zt.a,null,o.a.createElement(la.a,{className:n.formControl},o.a.createElement(ia.a,{htmlFor:"time-helper"},"Time Range"),o.a.createElement(sa.a,{value:E,onChange:function(t){if(t.target.value===We)e.handleGraphParams({startTime:null,endTime:null});else{var a=t.target.value.split("-");e.handleGraphParams({startTime:a[0],endTime:a[1]})}},input:o.a.createElement(ra.a,{name:"time_range",id:"time_range"})},Fe.map((function(e){return o.a.createElement(oa.a,{value:e.value,key:e.value},e.shortLabel,e.restOfLabel)}))))),o.a.createElement(zt.a,null,o.a.createElement(D.a,{onClick:function(){var t=Ea.graphParams;e.handleGraphParams({date:t.date,startTime:t.startTime,endTime:t.endTime,daysBack:t.daysBack,startDate:t.date,daysOfTheWeek:t.daysOfTheWeek}),g()}},"Reset")))))}));var Ca=Object(s.connect)((function(e){return{routes:e.routes.routes}}),(function(e){return{myFetchRoutes:function(t){return e(Ke(t))},myHandleGraphParams:function(t){return e(rt(t))}}}))((function(e){var t=e.routes,a=e.myFetchRoutes,n=e.myHandleGraphParams,r=b[0];return Object(i.useEffect)((function(){n({agencyId:r.id}),t||a({agencyId:r.id})}),[t,a,n,r]),o.a.createElement("div",{className:"flex-screen"},o.a.createElement(f.a,{position:"relative"},o.a.createElement(h.a,null,o.a.createElement(Qt,null),o.a.createElement("div",{className:"page-title"},r.title),o.a.createElement(ka,null))),o.a.createElement(p.a,{container:!0,spacing:0},o.a.createElement(p.a,{item:!0,xs:12,sm:6},o.a.createElement(mt,null)),o.a.createElement(p.a,{item:!0,xs:12,sm:6,style:{padding:12}},o.a.createElement(Ft,{routes:t}))))})),xa=a(199),ja=a(9),Ma=a(350),Da=a(348),Ra=a(353),Na=a(121),_a=a.n(Na);function La(e,t){if(!e.percentiles)return null;var a=e.percentiles.find((function(e){return e.percentile===t}));return a?a.value:0}a(141);var Aa=function(e){function t(e){var a;return Object(P.a)(this,t),(a=Object(C.a)(this,Object(x.a)(t).call(this,e))).handleOptionChange=function(e){a.setState({selectedOption:e.target.value})},a.onMouseLeave=function(){a.setState({crosshairValues:[]})},a.onNearestX=function(e,t){var n=t.index;a.setState({crosshairValues:[a.waitData[n],a.tripData[n]]})},a.state={selectedOption:t.AVERAGE_TIME,crosshairValues:[]},a}return Object(M.a)(t,e),Object(k.a)(t,[{key:"mapInterval",value:function(e){var a=this;return function(n){var r=0;return null!=n[e]&&(r=a.state.selectedOption===t.AVERAGE_TIME?La(n[e],50):La(n[e],_e)),void 0===r&&(r=0),{x:"".concat(n.startTime," - ").concat(n.endTime),y:r}}}},{key:"render",value:function(){var e=this.props,a=e.intervalData,n=e.intervalError,r=a;this.waitData=r?r.map(this.mapInterval("waitTimes")):null,this.tripData=r?r.map(this.mapInterval("tripTimes")):null;var i=[{title:"Travel time",color:Ne[1],strokeWidth:10},{title:"Wait time",color:Ne[0],strokeWidth:10}];return o.a.createElement("div",null,r?o.a.createElement("div",null,o.a.createElement(la.a,null,o.a.createElement("div",{className:"controls"},o.a.createElement(ma.a,{control:o.a.createElement(Ra.a,{id:"average_time",type:"radio",value:t.AVERAGE_TIME,checked:this.state.selectedOption===t.AVERAGE_TIME,onChange:this.handleOptionChange}),label:"Median"}),o.a.createElement(ma.a,{control:o.a.createElement(Ra.a,{id:"planning_time",type:"radio",value:t.PLANNING_TIME,checked:this.state.selectedOption===t.PLANNING_TIME,onChange:this.handleOptionChange}),label:"Planning (".concat(_e,"th percentile)")}))),o.a.createElement(ja.l,{xType:"ordinal",height:300,width:400,stackBy:"y",onMouseLeave:this.onMouseLeave},o.a.createElement(ja.f,null),o.a.createElement(ja.k,null),o.a.createElement(ja.m,{hideLine:!0}),o.a.createElement(ja.h,{data:this.waitData,color:Ne[0],onNearestX:this.onNearestX}),o.a.createElement(ja.h,{data:this.tripData,color:Ne[1]}),o.a.createElement(ja.b,{text:"minutes",className:"alt-y-label",includeMargin:!1,xPercent:.06,yPercent:.06,style:{transform:"rotate(-90)",textAnchor:"end"}}),this.state.crosshairValues.length>0&&o.a.createElement(ja.c,{values:this.state.crosshairValues,style:Ae},o.a.createElement("div",{className:"rv-crosshair__inner__content"},o.a.createElement("p",null,"Onboard time:"," ",Math.round(this.state.crosshairValues[1].y)),o.a.createElement("p",null,"Wait time: ",Math.round(this.state.crosshairValues[0].y))))),o.a.createElement(_a.a,{orientation:"horizontal",width:300,items:i})):null,o.a.createElement("code",null,n||""))}}]),t}(i.Component);Aa.AVERAGE_TIME="average_time",Aa.PLANNING_TIME="planning_time";var Wa=Aa,Fa=a(356);function Va(e){var t=e.grades,a=e.gradeName,n=e.hideRating,r=e.title,l=e.largeValue,c=e.smallValue,s=e.bottomContent,u=e.popoverContent,m=Object(pt.a)((function(e){return{popover:{padding:e.spacing(2),maxWidth:500}}}))(),d=Object(i.useState)(null),h=Object(K.a)(d,2),f=h[0],g=h[1];var v,E,b=t?Math.max(Math.round(t[a]/10)/2,.5):0;return o.a.createElement(i.Fragment,null,o.a.createElement(p.a,{item:!0,xs:!0,component:xa.a,style:(v=t,E=a,{background:v?Ie(v[E]/100):"gray",color:v?we(v[E]/100):"black",margin:4})},o.a.createElement(Jt.a,{display:"flex",flexDirection:"column",justifyContent:"flex-start",height:"100%"},o.a.createElement(St.a,{variant:"overline"},r),o.a.createElement(Jt.a,{flexGrow:1}," ",o.a.createElement(St.a,{variant:"h3",display:"inline"},l),o.a.createElement(St.a,{variant:"h5",display:"inline"},c),n?null:o.a.createElement(Fa.a,{readOnly:!0,size:"small",value:b,precision:.5})),o.a.createElement(Jt.a,{display:"flex",justifyContent:"space-between",alignItems:"flex-end",pt:2},s,o.a.createElement(It.a,{size:"small",onClick:function(e){g(e.currentTarget)}},o.a.createElement(xt.a,{fontSize:"small"}))))),o.a.createElement(ft.a,{open:Boolean(f),anchorEl:f,onClose:function(){g(null)},anchorOrigin:{vertical:"bottom",horizontal:"center"},transformOrigin:{vertical:"top",horizontal:"center"}},o.a.createElement("div",{className:m.popover},u)))}function Ga(e){var t=e.rows;return o.a.createElement(gt.a,null,o.a.createElement(vt.a,null,t.map((function(e){return o.a.createElement(yt.a,{key:e.value},o.a.createElement(Et.a,null,e.label),o.a.createElement(Et.a,{align:"right",style:{color:we(e.value/100),backgroundColor:Ie(e.value/100)}},e.value))}))))}var za=a(78),Ua=a.n(za),Ba=a(145),Ha=a.n(Ba);function Ya(e){var t=Object(i.useState)(null),a=Object(K.a)(t,2),n=a[0],r=a[1],l=Object(i.useState)(null),c=Object(K.a)(l,2),s=c[0],u=c[1];var m=e.graphData,d=e.graphParams,h=e.routes,f=m?m.waitTimes:null,g=m?m.tripTimes:null,v=h?function(e,t){var a=0;if(e&&e.endStopId){var n=e.directionId,r=e.routeId,i=t.find((function(e){return e.id===r})),o=i.directions.find((function(e){return e.id===n}));if(o.stop_geometry[e.startStopId]&&o.stop_geometry[e.endStopId])return Ee(o.stop_geometry[e.endStopId].distance-o.stop_geometry[e.startStopId].distance);var l=o.stops.indexOf(e.startStopId),c=o.stops.indexOf(e.endStopId);if(-1!==l&&-1!==c)for(var s=l;s<c;s++){a+=Pe(i.stops[o.stops[s]],i.stops[o.stops[s+1]])}}return a}(d,h):null,E=g&&g.count>0&&v?v/(g.avg/60):0,b=0;if(f&&f.histogram){b=f.histogram.reduce((function(e,t){return t.binStart>=20?e+t.count:e}),0)/100}var y=0;g&&(y=(La(g,_e)-La(g,Le))/2);var O=E&&f.median?Oe(f.median,b,E,y):null,S=null;v?g&&g.count?E?f.median||(S="No median wait time available."):S="Unable to determine speed between selected stops.":S="No trip data between selected stops.":S="Unable to determine distance between selected stops.";var I=Object(pt.a)((function(e){return{uncolored:{margin:e.spacing(1)},popover:{padding:e.spacing(2),maxWidth:500}}}))(),w=Math.round(La(f,_e)),T=Math.round(La(g,_e)),P=Math.round((La(g,_e)-La(g,Le))/2),k=Math.round(f.median),C=Math.round(g.median),x=O?o.a.createElement(i.Fragment,null,"Trip score of ",O.totalScore," is the average of the following subscores:",o.a.createElement(Jt.a,{pt:2},o.a.createElement(gt.a,null,o.a.createElement(vt.a,null,o.a.createElement(yt.a,null,o.a.createElement(Et.a,null,"Median wait"),o.a.createElement(Et.a,{align:"right"},O.medianWaitScore)),o.a.createElement(yt.a,null,o.a.createElement(Et.a,null,"Long wait probability"),o.a.createElement(Et.a,{align:"right"},O.longWaitScore)),o.a.createElement(yt.a,null,o.a.createElement(Et.a,null,"Speed for median trip"),o.a.createElement(Et.a,{align:"right"}," ",O.speedScore)),o.a.createElement(yt.a,null,o.a.createElement(Et.a,null,"Travel time variability"),o.a.createElement(Et.a,{align:"right"}," ",O.travelVarianceScore)))))):null,j=O?o.a.createElement(i.Fragment,null,"Median wait of ",f.median.toFixed(1)," min gets a score of"," ",O.medianWaitScore,".",o.a.createElement(Jt.a,{pt:2},o.a.createElement(Ga,{rows:[{label:"5 min or less",value:100},{label:"6.25 min",value:75},{label:"7.5 min",value:50},{label:"8.75",value:25},{label:"10 min or more",value:0}]}))):null,M=O?o.a.createElement(i.Fragment,null,'Long wait probability is the chance a rider has of a wait of twenty minutes or longer after arriving randomly at the "from" stop. Probability of'," ",(100*b).toFixed(1),"% gets a score of ",O.longWaitScore,".",o.a.createElement(Jt.a,{pt:2},o.a.createElement(Ga,{rows:[{label:"10% or less",value:100},{label:"15.75%",value:75},{label:"21.5%",value:50},{label:"27.25%",value:25},{label:"33% or more",value:0}]}))):null,D=O?o.a.createElement(i.Fragment,null,"Speed for median trip of ",E.toFixed(1)," ","mph gets a score of ",O.speedScore,".",o.a.createElement(Jt.a,{pt:2},o.a.createElement(Ga,{rows:[{label:"10 mph or more",value:100},{label:"8.75 mph",value:75},{label:"7.5 mph",value:50},{label:"6.25 mph",value:25},{label:"5 mph or less",value:0}]}))):null,R=O?o.a.createElement(i.Fragment,null,"Travel time variability is the 90th percentile travel time minus the 10th percentile travel time.  This measures how much extra travel time is needed for some trips. Variability of ","\xb1"+y.toFixed(1)," min gets a score of"," ",O.travelVarianceScore,".",o.a.createElement(Jt.a,{pt:2},o.a.createElement(Ga,{rows:[{label:"5 min or less",value:100},{label:"6.25 min",value:75},{label:"7.5 min",value:50},{label:"8.75 min",value:25},{label:"10 min or more",value:0}]}))):null;return o.a.createElement(i.Fragment,null,o.a.createElement("div",{style:{padding:8}},O?o.a.createElement(i.Fragment,null,o.a.createElement(p.a,{container:!0,spacing:4},o.a.createElement(p.a,{item:!0,xs:!0,component:xa.a,className:I.uncolored},o.a.createElement(St.a,{variant:"overline"},"Typical journey"),o.a.createElement("br",null),o.a.createElement(St.a,{variant:"h3",display:"inline"},k+C),o.a.createElement(St.a,{variant:"h5",display:"inline"},"\xa0min"),o.a.createElement(Jt.a,{display:"flex",justifyContent:"space-between",alignItems:"flex-end",pt:2},o.a.createElement(St.a,{variant:"body1"},o.a.createElement(Ha.a,{fontSize:"small",style:{verticalAlign:"sub"}}),"\xa0",k," min",o.a.createElement("br",null),o.a.createElement(Ua.a,{fontSize:"small",style:{verticalAlign:"sub"}}),"\xa0",C," min"),o.a.createElement(It.a,{size:"small",onClick:function(e){r(e.currentTarget)}},o.a.createElement(xt.a,{fontSize:"small"})))),o.a.createElement(p.a,{item:!0,xs:!0,component:xa.a,className:I.uncolored},o.a.createElement(St.a,{variant:"overline"},"Journey planning"),o.a.createElement("br",null),o.a.createElement(St.a,{variant:"h3",display:"inline"},w+T),o.a.createElement(St.a,{variant:"h5",display:"inline"},"\xa0min"),o.a.createElement(Jt.a,{display:"flex",justifyContent:"space-between",alignItems:"flex-end",pt:2},o.a.createElement(St.a,{variant:"body1"},o.a.createElement(Ha.a,{fontSize:"small",style:{verticalAlign:"sub"}}),"\xa0",w," min",o.a.createElement("br",null),o.a.createElement(Ua.a,{fontSize:"small",style:{verticalAlign:"sub"}}),"\xa0",T," min"),o.a.createElement(It.a,{size:"small",onClick:function(e){u(e.currentTarget)}},o.a.createElement(xt.a,{fontSize:"small"})))),o.a.createElement(Va,{grades:O,gradeName:"totalScore",hideRating:!0,title:"Trip Score",largeValue:O?O.totalScore:"--",smallValue:"/".concat(O?O.highestPossibleScore:"--"),bottomContent:"\xa0",popoverContent:x}),o.a.createElement(Va,{grades:O,gradeName:"medianWaitScore",title:"Median Wait",largeValue:Math.round(f.median),smallValue:"\xa0min",bottomContent:"\xa0",popoverContent:j}),o.a.createElement(Va,{grades:O,gradeName:"longWaitScore",title:"Long Wait %",largeValue:Math.round(100*b),smallValue:"%",bottomContent:b>0?"1 time out of ".concat(Math.round(1/b)):"",popoverContent:M}),o.a.createElement(Va,{grades:O,gradeName:"speedScore",title:"Median Trip Speed",largeValue:E.toFixed(0),smallValue:"\xa0mph",bottomContent:"".concat(v.toFixed(1)," miles"),popoverContent:D}),o.a.createElement(Va,{grades:O,gradeName:"travelVarianceScore",title:"Travel Time Variability",largeValue:"\xb1"+P,smallValue:"\xa0min",bottomContent:"\xa0",popoverContent:R})),o.a.createElement(ft.a,{open:Boolean(n),anchorEl:n,onClose:function(){r(null)},anchorOrigin:{vertical:"bottom",horizontal:"center"},transformOrigin:{vertical:"top",horizontal:"center"}},o.a.createElement("div",{className:I.popover},"This is the median wait time when a rider arrives randomly at a stop or a rider starts checking predictions.  This is combined with the median trip time.")),o.a.createElement(ft.a,{open:Boolean(s),anchorEl:s,onClose:function(){u(null)},anchorOrigin:{vertical:"bottom",horizontal:"center"},transformOrigin:{vertical:"top",horizontal:"center"}},o.a.createElement("div",{className:I.popover},"When planning to arrive by a specific time, the 90th percentile wait time and 90th percentile travel time suggest how far in advance to start checking predictions.  Walking time should also be added."))):"No trip summary (".concat(S,")")))}var $a=function(e){var t=o.a.useState({}),a=Object(K.a)(t,2),n=a[0],r=a[1],i=o.a.useState(0),l=Object(K.a)(i,2),c=l[0],s=l[1],u=e.graphData,m=e.graphError,d=e.graphParams,p=e.intervalData,h=e.intervalError,g=e.routes,v=u?u.headways:null,E=u?u.waitTimes:null,b=u?u.tripTimes:null,y=v&&v.histogram?v.histogram.map((function(e){return{x0:e.binStart,x:e.binEnd,y:e.count}})):null,O=E&&E.histogram?E.histogram.map((function(e){return{x0:e.binStart,x:e.binEnd,y:e.count}})):null,S=b&&b.histogram?b.histogram.map((function(e){return{x0:e.binStart,x:e.binEnd,y:e.count}})):null;function I(){r({})}function w(e){return{id:"simple-tab-".concat(e),"aria-controls":"simple-tabpanel-".concat(e)}}return o.a.createElement("div",null,o.a.createElement("br",null),o.a.createElement(f.a,{position:"static",color:"default"},o.a.createElement(Ma.a,{value:c,onChange:function(e,t){s(t)},"aria-label":"tab bar",variant:"scrollable",scrollButtons:"on"},o.a.createElement(Da.a,Object.assign({style:{minWidth:72},label:"Summary"},w(0))),o.a.createElement(Da.a,Object.assign({style:{minWidth:72},label:"Time of Day"},w(1))),o.a.createElement(Da.a,Object.assign({style:{minWidth:72},label:"Headways"},w(2))),o.a.createElement(Da.a,Object.assign({style:{minWidth:72},label:"Wait Times"},w(3))),o.a.createElement(Da.a,Object.assign({style:{minWidth:72},label:"Trip Times"},w(4))))),v&&g?o.a.createElement("div",null,o.a.createElement(Jt.a,{p:2,hidden:0!==c},o.a.createElement(Ya,{graphData:u,graphParams:d,routes:g})),o.a.createElement(Jt.a,{p:2,hidden:1!==c},o.a.createElement(St.a,{variant:"h5",display:"inline"},"Performance by Time of Day"),o.a.createElement(Wa,{intervalData:p,intervalError:h})),o.a.createElement(Jt.a,{p:2,hidden:2!==c},o.a.createElement(St.a,{variant:"h5",display:"inline"},"Headways (Time Between Vehicles)"),o.a.createElement("p",null,v.count+1," arrivals, median headway"," ",Math.round(v.median)," minutes, max headway"," ",Math.round(v.max)," minutes"),o.a.createElement(ja.l,{xDomain:[0,Math.max(60,Math.round(v.max)+5)],height:200,width:400,onMouseLeave:I},o.a.createElement(ja.f,null),o.a.createElement(ja.k,null),o.a.createElement(ja.m,{hideLine:!0}),o.a.createElement(ja.j,{data:y,onNearestX:function(e,t){var a=t.index;r({headway:[y[a]]})},stroke:"white",fill:Ne[0],style:{strokeWidth:2}}),o.a.createElement(ja.b,{text:"arrivals",className:"alt-y-label",includeMargin:!1,xPercent:.06,yPercent:.06,style:{transform:"rotate(-90)",textAnchor:"end"}}),o.a.createElement(ja.b,{text:"minutes",className:"alt-x-label",includeMargin:!1,xPercent:.9,yPercent:.94}),n.headway&&o.a.createElement(ja.c,{values:n.headway,style:Ae},o.a.createElement("div",{className:"rv-crosshair__inner__content"},"Arrivals: ",Math.round(n.headway[0].y)))))):null,E?o.a.createElement(Jt.a,{p:2,hidden:3!==c},o.a.createElement(St.a,{variant:"h5",display:"inline"},"Wait Times"),o.a.createElement("p",null,"median wait time ",Math.round(E.median)," minutes, max wait time"," ",Math.round(E.max)," minutes"),o.a.createElement(ja.l,{xDomain:[0,Math.max(60,Math.round(E.max)+5)],height:200,width:400,onMouseLeave:I},o.a.createElement(ja.f,null),o.a.createElement(ja.k,null),o.a.createElement(ja.m,{hideLine:!0,tickFormat:function(e){return"".concat(e,"%")}}),o.a.createElement(ja.j,{data:O,onNearestX:function(e,t){var a=t.index;r({wait:[O[a]]})},stroke:"white",fill:Ne[0],style:{strokeWidth:2}}),o.a.createElement(ja.b,{text:"chance",className:"alt-y-label",includeMargin:!1,xPercent:.06,yPercent:.06,style:{transform:"rotate(-90)",textAnchor:"end"}}),o.a.createElement(ja.b,{text:"minutes",className:"alt-x-label",includeMargin:!1,xPercent:.9,yPercent:.94}),n.wait&&o.a.createElement(ja.c,{values:n.wait,style:Ae},o.a.createElement("div",{className:"rv-crosshair__inner__content"},"Chance: ",Math.round(n.wait[0].y),"%")))):null,b?o.a.createElement(Jt.a,{p:2,hidden:4!==c},o.a.createElement(St.a,{variant:"h5",display:"inline"},"Trip Times"),o.a.createElement("p",null,b.count," trips, median ",Math.round(b.median)," ","minutes, max ",Math.round(b.max)," minutes"),o.a.createElement(ja.l,{xDomain:[0,Math.max(60,Math.round(b.max)+5)],height:200,width:400,onMouseLeave:I},o.a.createElement(ja.f,null),o.a.createElement(ja.k,null),o.a.createElement(ja.m,{hideLine:!0}),o.a.createElement(ja.j,{data:S,onNearestX:function(e,t){var a=t.index;r({trip:[S[a]]})},stroke:"white",fill:Ne[1],style:{strokeWidth:2}}),o.a.createElement(ja.b,{text:"trips",className:"alt-y-label",includeMargin:!1,xPercent:.06,yPercent:.06,style:{transform:"rotate(-90)",textAnchor:"end"}}),o.a.createElement(ja.b,{text:"minutes",className:"alt-x-label",includeMargin:!1,xPercent:.9,yPercent:.94}),n.trip&&o.a.createElement(ja.c,{values:n.trip,style:Ae},o.a.createElement("div",{className:"rv-crosshair__inner__content"},"Trips: ",Math.round(n.trip[0].y))))):null,m?o.a.createElement(Jt.a,{p:2},o.a.createElement("code",null,m)):null)},Xa=a(122),qa=a.n(Xa),Za=a(195),Qa=a.n(Za);function Ja(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}var Ka=function(e){function t(e){var a;return Object(P.a)(this,t),(a=Object(C.a)(this,Object(x.a)(t).call(this,e))).populateStop=function(e,t,a,n,r,i){var l=null;return l=t?z.a.divIcon({className:"custom-icon",iconSize:[240,24],iconAnchor:[12,12],html:'<svg width="24" height="24" viewBox="-10 -10 10 10">'+'<circle cx="-5" cy="-5" r="4.5" fill="white" stroke="'.concat(Re.INDIGO,'" stroke-width="0.75"/>')+'</svg><div style="position:relative; top: -26px; left:2px">'+Qa.a.renderToString(o.a.createElement(t,{style:{color:Re.INDIGO},fontSize:"small"}))+'</div><div style="position:relative; top:-50px; left:25px; font-weight:bold; color:'+Re.INDIGO+"; text-shadow: -1px 1px 0 #fff,1px 1px 0 #fff,1px -1px 0 #fff,"+'-1px -1px 0 #fff;">'.concat(e.title,"</div>")}):z.a.divIcon({className:"id".concat(e.sid),iconSize:[20,20],iconAnchor:[10,10],html:'<svg viewBox="-10 -10 10 10"><g transform="rotate('.concat(n,' -5 -5)">')+'<circle cx="-5" cy="-5" r="3" fill="white" stroke="'.concat(Re.INDIGO,'" stroke-width="0.75"/>')+'<polyline points="-5.5,-6 -4,-5 -5.5,-4" stroke-linecap="round" stroke-linejoin="round" stroke="'.concat(Re.INDIGO,'" stroke-width="0.6" fill="none"/>')+"</g></svg>"}),o.a.createElement(_.a,{key:e.sid+"-marker",position:a,icon:l,onClick:function(e){e.sourceTarget.closeTooltip(),r()}},i)},a.angleFromTo=function(e,t){var a=t.lon-e.lon,n=e.lat-t.lat;return Math.round(180*Math.atan2(n,a)/Math.PI)},a.populateStops=function(e,t,n){var r=[];return e&&e[t]&&(r=e[t].map((function(e){var r=[e.lat,e.lon],i=e.sid===a.props.graphParams.startStopId,l=e.sid===a.props.graphParams.endStopId,c=o.a.createElement(A.a,null,e.title,o.a.createElement("br",null),n.title),s=null;i?s=Ua.a:l&&(s=qa.a);var u=0,m=n.stop_geometry[e.sid];if(m){var d=n.coords[m.after_index],p=n.coords[m.after_index+1];u=a.angleFromTo(d,p)}return a.populateStop(e,s,r,u,(function(){return a.handleStopSelect(e,t)}),c)}))),r},a.populateSpeed=function(e,t,n,r){for(var i=n[r],l=[],c=!1,s=!1,u=0;u<i.length-1;u++){var m=a.getSpeed(e,t,i,u,r);i[u].sid===a.props.graphParams.startStopId&&(c=!0),i[u].sid===a.props.graphParams.endStopId&&(s=!0);var d="white",p=12;a.props.graphParams.endStopId&&c&&!s&&(d=Re.INDIGO,p=14),l.push(o.a.createElement(W.a,{key:"poly-speed-white-".concat(r,"-").concat(i[u].sid),positions:ot(e,t,i[u].sid,i[u+1].sid),color:d,opacity:1,weight:p})),l.push(o.a.createElement(W.a,{key:"poly-speed-".concat(r,"-").concat(i[u].sid),positions:ot(e,t,i[u].sid,i[u+1].sid),color:m<0?"white":a.speedColor(m),opacity:1,weight:7,onClick:function(e){e.originalEvent.view.L.DomEvent.stopPropagation(e)}},o.a.createElement(A.a,null,m<0?"?":m.toFixed(1)," mph to"," ",i[u+1].title)))}return l},a.getSpeed=function(e,t,n,r,i){var o=a.props.graphParams,l=o.routeId,c=n[r].sid,s=n[r+1].sid,u=function(e,t,a,n,r){var i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"median",o=de(e,t,a,n);if(!o)return null;var l=o[r];return"median"===i?se(l,1):"p10"===i?se(l,0):"p90"===i?se(l,2):null}(a.props.tripTimesCache,o,l,i,c),m=null;return u&&u[s]?(m=u[s],function(e,t){var a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:t.stops[0],n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:t.stops[t.stops.length-1],r=e.stops[a],i=e.stops[n],o=t.stop_geometry[a],l=t.stop_geometry[n];return o&&l?Ee(l.distance-o.distance):Pe(r,i)}(e,t,c,s)/m*60):-1},a.SpeedLegend=function(){var e=[2.5,6.25,8.75,12.5],t=[" < 5","5-7.5","7.5-10","10+"],n=e.map((function(n){return o.a.createElement("div",{key:n},o.a.createElement("i",{style:{backgroundColor:a.speedColor(n),width:18,float:"left"}},"\xa0")," ","\xa0",t[e.indexOf(n)])}));return o.a.createElement(B.a,{position:"bottomright"},o.a.createElement("div",{style:{backgroundColor:"white",padding:"5px"}},"Speed (mph)",n))},a.handleStopSelect=function(e,t){var n=a.props.graphParams,r=n.routeId,i=n.startStopId,o=n.endStopId,l=n.directionId;if(i)if(o)i=e.sid,o=null,l=t;else if(l!==t)i=e.sid,o=null,l=t;else{var c=a.props.routes.find((function(e){return e.id===r})).directions.find((function(e){return e.id===l})).stops;c.indexOf(e.sid)<c.indexOf(i)?(o=i,i=e.sid):o=e.sid}else i=e.sid,o=null,l=t;var s=new J;s.buildPath(q,l).buildPath(Z,i),o&&s.buildPath(Q,o),s.commitPath(),(0,a.props.onGraphParams)({startStopId:i,endStopId:o,directionId:l})},a.getStopsInfoInGivenDirection=function(e,t){return e.directions.find((function(e){return e.id===t})).stops.map((function(t){var a=function(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?Ja(a,!0).forEach((function(t){Object(ke.a)(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):Ja(a).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}({},e.stops[t]);return a.sid=t,a}))},a.agency=b[0],a.state={height:a.computeHeight()},a}return Object(M.a)(t,e),Object(k.a)(t,[{key:"componentDidMount",value:function(){this.boundUpdate=this.updateDimensions.bind(this),window.addEventListener("resize",this.boundUpdate)}},{key:"componentWillUnmount",value:function(){window.removeEventListener("resize",this.updateDimensions.bind(this))}},{key:"computeHeight",value:function(){return(window.innerWidth>=640?window.innerHeight:window.innerHeight/2)-64}},{key:"updateDimensions",value:function(){var e=this.computeHeight();this.setState({height:e})}},{key:"speedColor",value:function(e){return H.b().domain([2.5,12.5]).range(["#8d1212","#e60000","#f07d02","#84ca50"])(e)}},{key:"render",value:function(){var e=this,t=this.props,a=t.position,n=t.zoom,r={width:"100%",height:this.state.height},i=this.props,l=i.routes,c=i.graphParams,s=null,u=null,m=[];l&&c&&(s=l.find((function(e){return e.id===c.routeId})))&&(u={},s.directions.forEach((function(t,a){c.directionId&&c.directionId!==t.id||(u[t.id]=e.getStopsInfoInGivenDirection(s,t.id),m.push(e.populateStops(u,t.id,t)),m.unshift(e.populateSpeed(s,t,u,t.id)))})));var d=c.directionId?c.startStopId?c.endStopId?"":"Click a destination stop.":"Click an origin stop.":"Select a direction to see stops in that direction.";return o.a.createElement(F.a,{center:a||this.agency.initialMapCenter,bounds:u?u[s.directions[0].id]:null,zoom:n||this.agency.initialMapZoom,style:r},o.a.createElement(V.a,{attribution:'Map tiles by <a href="http://stamen.com">Stamen Design</a>, under <a href="http://creativecommons.org/licenses/by/3.0">CC BY 3.0</a>. Data by <a href="http://openstreetmap.org">OpenStreetMap</a>, under <a href="http://www.openstreetmap.org/copyright">ODbL</a>.',url:"https://stamen-tiles.a.ssl.fastly.net/toner-lite/{z}/{x}/{y}.png",opacity:.3}),m,o.a.createElement(this.SpeedLegend,null),o.a.createElement(B.a,{position:"topright"},c.startStopId&&c.endStopId?null:o.a.createElement("div",{className:"map-instructions"},d)))}}]),t}(i.Component),en=Object(s.connect)((function(e){return{graphParams:e.routes.graphParams,tripTimesCache:e.routes.tripTimesCache}}),(function(e){return{onGraphParams:function(t){return e(rt(t))}}}))(Ka);function tn(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}var an=Object(pt.a)((function(e){return{root:{display:"flex",flexWrap:"wrap"},formControl:{margin:e.spacing(1),minWidth:120}}}));var nn=Object(s.connect)((function(e){return{graphParams:e.routes.graphParams}}),(function(e){return{onGraphParams:function(t){return e(rt(t))}}}))((function(e){var t=e.routes,a=e.graphParams,n=[],r=Object(i.useState)(!1),l=Object(K.a)(r,2),c=l[0],s=l[1];function u(){var a=e.graphParams.routeId;return t?t.find((function(e){return e.id===a})):null}var m=u();function d(e,t,a){var n=function(e,t){return e.directions.find((function(e){return e.id===t}))}(e,t).stops,r=a?n.indexOf(a):0,i=n[0]===n[n.length-1],o=n.slice(r+1);return i?o.concat(n.slice(1,r)):o}function h(e,t){e&&c&&(e.classList.add("on-hover"),e.style.setProperty("--stop-name",'"'.concat(t,'"')))}function f(e){e&&e.classList.remove("on-hover")}function g(){s(!1),document.querySelectorAll(".on-hover").forEach((function(e){return e.classList.remove("on-hover")}))}var v=null;m&&m.directions&&a.directionId&&(v=m.directions.find((function(e){return e.id===a.directionId}))),v&&(n=d(m,a.directionId,a.startStopId));var E=an();return o.a.createElement("div",{className:"ControlPanel"},o.a.createElement(p.a,{container:!0},o.a.createElement(p.a,{item:!0,xs:!0},o.a.createElement(la.a,{className:E.formControl},o.a.createElement(ia.a,{htmlFor:"route"},"Route"),o.a.createElement(sa.a,{value:a.routeId||0,onChange:function(t){var a=t.target.value,n=e.routes?e.routes.find((function(e){return e.id===a})):null;if(n){var r=n.directions.length>0?n.directions[0].id:null;(new J).buildPath(X,a).buildPath(q,r).commitPath(),e.onGraphParams({routeId:a,directionId:r,startStopId:null,endStopId:null})}},input:o.a.createElement(ra.a,{name:"route",id:"route"})},(t||[]).map((function(e){return o.a.createElement(oa.a,{key:e.id,value:e.id},e.title)}))))),m?o.a.createElement(p.a,{item:!0,xs:!0},o.a.createElement(la.a,{className:E.formControl},o.a.createElement(ia.a,{htmlFor:"direction"},"Direction"),o.a.createElement(sa.a,{value:a.directionId||"",onChange:function(t){var a=t.target.value;return(new J).buildPath(q,a).commitPath(),e.onGraphParams({directionId:a,startStopId:null,endStopId:null})},input:o.a.createElement(ra.a,{name:"direction",id:"direction"})},(m.directions||[]).map((function(e){return o.a.createElement(oa.a,{key:e.id,value:e.id},e.title)}))))):null,v?o.a.createElement(p.a,{container:!0},o.a.createElement(p.a,{item:!0,xs:!0},o.a.createElement(Jt.a,{ml:1},o.a.createElement(Ua.a,{fontSize:"small",htmlColor:Re.INDIGO}),o.a.createElement(la.a,{className:E.formControl},o.a.createElement(ia.a,{htmlFor:"fromstop"},"From Stop"),o.a.createElement(sa.a,{value:a.startStopId||1,onChange:function(t){var a=t.target.value,r=e.graphParams.directionId,i=e.graphParams.endStopId,o=function(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?tn(a,!0).forEach((function(t){Object(ke.a)(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):tn(a).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}({},u());n=d(o,r,a);var l=new J;l.buildPath(Z,a),i&&l.buildPath(Q,i),l.commitPath(),e.onGraphParams({startStopId:a,endStopId:i})},input:o.a.createElement(ra.a,{name:"stop",id:"fromstop"}),onOpen:function(){return s(!0)},onClose:g},(v.stops||[]).map((function(e){var t=document.querySelector(".id".concat(e)),a=(m.stops[e]||{title:e}).title;return o.a.createElement(oa.a,{key:e,value:e,onMouseOver:function(){return h(t,a)},onFocus:function(){return h(t,a)},onMouseOut:function(){return f(t)},onBlur:function(){return f(t)}},a)})))))),o.a.createElement(p.a,{item:!0,xs:!0},o.a.createElement(Jt.a,{ml:1},o.a.createElement(qa.a,{fontSize:"small",htmlColor:Re.INDIGO}),o.a.createElement(la.a,{className:E.formControl},o.a.createElement(ia.a,{htmlFor:"tostop"},"To Stop"),o.a.createElement(sa.a,{value:a.endStopId||1,onChange:function(t){var a=t.target.value;(new J).buildPath(Q,a).commitPath(),e.onGraphParams({endStopId:a})},input:o.a.createElement(ra.a,{name:"stop",id:"tostop"}),onOpen:function(){return s(!0)},onClose:g},(n||[]).map((function(e){var t=document.querySelector(".id".concat(e)),a=(m.stops[e]||{title:e}).title;return o.a.createElement(oa.a,{key:e,value:e,onMouseOver:function(){return h(t,a)},onFocus:function(){return h(t,a)},onMouseOut:function(){return f(t)},onBlur:function(){return f(t)}},a)}))))))):null))}));var rn=Object(s.connect)((function(e){return{routes:e.routes.routes,graphParams:e.routes.graphParams,waitTimesCache:e.routes.waitTimesCache,tripTimesCache:e.routes.tripTimesCache}}))((function(e){var t=Object(i.useState)([]),a=Object(K.a)(t,2),n=a[0],r=a[1],l=e.graphParams,c=null,s=null,u=null;if(e.routeId||l.routeId){var m=e.routeId||l.routeId;null!=(s=e.directionId||l.directionId)&&(u=ve(e.tripTimesCache,l,e.routes,m,s)),c=function(e,t,a){var n=ge(e.tripTimesCache,e.graphParams,e.routes,t,a),r=n.tripTimesForFirstStop,i=n.directionInfo;if(!r)return[];var o=e.routes.find((function(e){return e.id===t})),l=[];return i.stops.slice(1).map((function(e,t){return i.stop_geometry[e]&&r[e]&&l.push({x:Ee(i.stop_geometry[e].distance),y:r[e][1],title:o.stops[e].title,stopIndex:t}),null})),l}(e,m,s)}return s?o.a.createElement(i.Fragment,null,o.a.createElement(St.a,{variant:"h5"},"Travel time along route"),"Full travel time: ",u," minutes \xa0\xa0 Stops:"," ",c[c.length-1]?c[c.length-1].stopIndex+1:"?",o.a.createElement("br",null),o.a.createElement(ja.l,{height:300,width:400,xDomain:[0,c.reduce((function(e,t){return t.x>e?t.x:e}),0)],yDomain:[0,c.reduce((function(e,t){return t.y>e?t.y:e}),0)],onMouseLeave:function(){r([])}},o.a.createElement(ja.f,null),o.a.createElement(ja.i,null),o.a.createElement(ja.k,{tickPadding:4}),o.a.createElement(ja.m,{hideLine:!0,tickPadding:4}),o.a.createElement(ja.g,{data:c,stroke:"#aa82c5",color:"aa82c5",style:{strokeWidth:"3px"},size:"1",onNearestX:function(e){r([e])}}),o.a.createElement(ja.b,{text:"Minutes",className:"alt-y-label",includeMargin:!0,xPercent:.02,yPercent:.2,style:{transform:"rotate(-90)",textAnchor:"end"}}),o.a.createElement(ja.b,{text:"Distance Along Route (miles)",className:"alt-x-label",includeMargin:!0,xPercent:.7,yPercent:.86,style:{textAnchor:"end"}}),n.length>0&&o.a.createElement(ja.c,{values:n,style:{line:{background:"none"}}},o.a.createElement("div",{className:"rv-crosshair__inner__content"},o.a.createElement("p",null,Math.round(n[0].y)," min"),o.a.createElement("p",null,n[0].title),o.a.createElement("p",null,"(Stop #",n[0].stopIndex+1,")")))),o.a.createElement(_a.a,{orientation:"horizontal",width:300,items:[{title:"Actual",color:"#aa82c5",strokeWidth:10}]})):o.a.createElement(i.Fragment,null,"Select a direction to see the travel time chart.")}));a(274);var on=Object(s.connect)((function(e){return{routes:e.routes.routes,graphParams:e.routes.graphParams,arrivals:e.routes.arrivals,arrivalsErr:e.routes.arrivalsErr}}),(function(e){return{myFetchArrivals:function(t){return e(tt(t))},myResetArrivals:function(t){return e((function(e){e({type:"ERROR_ARRIVALS",payload:null})}))}}}))((function(e){var t=e.graphParams,a=e.myFetchArrivals,n=e.myResetArrivals,r=e.arrivals,l=e.arrivalsErr,c=e.routes,s=e.hidden,u=Object(i.useState)(),m=Object(K.a)(u,2),d=m[0],p=m[1],h=Object(i.useState)(),f=Object(K.a)(h,2),g=f[0],v=f[1],E=Object(i.useState)(),b=Object(K.a)(E,2),y=b[0],O=b[1],S=Object(i.useState)("Inbound_and_outbound"),I=Object(K.a)(S,2),w=I[0],P=I[1],k=T(t.agencyId),C=k?k.timezoneId:"UTC";Object(i.useEffect)((function(){!r||r.date===t.date&&r.route_id===t.routeId||n(null)}),[t,n,r]),Object(i.useEffect)((function(){r||!t.routeId||s||a(t)}),[t,a,r,s]),Object(i.useEffect)((function(){if(r&&c){var e=function(e,t){var a={byTripId:{},earliestArrivalTime:null,latestArrivalTime:null},n=e.stops,r=e.start_time,i=Me.a.unix(r).tz(C).hour(),o=e.route_id,l=t.find((function(e){return e.id===o}));return Object.keys(n).forEach((function(e){var t=n[e].arrivals;Object.keys(t).forEach((function(n){var o=l.directions.find((function(e){return e.id===n}));t[n].forEach((function(t){!function(e,t,a,n,r,i,o){var l=e,c=t.i,s=t.v;if(void 0===l.byTripId[c]&&(l.byTripId[c]={tripId:c,vehicleId:s,series:[],directionInfo:r}),r&&r.stop_geometry[a]){var u=r.stop_geometry[a].distance;"0"===r.id&&(u=r.distance-u),u=Ee(u);var m=Me.a.unix(t.t).tz(C),d=(t.t-i)/60/60+o;if(l.byTripId[c].series.push({stopId:a,title:n.stops[a].title,arrivalTimeString:m.format("h:mm a"),vehicleId:s,x:u,y:d}),(null===l.earliestArrivalTime||d<l.earliestArrivalTime)&&(l.earliestArrivalTime=d),(null===l.latestArrivalTime||d>l.latestArrivalTime)&&(l.latestArrivalTime=d),t.e-t.t>Be){var p=Me.a.unix(t.e).tz(C),h=(t.e-i)/60/60+o;l.byTripId[c].series.push({stopId:a,title:n.stops[a].title,arrivalTimeString:p.format("h:mm a"),vehicleId:s,x:u,y:h})}}}(a,t,e,l,o,r,i)}))}))})),a}(r,c);O(e)}else O(null)}),[r,c,C]);var x=null,j=0,M=12;return y&&(x=function(e){var t=H.b([0,9],H.d),a=[];return Object.keys(e.byTripId).forEach((function(n){var r=e.byTripId[n];if("Inbound_and_outbound"===w||r.directionInfo&&r.directionInfo.id===w){var i=r.series.sort((function(e,t){var a=t.y-e.y;return 0!==a?a:t.x-e.x}));a.push(o.a.createElement(ja.g,{key:n,data:i,stroke:t(r.vehicleId%9),style:{strokeWidth:g===n?"3px":"1px"},size:"1",onValueMouseOver:function(e){return p(e)},onSeriesMouseOver:function(){v(n)}}))}})),a}(y),j=Math.floor(y.earliestArrivalTime),M=Math.ceil(y.latestArrivalTime)),t.startTime&&(j=parseInt(t.startTime,10)),t.endTime&&(M=parseInt(t.endTime,10),t.endTime.endsWith("+1")&&(M+=24)),y?o.a.createElement(i.Fragment,null,o.a.createElement(St.a,{variant:"h5"},"Marey chart"),"Vehicle runs: ",x.length," ",o.a.createElement("br",null),o.a.createElement(la.a,null,o.a.createElement("div",{className:"controls"},o.a.createElement(ma.a,{control:o.a.createElement(Ra.a,{id:"inbound_and_outbound",type:"radio",value:"Inbound_and_outbound",checked:"Inbound_and_outbound"===w,onChange:function(e){return P(e.target.value)}}),label:"Inbound and Outbound"}),o.a.createElement(ma.a,{control:o.a.createElement(Ra.a,{id:"inbound",type:"radio",value:"1",checked:"1"===w,onChange:function(e){return P(e.target.value)}}),label:"Inbound only"}),o.a.createElement(ma.a,{control:o.a.createElement(Ra.a,{id:"outbound",type:"radio",value:"0",checked:"0"===w,onChange:function(e){return P(e.target.value)}}),label:"Outbound only"}))),o.a.createElement(ja.l,{height:100*(M-j),width:600,yDomain:[M,j],margin:{left:80}},x,o.a.createElement(ja.a,{style:{bottom:{fill:"#fff"},left:{fill:"#fff"},right:{fill:"#fff"},top:{fill:"#fff"}}}),o.a.createElement(ja.f,null),o.a.createElement(ja.i,null),o.a.createElement(ja.k,{tickPadding:4}),o.a.createElement(ja.m,{hideLine:!0,tickPadding:4,tickFormat:function(e){var t="",a=e;a>=24&&(a-=24,t="+1");var n="am";a>=12&&(n="pm"),a>=13&&(a-=12),0===a&&(a=12);var r="".concat(parseInt(a,10),":").concat((60*(a-parseInt(a,10))).toString().padStart(2,"0"));return"".concat(r," ").concat(n).concat(t)}}),o.a.createElement(ja.b,{text:"Time",className:"alt-y-label",includeMargin:!0,xPercent:.02,yPercent:.3,style:{transform:"rotate(-90)"}}),o.a.createElement(ja.b,{text:"Inbound Distance Along Route (miles)",className:"alt-x-label",includeMargin:!0,xPercent:.7,yPercent:1-85/(100*(M-j)),style:{textAnchor:"end"}}),d?o.a.createElement(ja.e,{value:d,format:function(e){return[{title:"Stop",value:e.title},{title:"Time",value:e.arrivalTimeString},{title:"Vehicle ID",value:e.vehicleId}]}}):null)):o.a.createElement(i.Fragment,null,l||"Loading...")}));var ln=Object(s.connect)((function(e){return{routes:e.routes.routes,graphParams:e.routes.graphParams,waitTimesCache:e.routes.waitTimesCache,tripTimesCache:e.routes.tripTimesCache}}),(function(e){return{myFetchPrecomputedWaitAndTripData:function(t){return e(et(t))}}}))((function(e){var t=e.graphParams,a=e.myFetchPrecomputedWaitAndTripData,n=o.a.useState(0),r=Object(K.a)(n,2),l=r[0],c=r[1];Object(i.useEffect)((function(){a(t)}),[t,a]);var s=null,u=null,m=null,d=null,h=null,g=null,v=null,E=null,b=null,y=null,O=null,S=null,I=null,w=null,T=null,P=null;if(t.routeId){T=Se(P=e.routes?he(e.routes):[],I=be(e.waitTimesCache,t,P),w=ye(e.tripTimesCache,t,P));var k=t.routeId,C=P.find((function(e){return e.id===k}));if(C)m=C.directions.reduce((function(e,t){return e+t.distance}),0)/C.directions.length;h=(d=I?I.find((function(e){return e.routeId===k})):null)?I.length-I.indexOf(d):null,s=d?d.wait:null,g=d?d.longWait:null,E=(v=w?w.find((function(e){return e.routeId===k})):null)?w.indexOf(v)+1:null,u=v?v.speed:null,b=v?v.variability:null,S=(O=T?T.find((function(e){return e.routeId===k})):null)?T.indexOf(O)+1:null,y=Oe(s,g,u,b)}var x=y?o.a.createElement(i.Fragment,null,"Route score of ",y.totalScore," is the average of the following subscores:",o.a.createElement(Jt.a,{pt:2},o.a.createElement(gt.a,null,o.a.createElement(vt.a,null,o.a.createElement(yt.a,null,o.a.createElement(Et.a,null,"Median wait"),o.a.createElement(Et.a,{align:"right"},y.medianWaitScore)),o.a.createElement(yt.a,null,o.a.createElement(Et.a,null,"Long wait probability"),o.a.createElement(Et.a,{align:"right"},y.longWaitScore)),o.a.createElement(yt.a,null,o.a.createElement(Et.a,null,"Average speed"),o.a.createElement(Et.a,{align:"right"}," ",y.speedScore)),o.a.createElement(yt.a,null,o.a.createElement(Et.a,null,"Travel time variability"),o.a.createElement(Et.a,{align:"right"}," ",y.travelVarianceScore)))))):null,j=y?o.a.createElement(i.Fragment,null,"Median wait of ",null===s?"--":s.toFixed(1)," min gets a score of ",y.medianWaitScore,".",o.a.createElement(Jt.a,{pt:2},o.a.createElement(Ga,{rows:[{label:"5 min or less",value:100},{label:"6.25 min",value:75},{label:"7.5 min",value:50},{label:"8.75",value:25},{label:"10 min or more",value:0}]}))):null,M=y?o.a.createElement(i.Fragment,null,"Long wait probability is the chance a rider has of a wait of twenty minutes or longer after arriving randomly at a stop. Probability of"," ",(100*g).toFixed(1),"% gets a score of ",y.longWaitScore,".",o.a.createElement(Jt.a,{pt:2},o.a.createElement(Ga,{rows:[{label:"10% or less",value:100},{label:"15.75%",value:75},{label:"21.5%",value:50},{label:"27.25%",value:25},{label:"33% or more",value:0}]}))):null,D=y?o.a.createElement(i.Fragment,null,"This is the average of the speeds for median end to end trips, in all directions. Average speed of"," ",null===u||Number.isNaN(u)?"--":u.toFixed(1)," mph gets a score of ",y.speedScore,".",o.a.createElement(Jt.a,{pt:2},o.a.createElement(Ga,{rows:[{label:"10 mph or more",value:100},{label:"8.75 mph",value:75},{label:"7.5 mph",value:50},{label:"6.25 mph",value:25},{label:"5 mph or less",value:0}]}))):null,R=y?o.a.createElement(i.Fragment,null,"Travel time variability is the 90th percentile end to end travel time minus the 10th percentile travel time.  This measures how much extra travel time is needed for some trips. Variability of"," ",null===b?"--":"\xb1"+b.toFixed(1)," min gets a score of"," ",y.travelVarianceScore,".",o.a.createElement(Jt.a,{pt:2},o.a.createElement(Ga,{rows:[{label:"5 min or less",value:100},{label:"6.25 min",value:75},{label:"7.5 min",value:50},{label:"8.75 min",value:25},{label:"10 min or more",value:0}]}))):null;function N(e){return{id:"simple-tab-".concat(e),"aria-controls":"simple-tabpanel-".concat(e)}}return o.a.createElement(i.Fragment,null,o.a.createElement("br",null),o.a.createElement(f.a,{position:"static",color:"default"},o.a.createElement(Ma.a,{value:l,onChange:function(e,t){c(t)},"aria-label":"tab bar",variant:"scrollable",scrollButtons:"on"},o.a.createElement(Da.a,Object.assign({style:{minWidth:72},label:"Summary"},N(0))),o.a.createElement(Da.a,Object.assign({style:{minWidth:72},label:"Travel Time"},N(1))),o.a.createElement(Da.a,Object.assign({style:{minWidth:72},label:"Marey Chart"},N(2))))),o.a.createElement(Jt.a,{p:2,hidden:0!==l},o.a.createElement("div",{style:{padding:8}},o.a.createElement(p.a,{container:!0,spacing:4},o.a.createElement(Va,{grades:s&&u&&y?y:null,gradeName:"totalScore",hideRating:!0,title:"Route Score",largeValue:s&&u?y.totalScore:"--",smallValue:"/".concat(y?y.highestPossibleScore:"--"),bottomContent:S?"#".concat(S," out of ").concat(T.length," routes"):"No data",popoverContent:x}),o.a.createElement(Va,{grades:s&&y?y:null,gradeName:"medianWaitScore",title:"Median Wait",largeValue:null===s?"--":s.toFixed(0),smallValue:"\xa0min",bottomContent:o.a.createElement(i.Fragment,null,h?"#".concat(h," of ").concat(I.length," for shortest wait"):null),popoverContent:j}),o.a.createElement(Va,{grades:s&&y?y:null,gradeName:"longWaitScore",title:"Long Wait %",largeValue:(100*g).toFixed(0),smallValue:"%",bottomContent:o.a.createElement(i.Fragment,null,g>0?"1 time out of ".concat(Math.round(1/g)):""),popoverContent:M}),o.a.createElement(Va,{grades:u&&y?y:null,gradeName:"speedScore",title:"Average Speed",largeValue:null===u||Number.isNaN(u)?"--":u.toFixed(0),smallValue:"\xa0mph",bottomContent:o.a.createElement(i.Fragment,null,E?"#".concat(E," of ").concat(w.length," for fastest"):null,o.a.createElement("br",null),Ee(m).toFixed(1)," miles"),popoverContent:D}),o.a.createElement(Va,{grades:u&&y?y:null,gradeName:"travelVarianceScore",title:"Travel Time Variability",largeValue:null===b?"--":"\xb1"+b.toFixed(0),smallValue:"\xa0min",bottomContent:"\xa0",popoverContent:R})))),o.a.createElement(Jt.a,{p:2,hidden:1!==l,style:{overflowX:"auto"}},o.a.createElement(rn,null)),o.a.createElement(Jt.a,{p:2,hidden:2!==l,style:{overflowX:"auto"}},o.a.createElement(on,{hidden:2!==l})))}));var cn=Object(s.connect)((function(e){return{graphData:e.fetchGraph.graphData,routes:e.routes.routes,graphError:e.fetchGraph.err,intervalData:e.fetchGraph.intervalData,intervalError:e.fetchGraph.intervalErr,graphParams:e.routes.graphParams}}),(function(e){return{myFetchRoutes:function(t){return e(Ke(t))}}}))((function(e){var t=e.graphData,a=e.graphError,n=e.graphParams,r=e.intervalData,l=e.intervalError,c=e.routes,s=e.myFetchRoutes,u=n?n.agencyId:null;Object(i.useEffect)((function(){!c&&u&&s({agencyId:u})}),[u,c,s]);var m=T(u),d=c&&n&&n.routeId?c.find((function(e){return e.id===n.routeId&&e.agencyId===u})):null,g=d&&n.directionId?d.directions.find((function(e){return e.id===n.directionId})):null,v=g&&n.startStopId?d.stops[n.startStopId]:null,E=g&&n.endStopId?d.stops[n.endStopId]:null;return o.a.createElement(i.Fragment,null,o.a.createElement(f.a,{position:"relative"},o.a.createElement(h.a,null,o.a.createElement(Qt,null),o.a.createElement("div",{className:"page-title"},m?m.title:null),o.a.createElement("div",{style:{flexGrow:1}}),o.a.createElement(ka,{dateRangeSupported:t||a}))),o.a.createElement(xa.a,null,o.a.createElement(Jt.a,{p:2,className:"page-title"},d?" ".concat(d.title):null,g?" > ".concat(g.title):null,"\xa0",v?"(from ".concat(v.title):null,E?" to ".concat(E.title,")"):null)),o.a.createElement(p.a,{container:!0,spacing:0},o.a.createElement(p.a,{item:!0,xs:12,sm:6},o.a.createElement(en,{routes:c})),o.a.createElement(p.a,{item:!0,xs:12,sm:6},o.a.createElement(nn,{routes:c}),t||a?o.a.createElement($a,{graphData:t,graphError:a,graphParams:n,routes:c,intervalData:r,intervalError:l}):o.a.createElement(ln,null))))}));var sn=Object(s.connect)((function(e){return{routes:e.routes.routes,graphParams:e.routes.graphParams,waitTimesCache:e.routes.waitTimesCache,tripTimesCache:e.routes.tripTimesCache}}))((function(e){var t=be(e.waitTimesCache,e.graphParams,e.routes),a=ye(e.tripTimesCache,e.graphParams,e.routes),n=a?a.map((function(e){var a=t.find((function(t){return t.routeId===e.routeId}));return{x:a?a.wait:0,y:e.speed,title:e.routeId}})):[];return o.a.createElement(ja.l,{height:600,width:1e3,xDomain:[30,0],xxyDomain:[0,30]},o.a.createElement(ja.f,null),o.a.createElement(ja.i,null),o.a.createElement(ja.k,{top:300,style:{text:{stroke:"none",fill:"#cccccc"}}}),o.a.createElement(ja.m,{left:500,style:{text:{stroke:"none",fill:"#cccccc"}}}),o.a.createElement(ja.d,{className:"custom-marking",customComponent:function(e){return o.a.createElement("g",{className:"inner-inner-component"},o.a.createElement("circle",{cx:"0",cy:"0",r:e.size||3,fill:"#aa82c5"}),o.a.createElement("text",{x:0,y:0,fontSize:"75%",fill:"#450042"},o.a.createElement("tspan",{x:"5",y:"4"},"".concat(e.title))))},data:n}),o.a.createElement(ja.b,{text:"speed (mph)",className:"alt-y-label",includeMargin:!1,xPercent:.54,yPercent:.06,style:{transform:"rotate(-90)",textAnchor:"end"}}),o.a.createElement(ja.b,{text:"avg wait (min)",className:"alt-x-label",includeMargin:!1,xPercent:.94,yPercent:.5}))})),un=Object(pt.a)({title:{flexGrow:1}});var mn=Object(s.connect)((function(e){return{routes:e.routes.routes,graphParams:e.routes.graphParams,waitTimesCache:e.routes.waitTimesCache,tripTimesCache:e.routes.tripTimesCache}}),(function(e){return{myFetchRoutes:function(t){return e(Ke(t))},myFetchPrecomputedWaitAndTripData:function(t){return e(et(t))},myHandleGraphParams:function(t){return e(rt(t))}}}))((function(e){var t=e.graphParams,a=e.routes,n=e.myFetchRoutes,r=e.myFetchPrecomputedWaitAndTripData,l=e.myHandleGraphParams,c=b[0];Object(i.useEffect)((function(){l({agencyId:c.id}),a||n({agencyId:c.id}),r(t)}),[a,n,r,t,l,c]);var s=un(),u=null;return a&&(u=a.map((function(e){return e.directions.map((function(t){return o.a.createElement(p.a,{item:!0,key:e.id+t.id},"Route: ",e.id," Direction: ",t.id,o.a.createElement(rn,{routeId:e.id,directionId:t.id}))}))}))),o.a.createElement(i.Fragment,null,o.a.createElement(f.a,{position:"relative"},o.a.createElement(h.a,null,o.a.createElement(Qt,null),o.a.createElement("div",{className:s.title},c.title),o.a.createElement(ka,null))),"Date: ",t.date," Time: ",t.startTime," -"," ",t.endTime,o.a.createElement(sn,null),o.a.createElement(p.a,{container:!0,spacing:0},u))}));a(275);function dn(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function pn(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?dn(a,!0).forEach((function(t){Object(ke.a)(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):dn(a).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}var hn={5:{color:"#057F79"},10:{color:"#02BB0F"},15:{color:"#3ae100"},20:{color:"#83dd00"},25:{color:"#cad900"},30:{color:"#d59d00"},35:{color:"#d25400"},40:{color:"#ce0d00"},45:{color:"#c200b6"},50:{color:"#8b00bf"},55:{color:"#4900bf"},60:{color:"#220D3B"}},fn={color:"#666"},gn=new z.a.Icon({iconUrl:"".concat("frontend/build","/marker-icon-2x-red.png"),shadowUrl:"https://cdnjs.cloudflare.com/ajax/libs/leaflet/0.7.7/images/marker-shadow.png",iconSize:[25,41],iconAnchor:[12,41],popupAnchor:[1,-34],shadowSize:[41,41]}),vn={};function En(e,t){return t.directions.find((function(t){return t.id===e}))}var bn=function(e){function t(e){var a;Object(P.a)(this,t),a=Object(C.a)(this,Object(x.a)(t).call(this,e));var n=b[0];a.agencyId=n.id,a.initialZoom=n.initialMapZoom,a.initialCenter=n.initialMapCenter;var r=n.defaultDisabledRoutes||[];a.state={stat:"median",maxTripMin:90,computedMaxTripMin:null,computeId:null,computing:!1,latLng:null,endLatLng:null,tripInfo:null,enabledRoutes:{},noData:!1};var i="".concat("frontend/build","/isochrone-worker.js?v=").concat(Math.random());g&&(i+="&base=".concat(encodeURIComponent(g))),i+="&s3_bucket=".concat(encodeURIComponent(E)),i+="&agency_id=".concat(encodeURIComponent(a.agencyId)),i+="&routes_version=".concat(encodeURIComponent(S)),i+="&wait_times_version=".concat(encodeURIComponent(y)),i+="&trip_times_version=".concat(encodeURIComponent(O));var l=new Worker(i);return a.isochroneWorker=l,a.layers=[],a.isochroneLayers=[],a.tripLayers=[],a.mapRef=o.a.createRef(),r.forEach((function(e){a.state.enabledRoutes[e]=!1})),a.handleMapClick=a.handleMapClick.bind(Object(j.a)(a)),a.handleStatChange=a.handleStatChange.bind(Object(j.a)(a)),a.handleToggleRoute=a.handleToggleRoute.bind(Object(j.a)(a)),a.handleMaxTripMinChange=a.handleMaxTripMinChange.bind(Object(j.a)(a)),a.selectAllRoutesClicked=a.selectAllRoutesClicked.bind(Object(j.a)(a)),a.selectNoRoutesClicked=a.selectNoRoutesClicked.bind(Object(j.a)(a)),a.resetMapClicked=a.resetMapClicked.bind(Object(j.a)(a)),a.onWorkerMessage=a.onWorkerMessage.bind(Object(j.a)(a)),a.recomputeIsochrones=a.recomputeIsochrones.bind(Object(j.a)(a)),a.maxTripMinChanged=a.maxTripMinChanged.bind(Object(j.a)(a)),l.onmessage=a.onWorkerMessage,a}return Object(M.a)(t,e),Object(k.a)(t,[{key:"componentDidMount",value:function(){this.props.routes||this.props.fetchRoutes({agencyId:this.agencyId})}},{key:"componentDidUpdate",value:function(e){this.props.date===e.date&&this.props.startTime===e.startTime&&this.props.endTime===e.endTime||this.recomputeIsochrones()}},{key:"onWorkerMessage",value:function(e){var t=e.data;if("reachableLocations"===t.type){var a=t.computeId;vn[a]&&(vn[a][t.tripMin]=t),a===this.state.computeId&&this.addReachableLocationsLayer(t),this.setState({noData:!1})}else"error"===t.type?t.error.status>=400&&t.error.status<500?this.setState({noData:!0}):this.showError(t.error.message):console.log(e.data)}},{key:"showError",value:function(e){alert(e)}},{key:"handleMapClick",value:function(e){this.state.computeId||(this.resetMap(),this.computeIsochrones(e.latlng,null))}},{key:"addReachableLocationsLayer",value:function(e){var t=this,a=e.tripMin,n=e.circles,r=e.geoJson;if(this.state.computeId===e.computeId){this.state.computing&&a===this.state.maxTripMin&&this.setState({computing:!1});var i=hn["".concat(a)]||fn,o=z.a.geoJson(r,Object.assign({bubblingMouseEvents:!1,fillOpacity:.4,stroke:!1},i)),l=this.mapRef.current.leafletElement;o.addTo(l),o.on("click",(function(e){var a=e.latlng;t.showTripInfo(a,n)})),o.on("dblclick",(function(e){t.resetMap(),t.computeIsochrones(e.latlng)})),this.isochroneLayers.push({tripMin:a,layer:o});var c=this.state.endLatLng;if(c&&!this.tripLayers.length){var s=!0,u=!1,m=void 0;try{for(var d,p=n[Symbol.iterator]();!(s=(d=p.next()).done);s=!0){var h=d.value;if(l.distance(h,c)<=h.radius){this.showTripInfo(c,n);break}}}catch(f){u=!0,m=f}finally{try{s||null==p.return||p.return()}finally{if(u)throw m}}}}}},{key:"showTripInfo",value:function(e,t){var a=this;this.setState({endLatLng:e});var n=this.mapRef.current.leafletElement,r=[];if(t.forEach((function(t){var a=n.distance(t,e);if(a<=t.radius){var i=a/60,o=i+t.tripMin;r.push({tripMin:o,walkMin:i,circle:t})}})),this.clearTripLayers(!1),r.length){r=r.sort((function(e,t){return e.tripMin-t.tripMin}));var i={},l=0,c=[],s=!0,u=!1,m=void 0;try{for(var d,p=r[Symbol.iterator]();!(s=(d=p.next()).done);s=!0){var h=d.value,f=h.circle;if(!i[f.routes]&&(i[f.routes]=!0,l<2||!f.tripItems.length)){l+=1;var g=!0,v=!1,E=void 0;try{for(var b,y=function(){var e=b.value;if(e.route){var t=a.props.routes.find((function(t){return t.id===e.route}));if(t){var r=En(e.direction,t),i=e.fromStop,o=e.toStop,l=t.stops[i],c=t.stops[o],s=ot(t,r,i,o);if(s.length){var u=z.a.polyline(s).addTo(n);u.bindTooltip(t.id,{direction:"center",opacity:.9,permanent:!0}),a.tripLayers.push(u),a.tripLayers.push(z.a.circle(l,40,{color:"#090",fillOpacity:.8,stroke:!1}).addTo(n)),a.tripLayers.push(z.a.circle(c,40,{color:"#900",fillOpacity:.8,stroke:!1}).addTo(n))}}}},O=f.tripItems[Symbol.iterator]();!(g=(b=O.next()).done);g=!0)y()}catch(I){v=!0,E=I}finally{try{g||null==O.return||O.return()}finally{if(v)throw E}}c.push(o.a.createElement("div",{key:l,className:"isochrone-trip"},o.a.createElement("div",null,o.a.createElement("strong",null,"".concat(h.tripMin.toFixed(1)," min [").concat(f.routes||"walk","]"))),f.tripItems.map((function(e,t){return o.a.createElement("div",{key:t},o.a.createElement("em",null,e.t.toFixed(1)," min"),": ",e.desc)})),h.walkMin>.05&&f.tripItems.length?o.a.createElement("div",null,o.a.createElement("em",null,h.walkMin.toFixed(1)," min"),": walk to destination"):null))}}}catch(I){u=!0,m=I}finally{try{s||null==p.return||p.return()}finally{if(u)throw m}}var S=z.a.marker(e,{icon:gn}).addTo(n);this.tripLayers.push(S),this.setState({tripInfo:c})}}},{key:"computeIsochrones",value:function(e,t){var a=this;if(lt(this.agencyId,e)){var n=this.props.date,r=this.props.startTime,i=this.props.endTime,o=r&&i?"".concat(r,"-").concat(i):"",l=this.state,c=l.maxTripMin,s=l.stat,u=l.enabledRoutes,m=[];this.props.routes.forEach((function(e){!1!==u[e.id]&&m.push(e.id)}));var d=[e.lat,e.lng,n,o,s,c,m.join(",")].join(",");this.setState({latLng:e,endLatLng:t,computedMaxTripMin:c,computeId:d});var p,h=this.mapRef.current.leafletElement,f=z.a.marker(e,{draggable:!0}).addTo(h);if(f.on("move",(function(e){p=e.latlng})),f.on("moveend",(function(){p&&(a.resetMap(),a.computeIsochrones(p))})),this.layers.push(f),vn[d]&&vn[d][c])for(var g=5;g<=c;g+=5){var v=vn[d][g];v&&this.addReachableLocationsLayer(v)}else{vn[d]={};for(var E=[],b=5;b<=c&&b<=60;b+=5)E.push(b);c>60&&E.push(c),this.setState({computing:!0}),this.isochroneWorker.postMessage({action:"computeIsochrones",latlng:e,routes:m,dateStr:n,timeStr:o,tripMins:E,stat:s,computeId:d})}}}},{key:"handleStatChange",value:function(e){this.setState({stat:e.target.value},this.recomputeIsochrones)}},{key:"handleMaxTripMinChange",value:function(e){this.setState({maxTripMin:parseInt(e.target.value,10)},this.maxTripMinChanged)}},{key:"maxTripMinChanged",value:function(){var e=this.state,t=e.maxTripMin,a=e.computedMaxTripMin;if(a&&(t>a||!this.isochroneLayers.find((function(e){return e.tripMin===t}))))this.recomputeIsochrones();else{var n=this.mapRef.current.leafletElement;this.isochroneLayers.forEach((function(e){e.tripMin<=t?e.layer.addTo(n):e.layer.remove()}))}}},{key:"handleToggleRoute",value:function(e){var t=e.target.value,a=e.target.checked;this.setState({enabledRoutes:pn({},this.state.enabledRoutes,Object(ke.a)({},t,a))},this.recomputeIsochrones)}},{key:"selectAllRoutesClicked",value:function(){this.selectAllRoutes(!0)}},{key:"selectNoRoutesClicked",value:function(){this.selectAllRoutes(!1)}},{key:"resetMapClicked",value:function(){this.resetMap()}},{key:"recomputeIsochrones",value:function(){var e=this.state,t=e.latLng,a=e.endLatLng;t&&(this.resetMap(),this.computeIsochrones(t,a))}},{key:"resetMap",value:function(){this.mapRef.current.leafletElement.closePopup(),this.setState({computeId:null,latLng:null,endLatLng:null}),this.isochroneLayers.forEach((function(e){e.layer.remove()})),this.layers.forEach((function(e){e.remove()})),this.layers=[],this.isochroneLayers=[],this.clearTripLayers()}},{key:"clearTripLayers",value:function(e){this.tripLayers.forEach((function(e){e.remove()})),this.tripLayers=[],!1!==e&&this.setState({tripInfo:null})}},{key:"selectAllRoutes",value:function(e){var t=this.props.routes;if(t){var a={};t.forEach((function(t){a[t.id]=e})),this.setState({enabledRoutes:a},this.recomputeIsochrones)}}},{key:"makeRouteToggle",value:function(e){var t=this.state.enabledRoutes[e.id];return null==t&&(t=!0),o.a.createElement(zt.a,{key:e.id},o.a.createElement(ma.a,{control:o.a.createElement(Kt.a,{checked:t,onChange:this.handleToggleRoute,value:e.id,color:"primary"}),label:e.id}))}},{key:"render",value:function(){for(var e=this,t=this.props.routes,a=[],n=[],r=5;r<=60;r+=5)a.push(o.a.createElement("div",{key:r,style:{backgroundColor:hn[r].color}})),n.push(o.a.createElement("div",{key:r},r));a.push(o.a.createElement("div",{key:"default",style:{backgroundColor:fn.color}}));for(var i=[],l=15;l<=60;l+=15)i.push(l);return i.push(90),o.a.createElement("div",{className:"flex-screen"},o.a.createElement(f.a,{position:"relative"},o.a.createElement(h.a,null,o.a.createElement(Qt,null),o.a.createElement("div",{className:"page-title"},"Isochrone"),o.a.createElement(ka,null))),o.a.createElement(F.a,{center:this.initialCenter,zoom:this.initialZoom,className:"isochrone-map",minZoom:5,maxZoom:18,onClick:this.handleMapClick,ref:this.mapRef},o.a.createElement(V.a,{attribution:'Map tiles by <a href="http://stamen.com">Stamen Design</a>, under <a href="http://creativecommons.org/licenses/by/3.0">CC BY 3.0</a>. Data by <a href="http://openstreetmap.org">OpenStreetMap</a>, under <a href="http://www.openstreetmap.org/copyright">ODbL</a>.',url:"https://stamen-tiles.a.ssl.fastly.net/toner-lite/{z}/{x}/{y}.png"}),o.a.createElement(B.a,{position:"topleft",className:""},o.a.createElement(p.a,{container:!0,className:"isochrone-controls",direction:"column"},o.a.createElement(p.a,{item:!0},o.a.createElement(St.a,{variant:"subtitle1"},"Statistic")),o.a.createElement(p.a,{item:!0},o.a.createElement(sa.a,{value:this.state.stat,onChange:this.handleStatChange},o.a.createElement(oa.a,{value:"p10"},"10th percentile"),o.a.createElement(oa.a,{value:"median"},"median"),o.a.createElement(oa.a,{value:"p90"},"90th percentile")))),o.a.createElement(p.a,{container:!0,className:"isochrone-controls",direction:"column"},o.a.createElement(p.a,{item:!0},o.a.createElement(St.a,{variant:"subtitle1"},"Max Trip Time")),o.a.createElement(p.a,{item:!0},o.a.createElement(sa.a,{value:this.state.maxTripMin,onChange:this.handleMaxTripMinChange},i.map((function(e){return o.a.createElement(oa.a,{key:e,value:e},e," minutes")}))))),o.a.createElement(p.a,{container:!0,className:"isochrone-controls",direction:"column"},o.a.createElement(p.a,{item:!0},o.a.createElement(St.a,{variant:"subtitle1"},"Routes")),o.a.createElement(p.a,{container:!0,item:!0,direction:"row",alignItems:"flex-start"},o.a.createElement(p.a,{item:!0},o.a.createElement(D.a,{onClick:this.selectAllRoutesClicked},"all"),o.a.createElement(D.a,{onClick:this.selectNoRoutesClicked},"none"))),o.a.createElement(p.a,{item:!0},o.a.createElement(Gt.a,{className:"isochrone-routes"},(t||[]).map((function(t){return e.makeRouteToggle(t)})))))),o.a.createElement(B.a,{position:"topright"},this.state.tripInfo?o.a.createElement("div",{className:"isochrone-trip-info"},this.state.tripInfo):o.a.createElement("div",{className:"isochrone-instructions"},this.state.noData?"There is no data for the selected date. Choose another date.":this.state.latLng?this.state.computing?"Computing...":"Click anywhere in the shaded area to see routes and trip times between the two points, or drag the blue pin to see trip times from a new point.":"Click anywhere in the city to see the trip times from that point to the rest of the city via transit and walking.")),o.a.createElement(B.a,{position:"bottomright"},o.a.createElement("div",{className:"isochrone-legend"},"trip times (minutes)",o.a.createElement("div",{className:"isochrone-legend-colors"},a),o.a.createElement("div",{className:"isochrone-legend-times"},n))),o.a.createElement(B.a,{position:"bottomleft"},o.a.createElement(D.a,{variant:"contained",color:"secondary",onClick:this.resetMapClicked},"Clear map"),o.a.createElement("br",null),o.a.createElement("br",null))))}}]),t}(o.a.Component),yn=Object(s.connect)((function(e){return{routes:e.routes.routes,date:e.routes.graphParams.date,startTime:e.routes.graphParams.startTime,endTime:e.routes.graphParams.endTime}}),(function(e){return{fetchRoutes:function(t){return e(Ke(t))}}}))(bn),On=Object(s.connect)((function(e){return{page:e.page}}))((function(e){var t=e.page,a={About:o.a.createElement(u,null),Isochrone:o.a.createElement(yn,null),Landing:o.a.createElement(m,null),Dashboard:o.a.createElement(Ca,null),Route:o.a.createElement(cn,null),DataDiagnostic:o.a.createElement(mn,null),NotFound:o.a.createElement(d,null)};return o.a.createElement(i.Fragment,null,a[t])})),Sn=a(79),In=a(196),wn=a(146),Tn=a.n(wn),Pn=a(197),kn={ABOUT:"/about",LANDING:"/landing",ISOCHRONE:"/isochrone",DASHBOARD:"/",DATADIAGNOSTIC:"/dataDiagnostic",ROUTESCREEN:{path:"/".concat(X,"/:routeId/(").concat(q,")*/:directionId?/(").concat(Z,")*/:startStopId?/(").concat(Q,")*/:endStopId?"),thunk:function(){var e=Object(Pn.a)(Tn.a.mark((function e(t,a){var n,r,i,o,l,c,s;return Tn.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=a(),r=n.location,i=r.payload,o=i.routeId,l=i.directionId,c=i.startStopId,s=i.endStopId,t(rt({agencyId:b[0].id,routeId:o,directionId:l,startStopId:c,endStopId:s}));case 3:case"end":return e.stop()}}),e)})));return function(t,a){return e.apply(this,arguments)}}()}};function Cn(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function xn(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?Cn(a,!0).forEach((function(t){Object(ke.a)(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):Cn(a).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}var jn={graphData:null,intervalData:null},Mn=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:jn,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"RECEIVED_GRAPH_DATA":var a=t.payload.data,n=a?a.routeMetrics:null,r=n?n.trip:null,i=r?r.interval:null,o=r?r.timeRanges:null;return xn({},e,{err:null,graphData:i,intervalData:o,graphParams:t.graphParams});case"RESET_GRAPH_DATA":return xn({},e,{err:null,graphData:null});case"ERROR_GRAPH_DATA":return xn({},e,{err:t.payload,graphData:null})}return e},Dn=Object(ke.a)({ABOUT:"About",ISOCHRONE:"Isochrone",LANDING:"Landing",DASHBOARD:"Dashboard",ROUTESCREEN:"Route",DATADIAGNOSTIC:"DataDiagnostic"},$.NOT_FOUND,"NotFound"),Rn=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"DASHBOARD",t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return Dn[t.type]||e};function Nn(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}var _n=window.__REDUX_DEVTOOLS_EXTENSION_COMPOSE__?window.__REDUX_DEVTOOLS_EXTENSION_COMPOSE__({actionCreators:n}):Sn.d;var Ln=function(e){var t=Object($.connectRoutes)(kn),a=t.reducer,n=t.middleware,i=t.enhancer,o=Object(Sn.c)(function(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?Nn(a,!0).forEach((function(t){Object(ke.a)(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):Nn(a).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}({},r,{location:a})),l=Object(Sn.a)(In.a,n),c=_n(i,l);return{store:Object(Sn.e)(o,e,c)}}().store;c.a.render(o.a.createElement(s.Provider,{store:Ln},o.a.createElement(On,null)),document.getElementById("root"))}},[[209,1,2]]]);
//# sourceMappingURL=main.1834fd84.chunk.js.map